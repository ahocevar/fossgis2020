(function () {function Uf(a){return a&&a.__esModule?{d:a.default}:{d:a}}var id={};function c(){return function(){throw new Error("Unimplemented abstract method.")}()}var Xi=0;function ca(t){return t.ol_uid||(t.ol_uid=String(++Xi))}var jd="6.2.2-dev.1583765652344";var Yi=id&&id.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),kd=function(t){function r(r){var e=this,o="Assertion failed. See https://openlayers.org/en/"+("latest"===jd?jd:"v"+jd.split("-")[0])+"/doc/errors/#"+r+" for details.";return(e=t.call(this,o)||this).code=r,e.name="AssertionError",e.message=o,e}return Yi(r,t),r}(Error);id.default=kd;var _b={};var u={ADD:"add",REMOVE:"remove"};var ub={};var qa={PROPERTYCHANGE:"propertychange"};var ac={};function a(e,t,n,$,r){if($&&$!==e&&(n=n.bind($)),r){var i=n;n=function(){e.removeEventListener(t,n),i.apply(this,arguments)}}var a={target:e,type:t,listener:n};return e.addEventListener(t,n),a}function vb(e,t,n,$){return a(e,t,n,$,!0)}function d(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),Xa(e))}var G="function"==typeof Object.assign?Object.assign:function(e,r){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),s=1,n=arguments.length;s<n;++s){var o=arguments[s];if(null!=o)for(var $ in o)o.hasOwnProperty($)&&(t[$]=o[$])}return t};function Xa(e){for(var r in e)delete e[r]}var ld="function"==typeof Object.values?Object.values:function(e){var r=[];for(var t in e)r.push(e[t]);return r};function bc(e){var r;for(r in e)return!1;return!r}var md={};var nd=function(){function t(){this.disposed_=!1}return t.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();function H(){return!0}function Ca(){return!1}function Y(){}function Zi($){var r,p,e,t=!1;return function(){var o=Array.prototype.slice.call(arguments);return t&&this===e&&Ya(o,p)||(t=!0,e=this,p=o,r=$.apply(this,arguments)),r}}function $i(r,e,o){for(var n,t,$=o||ra,i=0,u=r.length,a=!1;i<u;)(t=+$(r[n=i+(u-i>>1)],e))<0?i=n+1:(u=n,a=!t);return a?i:~i}function ra(r,e){return r>e?1:r<e?-1:0}function wb(r,e){return r.indexOf(e)>=0}function od(r,e,o){var n=r.length;if(r[0]<=e)return 0;if(e<=r[n-1])return n-1;var t=void 0;if(o>0){for(t=1;t<n;++t)if(r[t]<e)return t-1}else if(o<0){for(t=1;t<n;++t)if(r[t]<=e)return t}else for(t=1;t<n;++t){if(r[t]==e)return t;if(r[t]<e)return r[t-1]-e<e-r[t]?t-1:t}return n-1}function _i(r,e,o){for(;e<o;){var n=r[e];r[e]=r[o],r[o]=n,++e,--o}}function K(r,e){for(var o=Array.isArray(e)?e:[e],n=o.length,t=0;t<n;t++)r[r.length]=o[t]}function Ya(r,e){var o=r.length;if(o!==e.length)return!1;for(var n=0;n<o;n++)if(r[n]!==e[n])return!1;return!0}function aj(r,e,o){var n=e||ra;return r.every(function(e,t){if(0===t)return!0;var $=n(r[t-1],e);return!($>0||o&&0===$)})}var A=function(){function t(t){this.propagationStopped,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.propagationStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}();function bj(t){t.stopPropagation()}var cj=md&&md.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Da=function(t){function e(e){var n=t.call(this)||this;return n.eventTarget_=e,n.pendingRemovals_={},n.dispatching_={},n.listeners_={},n}return cj(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var n=this.listeners_[t];n||(n=[],this.listeners_[t]=n),-1===n.indexOf(e)&&n.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new A(t):t,n=e.type;e.target||(e.target=this.eventTarget_||this);var i,r=this.listeners_[n];if(r){n in this.dispatching_||(this.dispatching_[n]=0,this.pendingRemovals_[n]=0),++this.dispatching_[n];for(var s=0,o=r.length;s<o;++s)if(!1===r[s].call(this,e)||e.propagationStopped){i=!1;break}if(--this.dispatching_[n],0===this.dispatching_[n]){var p=this.pendingRemovals_[n];for(delete this.pendingRemovals_[n];p--;)this.removeEventListener(n,Y);delete this.dispatching_[n]}return i}},e.prototype.disposeInternal=function(){Xa(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var n=this.listeners_[t];if(n){var i=n.indexOf(e);-1!==i&&(t in this.pendingRemovals_?(n[i]=Y,++this.pendingRemovals_[t]):(n.splice(i,1),0===n.length&&delete this.listeners_[t]))}},e}(nd);md.default=Da;var f={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};var dj=ac&&ac.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pd=function(t){function e(){var e=t.call(this)||this;return e.revision_=0,e}return dj(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(f.CHANGE)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=a(this,t[o],e);return n}return a(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=vb(this,t[o],e);return n}return vb(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)},e}(Da);function ej(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)d(t[e]);else d(t)}ac.unByKey=ej,ac.default=pd;var Vf=ub&&ub.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qd=function(e){function t(t,r,n){var $=e.call(this,t)||this;return $.key=r,$.oldValue=n,$}return Vf(t,e),t}(A);ub.ObjectEvent=qd;var e=function(e){function t(t){var r=e.call(this)||this;return ca(r),r.values_={},void 0!==t&&r.setProperties(t),r}return Vf(t,e),t.prototype.get=function(e){var t;return this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},t.prototype.getKeys=function(){return Object.keys(this.values_)},t.prototype.getProperties=function(){return G({},this.values_)},t.prototype.notify=function(e,t){var r;r=l(e),this.dispatchEvent(new qd(r,e,t)),r=qa.PROPERTYCHANGE,this.dispatchEvent(new qd(r,e,t))},t.prototype.set=function(e,t,r){if(r)this.values_[e]=t;else{var n=this.values_[e];this.values_[e]=t,n!==t&&this.notify(e,n)}},t.prototype.setProperties=function(e,t){for(var r in e)this.set(r,e[r],t)},t.prototype.unset=function(e,t){if(e in this.values_){var r=this.values_[e];delete this.values_[e],t||this.notify(e,r)}},t}(pd),rd={};function l(e){return rd.hasOwnProperty(e)?rd[e]:rd[e]="change:"+e}ub.getChangeEventType=l,ub.default=e;var Wf=_b&&_b.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Xf={LENGTH:"length"},xb=function(t){function r(r,e,n){var o=t.call(this,r)||this;return o.element=e,o.index=n,o}return Wf(r,t),r}(A);_b.CollectionEvent=xb;var x=function(t){function r(r,e){var n=t.call(this)||this,o=e||{};if(n.unique_=!!o.unique,n.array_=r||[],n.unique_)for(var i=0,s=n.array_.length;i<s;++i)n.assertUnique_(n.array_[i],i);return n.updateLength_(),n}return Wf(r,t),r.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},r.prototype.extend=function(t){for(var r=0,e=t.length;r<e;++r)this.push(t[r]);return this},r.prototype.forEach=function(t){for(var r=this.array_,e=0,n=r.length;e<n;++e)t(r[e],e,r)},r.prototype.getArray=function(){return this.array_},r.prototype.item=function(t){return this.array_[t]},r.prototype.getLength=function(){return this.get(Xf.LENGTH)},r.prototype.insertAt=function(t,r){this.unique_&&this.assertUnique_(r),this.array_.splice(t,0,r),this.updateLength_(),this.dispatchEvent(new xb(u.ADD,r,t))},r.prototype.pop=function(){return this.removeAt(this.getLength()-1)},r.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var r=this.getLength();return this.insertAt(r,t),this.getLength()},r.prototype.remove=function(t){for(var r=this.array_,e=0,n=r.length;e<n;++e)if(r[e]===t)return this.removeAt(e)},r.prototype.removeAt=function(t){var r=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new xb(u.REMOVE,r,t)),r},r.prototype.setAt=function(t,r){var e=this.getLength();if(t<e){this.unique_&&this.assertUnique_(r,t);var n=this.array_[t];this.array_[t]=r,this.dispatchEvent(new xb(u.REMOVE,n,t)),this.dispatchEvent(new xb(u.ADD,r,t))}else{for(var o=e;o<t;++o)this.insertAt(o,void 0);this.insertAt(t,r)}},r.prototype.updateLength_=function(){this.set(Xf.LENGTH,this.array_.length)},r.prototype.assertUnique_=function(t,r){for(var e=0,n=this.array_.length;e<n;++e)if(this.array_[e]===t&&e!==r)throw new kd(58)},r}(e);_b.default=x;var cc={};function g(r,$){if(!r)throw new kd($)}var fj=cc&&cc.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),X=function(e){function t(t){var r=e.call(this)||this;if(r.id_=void 0,r.geometryName_="geometry",r.style_=null,r.styleFunction_=void 0,r.geometryChangeKey_=null,r.addEventListener(l(r.geometryName_),r.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){var n=t;r.setGeometry(n)}else{var o=t;r.setProperties(o)}return r}return fj(t,e),t.prototype.clone=function(){var e=new t(this.getProperties());e.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&e.setGeometry(r.clone());var n=this.getStyle();return n&&e.setStyle(n),e},t.prototype.getGeometry=function(){return this.get(this.geometryName_)},t.prototype.getId=function(){return this.id_},t.prototype.getGeometryName=function(){return this.geometryName_},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.handleGeometryChange_=function(){this.changed()},t.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(d(this.geometryChangeKey_),this.geometryChangeKey_=null);var e=this.getGeometry();e&&(this.geometryChangeKey_=a(e,f.CHANGE,this.handleGeometryChange_,this)),this.changed()},t.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},t.prototype.setStyle=function(e){this.style_=e,this.styleFunction_=e?Yf(e):void 0,this.changed()},t.prototype.setId=function(e){this.id_=e,this.changed()},t.prototype.setGeometryName=function(e){this.removeEventListener(l(this.geometryName_),this.handleGeometryChanged_),this.geometryName_=e,this.addEventListener(l(this.geometryName_),this.handleGeometryChanged_),this.handleGeometryChanged_()},t}(e);function Yf(e){return"function"==typeof e?e:(Array.isArray(e)?t=e:(g("function"==typeof e.getZIndex,41),t=[e]),function(){return t});var t}cc.createStyleFunction=Yf,cc.default=X;var Ea={};function y(t){for(var e=ea(),$=0,r=t.length;$<r;++$)_a(e,t[$]);return e}function gj(t,e,$){return N(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),$)}function dc(t,e,$){return $?($[0]=t[0]-e,$[1]=t[1]-e,$[2]=t[2]+e,$[3]=t[3]+e,$):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Zf(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function Za(t,e,$){var r,o;return(r=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*r+(o=$<t[1]?t[1]-$:t[3]<$?$-t[3]:0)*o}function $f(t,e){return sd(t,e[0],e[1])}function Z(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function sd(t,e,$){return t[0]<=e&&e<=t[2]&&t[1]<=$&&$<=t[3]}function td(t,e){var $=t[0],r=t[1],o=t[2],n=t[3],p=e[0],i=e[1],a=v.UNKNOWN;return p<$?a|=v.LEFT:p>o&&(a|=v.RIGHT),i<r?a|=v.BELOW:i>n&&(a|=v.ABOVE),a===v.UNKNOWN&&(a=v.INTERSECTING),a}function ea(){return[1/0,1/0,-1/0,-1/0]}function N(t,e,$,r,o){return o?(o[0]=t,o[1]=e,o[2]=$,o[3]=r,o):[t,e,$,r]}function yb(t){return N(1/0,1/0,-1/0,-1/0,t)}function ec(t,e){var $=t[0],r=t[1];return N($,r,$,r,e)}function hj(t,e){return ij(yb(e),t)}function _f(t,e,$,r,o){return bg(yb(o),t,e,$,r)}function $a(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function ag(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function _a(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function ij(t,e){for(var $=0,r=e.length;$<r;++$)_a(t,e[$]);return t}function bg(t,e,$,r,o){for(;$<r;$+=o)jj(t,e[$],e[$+1]);return t}function jj(t,e,$){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],$),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],$)}function cg(t,e){var $;return($=e(sa(t)))?$:($=e(Fa(t)))?$:($=e(Ga(t)))?$:($=e(ga(t)))||!1}function ud(t){var e=0;return vd(t)||(e=D(t)*P(t)),e}function sa(t){return[t[0],t[1]]}function Fa(t){return[t[2],t[1]]}function zb(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function kj(t,e){var $;return e===Bb.BOTTOM_LEFT?$=sa(t):e===Bb.BOTTOM_RIGHT?$=Fa(t):e===Bb.TOP_LEFT?$=ga(t):e===Bb.TOP_RIGHT?$=Ga(t):g(!1,13),$}function dg(t,e,$,r,o){var n=e*r[0]/2,p=e*r[1]/2,i=Math.cos($),a=Math.sin($),L=n*i,x=n*a,V=p*i,w=p*a,s=t[0],c=t[1],u=s-L+w,d=s-L-w,g=s+L-w,m=s+L+w,f=c-x-V,h=c-x+V,l=c+x+V,R=c+x-V;return N(Math.min(u,d,g,m),Math.min(f,h,l,R),Math.max(u,d,g,m),Math.max(f,h,l,R),o)}function P(t){return t[3]-t[1]}function Ab(t,e,$){var r=$||ea();return fa(t,e)?(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]):yb(r),r}function ga(t){return[t[0],t[3]]}function Ga(t){return[t[2],t[3]]}function D(t){return t[2]-t[0]}function fa(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function vd(t){return t[2]<t[0]||t[3]<t[1]}function lj(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}function eg(t,e){var $=(t[2]-t[0])/2*(e-1),r=(t[3]-t[1])/2*(e-1);t[0]-=$,t[2]+=$,t[1]-=r,t[3]+=r}function mj(t,e,$){var r=!1,o=td(t,e),n=td(t,$);if(o===v.INTERSECTING||n===v.INTERSECTING)r=!0;else{var p=t[0],i=t[1],a=t[2],L=t[3],x=e[0],V=e[1],w=$[0],s=$[1],c=(s-V)/(w-x),u=void 0,d=void 0;n&v.ABOVE&&!(o&v.ABOVE)&&(r=(u=w-(s-L)/c)>=p&&u<=a),r||!(n&v.RIGHT)||o&v.RIGHT||(r=(d=s-(w-a)*c)>=i&&d<=L),r||!(n&v.BELOW)||o&v.BELOW||(r=(u=w-(s-i)/c)>=p&&u<=a),r||!(n&v.LEFT)||o&v.LEFT||(r=(d=s-(w-p)*c)>=i&&d<=L)}return r}function nj(t,e,$,r){var o=[];if(r>1)for(var n=t[2]-t[0],p=t[3]-t[1],i=0;i<r;++i)o.push(t[0]+n*i/r,t[1],t[2],t[1]+p*i/r,t[2]-n*i/r,t[3],t[0],t[3]-p*i/r);else o=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(o,o,2);for(var a=[],L=[],x=(i=0,o.length);i<x;i+=2)a.push(o[i]),L.push(o[i+1]);return gj(a,L,$)}var Bb={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};var v={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};var p={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};var k={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var wd={};var Cb={};var xd={};function Ha(r,t,e,$,o,a){for(var n=a||[],v=0,s=t;s<e;s+=$){var f=r[s],l=r[s+1];n[v++]=o[0]*f+o[2]*l+o[4],n[v++]=o[1]*f+o[3]*l+o[5]}return a&&n.length!=v&&(n.length=v),n}function fg(r,t,e,$,o,a,n){for(var v=n||[],s=Math.cos(o),f=Math.sin(o),l=a[0],b=a[1],j=0,p=t;p<e;p+=$){var x=r[p]-l,h=r[p+1]-b;v[j++]=l+x*s-h*f,v[j++]=b+x*f+h*s;for(var c=p+2;c<p+$;++c)v[j++]=r[c]}return n&&v.length!=j&&(v.length=j),v}function oj(r,t,e,$,o,a,n,v){for(var s=v||[],f=n[0],l=n[1],b=0,j=t;j<e;j+=$){var p=r[j]-f,x=r[j+1]-l;s[b++]=f+o*p,s[b++]=l+a*x;for(var h=j+2;h<j+$;++h)s[b++]=r[h]}return v&&s.length!=b&&(s.length=b),s}function gg(r,t,e,$,o,a,n){for(var v=n||[],s=0,f=t;f<e;f+=$){v[s++]=r[f]+o,v[s++]=r[f+1]+a;for(var l=f+2;l<f+$;++l)v[s++]=r[l]}return n&&v.length!=s&&(v.length=s),v}function yd(r,o,$){var t;if(void 0!==o){for(var e=0,c=r.length;e<c;++e)o[e]=r[e];t=o}else t=r.slice();return t}function hg(r,o,$){if(void 0!==o&&r!==o){for(var t=0,e=r.length;t<e;++t)o[t]=r[t];r=o}return r}function pj(r){Cj(r.getCode(),r),hc(r,r,yd)}function qj(r){r.forEach(pj)}function C(r){return"string"==typeof r?Bj(r):r||null}function zd(r,o,$,t){var e,c=(r=C(r)).getPointResolutionFunc();if(c)e=c(o,$),t&&t!==r.getUnits()&&(n=r.getMetersPerUnit())&&(e=e*n/Q[t]);else if(r.getUnits()==E.DEGREES&&!t||t==E.DEGREES)e=o;else{var n,s=bb(r,C("EPSG:4326")),i=[$[0]-o/2,$[1],$[0]+o/2,$[1],$[0],$[1]-o/2,$[0],$[1]+o/2];i=s(i,i,2),e=(Cd(i.slice(0,2),i.slice(2,4))+Cd(i.slice(4,6),i.slice(6,8)))/2,void 0!==(n=t?Q[t]:r.getMetersPerUnit())&&(e/=n)}return e}function ig(r){qj(r),r.forEach(function(o){r.forEach(function(r){o!==r&&hc(o,r,yd)})})}function rj(r,o,$,t){r.forEach(function(r){o.forEach(function(o){hc(r,o,$),hc(o,r,t)})})}function Ad(r,o){return r?"string"==typeof r?C(r):r:C(o)}function ab(r,o){if(r===o)return!0;var $=r.getUnits()===o.getUnits();return r.getCode()===o.getCode()?$:bb(r,o)===yd&&$}function bb(r,o){var $=r.getCode(),t=o.getCode(),e=Aj($,t);return e||(e=hg),e}function Db(r,o){return bb(C(r),C(o))}function Bd(r,o,$){return Db(o,$)(r,void 0,r.length)}function jg(r,o,$,t){var e=Db(o,$);return nj(r,e,void 0,t)}function z(r,e,t){return Math.min(Math.max(r,e),t)}var sj="cosh"in Math?Math.cosh:function(r){var e=Math.exp(r);return(e+1/e)/2};function tj(r,e,t,$,o,a){var n=o-t,s=a-$;if(0!==n||0!==s){var p=((r-t)*n+(e-$)*s)/(n*n+s*s);p>1?(t=o,$=a):p>0&&(t+=n*p,$+=s*p)}return Ia(r,e,t,$)}function Ia(r,e,t,$){var o=t-r,a=$-e;return o*o+a*a}function uj(r){for(var e=r.length,t=0;t<e;t++){for(var $=t,o=Math.abs(r[t][t]),a=t+1;a<e;a++){var n=Math.abs(r[a][t]);n>o&&(o=n,$=a)}if(0===o)return null;var s=r[$];r[$]=r[t],r[t]=s;for(var p=t+1;p<e;p++)for(var q=-r[p][t]/r[t][t],x=t;x<e+1;x++)t==x?r[p][x]=0:r[p][x]+=q*r[t][x]}for(var u=new Array(e),A=e-1;A>=0;A--){u[A]=r[A][e]/r[A][A];for(var K=A-1;K>=0;K--)r[K][e]-=r[K][A]*u[A]}return u}function kg(r){return 180*r/Math.PI}function _(r){return r*Math.PI/180}function Ja(r,e){var t=r%e;return t*e<0?t+e:t}function cb(r,e,t){return r+t*(e-r)}var fc=6371008.8;function Cd(e,t,r){var $=r||fc,a=_(e[1]),o=_(t[1]),T=(o-a)/2,n=_(t[0]-e[0])/2,A=Math.sin(T)*Math.sin(T)+Math.sin(n)*Math.sin(n)*Math.cos(a)*Math.cos(o);return 2*$*Math.atan2(Math.sqrt(A),Math.sqrt(1-A))}function Dd(e,t){for(var r=0,$=0,a=e.length;$<a-1;++$)r+=Cd(e[$],e[$+1],t);return r}function vj(e,t){var r=t||{},$=r.radius||fc,a=r.projection||"EPSG:3857",o=e.getType();o!==k.GEOMETRY_COLLECTION&&(e=e.clone().transform(a,"EPSG:4326"));var T,n,A,x,p,s,d=0;switch(o){case k.POINT:case k.MULTI_POINT:break;case k.LINE_STRING:case k.LINEAR_RING:d=Dd(T=e.getCoordinates(),$);break;case k.MULTI_LINE_STRING:case k.POLYGON:for(A=0,x=(T=e.getCoordinates()).length;A<x;++A)d+=Dd(T[A],$);break;case k.MULTI_POLYGON:for(A=0,x=(T=e.getCoordinates()).length;A<x;++A)for(p=0,s=(n=T[A]).length;p<s;++p)d+=Dd(n[p],$);break;case k.GEOMETRY_COLLECTION:var i=e.getGeometries();for(A=0,x=i.length;A<x;++A)d+=vj(i[A],t);break;default:throw new Error("Unsupported geometry type: "+o);}return d}function gc(e,t){for(var r=0,$=e.length,a=e[$-1][0],o=e[$-1][1],T=0;T<$;T++){var n=e[T][0],A=e[T][1];r+=_(n-a)*(2+Math.sin(_(o))+Math.sin(_(A))),a=n,o=A}return r*t*t/2}function wj(e,t){var r=t||{},$=r.radius||fc,a=r.projection||"EPSG:3857",o=e.getType();o!==k.GEOMETRY_COLLECTION&&(e=e.clone().transform(a,"EPSG:4326"));var T,n,A,x,p,s,d=0;switch(o){case k.POINT:case k.MULTI_POINT:case k.LINE_STRING:case k.MULTI_LINE_STRING:case k.LINEAR_RING:break;case k.POLYGON:for(T=e.getCoordinates(),d=Math.abs(gc(T[0],$)),A=1,x=T.length;A<x;++A)d-=Math.abs(gc(T[A],$));break;case k.MULTI_POLYGON:for(A=0,x=(T=e.getCoordinates()).length;A<x;++A)for(n=T[A],d+=Math.abs(gc(n[0],$)),p=1,s=n.length;p<s;++p)d-=Math.abs(gc(n[p],$));break;case k.GEOMETRY_COLLECTION:var i=e.getGeometries();for(A=0,x=i.length;A<x;++A)d+=wj(i[A],t);break;default:throw new Error("Unsupported geometry type: "+o);}return d}function xj(e,t,r,$){var a=$||fc,o=_(e[1]),T=_(e[0]),n=t/a,A=Math.asin(Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(r)),x=T+Math.atan2(Math.sin(r)*Math.sin(n)*Math.cos(o),Math.cos(n)-Math.sin(o)*Math.sin(A));return[kg(x),kg(A)]}var r={};var io=arguments[0];var E={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Q={};Q[E.DEGREES]=2*Math.PI*6370997/360,Q[E.FEET]=.3048,Q[E.METERS]=1,Q[E.USFEET]=1200/3937;var lg=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Q[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();var yj=r&&r.__extends||function(){var $=function(n,r){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,n){$.__proto__=n}||function($,n){for(var r in n)n.hasOwnProperty(r)&&($[r]=n[r])})(n,r)};return function(n,r){function t(){this.constructor=n}$(n,r),n.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),Eb=6378137;r.RADIUS=Eb;var Ka=Math.PI*Eb;r.HALF_SIZE=Ka;var mg=[-Ka,-Ka,Ka,Ka];r.EXTENT=mg;var ng=[-180,-85,180,85];r.WORLD_EXTENT=ng;var La=function($){function n(n){return $.call(this,{code:n,units:E.METERS,extent:mg,global:!0,worldExtent:ng,getPointResolution:function($,n){return $/sj(n[1]/Eb)}})||this}return yj(n,$),n}(lg),Ed=[new La("EPSG:3857"),new La("EPSG:102100"),new La("EPSG:102113"),new La("EPSG:900913"),new La("urn:ogc:def:crs:EPSG:6.18:3:3857"),new La("urn:ogc:def:crs:EPSG::3857"),new La("http://www.opengis.net/gml/srs/epsg.xml#3857")];function og($,n,r){var t=$.length,o=r>1?r:2,e=n;void 0===e&&(e=o>2?$.slice():new Array(t));for(var m=Ka,Z=0;Z<t;Z+=o){e[Z]=m*$[Z]/180;var p=Eb*Math.log(Math.tan(Math.PI*(+$[Z+1]+90)/360));p>m?p=m:p<-m&&(p=-m),e[Z+1]=p}return e}function pg($,n,r){var t=$.length,o=r>1?r:2,e=n;void 0===e&&(e=o>2?$.slice():new Array(t));for(var m=0;m<t;m+=o)e[m]=180*$[m]/Ka,e[m+1]=360*Math.atan(Math.exp($[m+1]/Eb))/Math.PI-90;return e}r.PROJECTIONS=Ed,r.fromEPSG4326=og,r.toEPSG4326=pg;var db={};var zj=db&&db.__extends||function(){var t=function(r,$){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var $ in r)r.hasOwnProperty($)&&(t[$]=r[$])})(r,$)};return function(r,$){function e(){this.constructor=r}t(r,$),r.prototype=null===$?Object.create($):(e.prototype=$.prototype,new e)}}(),qg=6378137;db.RADIUS=qg;var Fd=[-180,-90,180,90];db.EXTENT=Fd;var rg=Math.PI*qg/180;db.METERS_PER_UNIT=rg;var ta=function(t){function r(r,$){return t.call(this,{code:r,units:E.DEGREES,extent:Fd,axisOrientation:$,global:!0,metersPerUnit:rg,worldExtent:Fd})||this}return zj(r,t),r}(lg),Gd=[new ta("CRS:84"),new ta("EPSG:4326","neu"),new ta("urn:ogc:def:crs:EPSG::4326","neu"),new ta("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new ta("urn:ogc:def:crs:OGC:1.3:CRS84"),new ta("urn:ogc:def:crs:OGC:2:84"),new ta("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ta("urn:x-ogc:def:crs:EPSG:4326","neu")];db.PROJECTIONS=Gd;var eb={};function hc($,t,r){var e=$.getCode(),o=t.getCode();e in eb||(eb[e]={}),eb[e][o]=r}function Aj($,t){var r;return $ in eb&&t in eb[$]&&(r=eb[$][t]),r}var sg={};function Bj($){return sg[$]||null}function Cj($,t){sg[$]=t}var t=null;function Dj(r){t=C(r)}function fb(){return t}function Ej(){Dj("EPSG:4326")}function Fb(r,o){return t?Bd(r,o,t):r}function q(r,o){return t?Bd(r,t,o):r}function Gb(r,o){return t?jg(r,o,t):r}function ua(r,o){return t?jg(r,t,o):r}function Fj(){ig(Ed),ig(Gd),rj(Gd,Ed,og,pg)}Fj();var jo=new Array(6);function R(){return[1,0,0,1,0,0]}function Gj($,t,r,e,n,o,p){return $[0]=t,$[1]=r,$[2]=e,$[3]=n,$[4]=o,$[5]=p,$}function Hj($,t){return $[0]=t[0],$[1]=t[1],$[2]=t[2],$[3]=t[3],$[4]=t[4],$[5]=t[5],$}function da($,t){var r=t[0],e=t[1];return t[0]=$[0]*r+$[2]*e+$[4],t[1]=$[1]*r+$[3]*e+$[5],t}function Ij($,t,r){return Gj($,t,0,0,r,0,0)}function ha($,t,r,e,n,o,p,D){var L=Math.sin(o),s=Math.cos(o);return $[0]=e*s,$[1]=n*L,$[2]=-e*L,$[3]=n*s,$[4]=p*e*s-D*e*L+t,$[5]=p*n*L+D*n*s+r,$}function Hd($,t){var r=Jj(t);g(0!==r,32);var e=t[0],n=t[1],o=t[2],p=t[3],D=t[4],L=t[5];return $[0]=p/r,$[1]=-n/r,$[2]=-o/r,$[3]=e/r,$[4]=(o*L-p*D)/r,$[5]=-(e*L-n*D)/r,$}function Jj($){return $[0]*$[3]-$[1]*$[2]}function tg($){return"matrix("+$.join(", ")+")"}var Kj=xd&&xd.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ug=R(),vg=function(t){function r(){var r=t.call(this)||this;return r.extent_=ea(),r.extentRevision_=-1,r.simplifiedGeometryMaxMinSquaredTolerance=0,r.simplifiedGeometryRevision=0,r.simplifyTransformedInternal=Zi(function(t,r,e){if(!e)return this.getSimplifiedGeometry(r);var n=this.clone();return n.applyTransform(e),n.getSimplifiedGeometry(r)}),r}return Kj(r,t),r.prototype.simplifyTransformed=function(t,r){return this.simplifyTransformedInternal(this.getRevision(),t,r)},r.prototype.clone=function(){return c()},r.prototype.closestPointXY=function(t,r,e,n){return c()},r.prototype.containsXY=function(t,r){var e=this.getClosestPoint([t,r]);return e[0]===t&&e[1]===r},r.prototype.getClosestPoint=function(t,r){var e=r||[NaN,NaN];return this.closestPointXY(t[0],t[1],e,1/0),e},r.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},r.prototype.computeExtent=function(t){return c()},r.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),lj(this.extent_,t)},r.prototype.rotate=function(t,r){c()},r.prototype.scale=function(t,r,e){c()},r.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},r.prototype.getSimplifiedGeometry=function(t){return c()},r.prototype.getType=function(){return c()},r.prototype.applyTransform=function(t){c()},r.prototype.intersectsExtent=function(t){return c()},r.prototype.translate=function(t,r){c()},r.prototype.transform=function(t,r){var e=C(t),n=e.getUnits()==E.TILE_PIXELS?function(t,n,o){var i=e.getExtent(),$=e.getWorldExtent(),p=P($)/P(i);return ha(ug,$[0],$[3],p,-p,0,0,0),Ha(t,0,t.length,o,ug,n),Db(e,r)(t,n,o)}:Db(e,r);return this.applyTransform(n),this},r}(e);xd.default=vg;var Lj=Cb&&Cb.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),$=function(t){function e(){var e=t.call(this)||this;return e.layout=p.XY,e.stride=2,e.flatCoordinates=null,e}return Lj(e,t),e.prototype.computeExtent=function(t){return _f(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return c()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=Id(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){c()},e.prototype.setLayout=function(t,e,r){var o;if(t)o=Id(t);else{for(var i=0;i<r;++i){if(0===e.length)return this.layout=p.XY,void(this.stride=2);e=e[0]}t=Mj(o=e.length)}this.layout=t,this.stride=o},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var r=this.getFlatCoordinates();if(r){var o=this.getStride();fg(r,0,r.length,o,t,e,r),this.changed()}},e.prototype.scale=function(t,e,r){var o=e;void 0===o&&(o=t);var i=r;i||(i=zb(this.getExtent()));var n=this.getFlatCoordinates();if(n){var a=this.getStride();oj(n,0,n.length,a,t,o,i,n),this.changed()}},e.prototype.translate=function(t,e){var r=this.getFlatCoordinates();if(r){var o=this.getStride();gg(r,0,r.length,o,t,e,r),this.changed()}},e}(vg);function Mj(t){var e;return 2==t?e=p.XY:3==t?e=p.XYZ:4==t&&(e=p.XYZM),e}function Id(t){var e;return t==p.XY?e=2:t==p.XYZ||t==p.XYM?e=3:t==p.XYZM&&(e=4),e}function wg(t,e,r){var o=t.getFlatCoordinates();if(o){var i=t.getStride();return Ha(o,0,o.length,i,e,r)}return null}Cb.getStrideForLayout=Id,Cb.transformGeom2D=wg,Cb.default=$;function xg(e,r,n,$){for(var i=0,t=e[n-$],a=e[n-$+1];r<n;r+=$){var o=e[r],g=e[r+1];i+=a*o-t*g,t=o,a=g}return i/2}function yg(e,r,n,$){for(var i=0,t=0,a=n.length;t<a;++t){var o=n[t];i+=xg(e,r,o,$),r=o}return i}function Nj(e,r,n,$){for(var i=0,t=0,a=n.length;t<a;++t){var o=n[t];i+=yg(e,r,o,$),r=o[o.length-1]}return i}function zg(r,t,a,e,$,h,s){var o,n=r[t],i=r[t+1],l=r[a]-n,u=r[a+1]-i;if(0===l&&0===u)o=t;else{var x=(($-n)*l+(h-i)*u)/(l*l+u*u);if(x>1)o=a;else{if(x>0){for(var w=0;w<e;++w)s[w]=cb(r[t+w],r[a+w],x);return void(s.length=e)}o=t}}for(w=0;w<e;++w)s[w]=r[o+w];s.length=e}function Jd(r,t,a,e,$){var h=r[t],s=r[t+1];for(t+=e;t<a;t+=e){var o=r[t],n=r[t+1],i=Ia(h,s,o,n);i>$&&($=i),h=o,s=n}return $}function Kd(r,t,a,e,$){for(var h=0,s=a.length;h<s;++h){var o=a[h];$=Jd(r,t,o,e,$),t=o}return $}function Oj(r,t,a,e,$){for(var h=0,s=a.length;h<s;++h){var o=a[h];$=Kd(r,t,o,e,$),t=o[o.length-1]}return $}function Ld(r,t,a,e,$,h,s,o,n,i,l){if(t==a)return i;var u,x;if(0===$){if((x=Ia(s,o,r[t],r[t+1]))<i){for(u=0;u<e;++u)n[u]=r[t+u];return n.length=e,x}return i}for(var w=l||[NaN,NaN],B=t+e;B<a;)if(zg(r,B-e,B,e,s,o,w),(x=Ia(s,o,w[0],w[1]))<i){for(i=x,u=0;u<e;++u)n[u]=w[u];n.length=e,B+=e}else B+=e*Math.max((Math.sqrt(x)-Math.sqrt(i))/$|0,1);if(h&&(zg(r,a-e,t,e,s,o,w),(x=Ia(s,o,w[0],w[1]))<i)){for(i=x,u=0;u<e;++u)n[u]=w[u];n.length=e}return i}function Md(r,t,a,e,$,h,s,o,n,i,l){for(var u=l||[NaN,NaN],x=0,w=a.length;x<w;++x){var B=a[x];i=Ld(r,t,B,e,$,h,s,o,n,i,u),t=B}return i}function Pj(r,t,a,e,$,h,s,o,n,i,l){for(var u=l||[NaN,NaN],x=0,w=a.length;x<w;++x){var B=a[x];i=Md(r,t,B,e,$,h,s,o,n,i,u),t=B[B.length-1]}return i}function Ag(e,r,t,o){for(var n=0,a=t.length;n<a;++n)e[r++]=t[n];return r}function ic(e,r,t,o){for(var n=0,a=t.length;n<a;++n)for(var $=t[n],d=0;d<o;++d)e[r++]=$[d];return r}function Nd(e,r,t,o,n){for(var a=n||[],$=0,d=0,u=t.length;d<u;++d){var l=ic(e,r,t[d],o);a[$++]=l,r=l}return a.length=$,a}function Qj(e,r,t,o,n){for(var a=n||[],$=0,d=0,u=t.length;d<u;++d){var l=Nd(e,r,t[d],o,a[$]);a[$++]=l,r=l[l.length-1]}return a.length=$,a}function Hb(r,t,e,o,n){for(var a=void 0!==n?n:[],i=0,$=t;$<e;$+=o)a[i++]=r.slice($,$+o);return a.length=i,a}function jc(r,t,e,o,n){for(var a=void 0!==n?n:[],i=0,$=0,l=e.length;$<l;++$){var f=e[$];a[i++]=Hb(r,t,f,o,a[i]),t=f}return a.length=i,a}function Bg(r,t,e,o,n){for(var a=void 0!==n?n:[],i=0,$=0,l=e.length;$<l;++$){var f=e[$];a[i++]=jc(r,t,f,o,a[i]),t=f[f.length-1]}return a.length=i,a}function Od(r,$,e,t,a,o,n){var u=(e-$)/t;if(u<3){for(;$<e;$+=t)o[n++]=r[$],o[n++]=r[$+1];return n}var p=new Array(u);p[0]=1,p[u-1]=1;for(var i=[$,e-t],m=0;i.length>0;){for(var M=i.pop(),s=i.pop(),w=0,I=r[s],x=r[s+1],l=r[M],c=r[M+1],f=s+t;f<M;f+=t){var g=r[f],d=r[f+1],v=tj(g,d,I,x,l,c);v>w&&(m=f,w=v)}w>a&&(p[(m-$)/t]=1,s+t<m&&i.push(s,m),m+t<M&&i.push(m,M))}for(f=0;f<u;++f)p[f]&&(o[n++]=r[$+f*t],o[n++]=r[$+f*t+1]);return n}function Rj(r,$,e,t,a,o,n,u){for(var p=0,i=e.length;p<i;++p){var m=e[p];n=Od(r,$,m,t,a,o,n),u.push(n),$=m}return n}function Ma(r,$){return $*Math.round(r/$)}function Sj(r,$,e,t,a,o,n){if($==e)return n;var u,p,i=Ma(r[$],a),m=Ma(r[$+1],a);$+=t,o[n++]=i,o[n++]=m;do{if(u=Ma(r[$],a),p=Ma(r[$+1],a),($+=t)==e)return o[n++]=u,o[n++]=p,n}while(u==i&&p==m);for(;$<e;){var M=Ma(r[$],a),s=Ma(r[$+1],a);if($+=t,M!=u||s!=p){var w=u-i,I=p-m,x=M-i,l=s-m;w*l==I*x&&(w<0&&x<w||w==x||w>0&&x>w)&&(I<0&&l<I||I==l||I>0&&l>I)?(u=M,p=s):(o[n++]=u,o[n++]=p,i=u,m=p,u=M,p=s)}}return o[n++]=u,o[n++]=p,n}function Cg(r,$,e,t,a,o,n,u){for(var p=0,i=e.length;p<i;++p){var m=e[p];n=Sj(r,$,m,t,a,o,n),u.push(n),$=m}return n}function Tj(r,$,e,t,a,o,n,u){for(var p=0,i=e.length;p<i;++p){var m=e[p],M=[];n=Cg(r,$,m,t,a,o,n,M),u.push(M),$=m[m.length-1]}return n}var Uj=wd&&wd.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),Pd=function(t){function e(e,o){var r=t.call(this)||this;return r.maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===o||Array.isArray(e[0])?r.setCoordinates(e,o):r.setFlatCoordinates(o,e),r}return Uj(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,o,r){return r<Za(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ld(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,o,r))},e.prototype.getArea=function(){return xg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return Hb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var o=[];return o.length=Od(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,o,0),new e(o,p.XY)},e.prototype.getType=function(){return k.LINEAR_RING},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ic(this.flatCoordinates,0,t,this.stride),this.changed()},e}($);wd.default=Pd;var Qd={};var Vj=Qd&&Qd.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),va=function(t){function e(e,r){var o=t.call(this)||this;return o.setCoordinates(e,r),o}return Vj(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,o){var n=this.flatCoordinates,i=Ia(t,e,n[0],n[1]);if(i<o){for(var s=this.stride,a=0;a<s;++a)r[a]=n[a];return r.length=s,i}return o},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return ec(this.flatCoordinates,t)},e.prototype.getType=function(){return k.POINT},e.prototype.intersectsExtent=function(t){return sd(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ag(this.flatCoordinates,0,t,this.stride),this.changed()},e}($);Qd.default=va;function Wj(n,r,t,i,a){return!cg(a,function(a){return!Na(n,r,t,i,a[0],a[1])})}function Na(n,r,t,i,a,e){for(var $=0,o=n[t-i],s=n[t-i+1];r<t;r+=i){var l=n[r],g=n[r+1];s<=e?g>e&&(l-o)*(e-s)-(a-o)*(g-s)>0&&$++:g<=e&&(l-o)*(e-s)-(a-o)*(g-s)<0&&$--,o=l,s=g}return 0!==$}function Rd(n,r,t,i,a,e){if(0===t.length)return!1;if(!Na(n,r,t[0],i,a,e))return!1;for(var $=1,o=t.length;$<o;++$)if(Na(n,t[$-1],t[$],i,a,e))return!1;return!0}function Xj(n,r,t,i,a,e){if(0===t.length)return!1;for(var $=0,o=t.length;$<o;++$){var s=t[$];if(Rd(n,r,s,i,a,e))return!0;r=s[s.length-1]}return!1}function Dg(r,t,a,e,o,n,$){for(var i,p,m,s,f,u,g,V=o[n+1],l=[],x=0,y=a.length;x<y;++x){var h=a[x];for(s=r[h-e],u=r[h-e+1],i=t;i<h;i+=e)f=r[i],g=r[i+1],(V<=u&&g<=V||u<=V&&V<=g)&&(m=(V-u)/(g-u)*(f-s)+s,l.push(m)),s=f,u=g}var v=NaN,A=-1/0;for(l.sort(ra),s=l[0],i=1,p=l.length;i<p;++i){f=l[i];var I=Math.abs(f-s);I>A&&(m=(s+f)/2,Rd(r,t,a,e,m,V)&&(v=m,A=I)),s=f}return isNaN(v)&&(v=o[n]),$?($.push(v,V,A),$):[v,V,A]}function Yj(r,t,a,e,o){for(var n=[],$=0,i=a.length;$<i;++$){var p=a[$];n=Dg(r,t,p,e,o,2*$,n),t=p[p.length-1]}return n}function kc(r,t,e,n,i){var $=bg(ea(),r,t,e,n);return!!fa(i,$)&&(!!Z(i,$)||$[0]>=i[0]&&$[2]<=i[2]||$[1]>=i[1]&&$[3]<=i[3]||Fg(r,t,e,n,function(r,t){return mj(i,r,t)}))}function Zj(r,t,e,n,i){for(var $=0,a=e.length;$<a;++$){if(kc(r,t,e[$],n,i))return!0;t=e[$]}return!1}function $j(r,t,e,n,i){return!!kc(r,t,e,n,i)||!!Na(r,t,e,n,i[0],i[1])||!!Na(r,t,e,n,i[0],i[3])||!!Na(r,t,e,n,i[2],i[1])||!!Na(r,t,e,n,i[2],i[3])}function Eg(r,t,e,n,i){if(!$j(r,t,e[0],n,i))return!1;if(1===e.length)return!0;for(var $=1,a=e.length;$<a;++$)if(Wj(r,e[$-1],e[$],n,i)&&!kc(r,e[$-1],e[$],n,i))return!1;return!0}function _j(r,t,e,n,i){for(var $=0,a=e.length;$<a;++$){var s=e[$];if(Eg(r,t,s,n,i))return!0;t=s[s.length-1]}return!1}function Fg(r,$,o,p,t){for(var e,f=[r[$],r[$+1]],s=[];$+p<o;$+=p){if(s[0]=r[$+p],s[1]=r[$+p+1],e=t(f,s))return e;f[0]=s[0],f[1]=s[1]}return!1}function Gg(r,e,n,i){for(var $=0,t=r[n-i],o=r[n-i+1];e<n;e+=i){var p=r[e],x=r[e+1];$+=(p-t)*(x+o),t=p,o=x}return $>0}function Hg(r,e,n,i,$){for(var t=void 0!==$&&$,o=0,p=n.length;o<p;++o){var x=n[o],s=Gg(r,e,x,i);if(0===o){if(t&&s||!t&&!s)return!1}else if(t&&!s||!t&&s)return!1;e=x}return!0}function ak(r,e,n,i,$){for(var t=0,o=n.length;t<o;++t){var p=n[t];if(!Hg(r,e,p,i,$))return!1;p.length&&(e=p[p.length-1])}return!0}function Sd(r,e,n,i,$){for(var t=void 0!==$&&$,o=0,p=n.length;o<p;++o){var x=n[o],s=Gg(r,e,x,i);(0===o?t&&s||!t&&!s:t&&!s||!t&&s)&&bk(r,e,x,i),e=x}return e}function Ig(r,e,n,i,$){for(var t=0,o=n.length;t<o;++t)e=Sd(r,e,n[t],i,$);return e}function bk(o,r,e,$){for(;r<e-$;){for(var t=0;t<$;++t){var a=o[r+t];o[r+t]=o[e-$+t],o[e-$+t]=a}r+=$,e-=$}}var ck=Ea&&Ea.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ia=function(t){function e(e,r,i){var o=t.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,void 0!==r&&i?(o.setFlatCoordinates(r,e),o.ends_=i):o.setCoordinates(e,r),o}return ck(e,t),e.prototype.appendLinearRing=function(t){this.flatCoordinates?K(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,i){return i<Za(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Md(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,i))},e.prototype.containsXY=function(t,e){return Rd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return yg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Sd(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,jc(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=zb(this.getExtent());this.flatInteriorPoint_=Dg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new va(this.getFlatInteriorPoint(),p.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new Pd(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.ends_,i=[],o=0,n=0,s=r.length;n<s;++n){var a=r[n],l=new Pd(e.slice(o,a),t);i.push(l),o=a}return i},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Hg(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Sd(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],i=[];return r.length=Cg(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,i),new e(r,p.XY,i)},e.prototype.getType=function(){return k.POLYGON},e.prototype.intersectsExtent=function(t){return Eg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Nd(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}($);function dk(t,e,r,i){for(var o=r||32,n=[],s=0;s<o;++s)K(n,xj(t,e,2*Math.PI*s/o,i));return n.push(n[0],n[1]),new ia(n,p.XY,[n.length])}function Oa(t){var e=t[0],r=t[1],i=t[2],o=t[3],n=[e,r,e,o,i,o,i,r,e,r];return new ia(n,p.XY,[n.length])}function Td(t,e,r){for(var i=e||32,o=t.getStride(),n=t.getLayout(),s=t.getCenter(),a=o*(i+1),l=new Array(a),$=0;$<a;$+=o){l[$]=0,l[$+1]=0;for(var p=2;p<o;p++)l[$+p]=s[p]}var h=[l.length],d=new ia(l,n,h);return Ud(d,s,t.getRadius(),r),d}function Ud(t,e,r,i){for(var o=t.getFlatCoordinates(),n=t.getStride(),s=o.length/n-1,a=i||0,l=0;l<=s;++l){var $=l*n,p=a+2*Ja(l,s)*Math.PI/s;o[$]=e[0]+r*Math.cos(p),o[$+1]=e[1]+r*Math.sin(p)}t.changed()}Ea.default=ia,Ea.circular=dk,Ea.fromExtent=Oa,Ea.fromCircle=Td,Ea.makeRegular=Ud;var Vd={};var Wd={};var lc={};var Xd={};var h={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source"};var ek=Xd&&Xd.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Yd=function(t){function o(o){var e=t.call(this)||this,r=G({},o);return r[h.OPACITY]=void 0!==o.opacity?o.opacity:1,g("number"==typeof r[h.OPACITY],64),r[h.VISIBLE]=void 0===o.visible||o.visible,r[h.Z_INDEX]=o.zIndex,r[h.MAX_RESOLUTION]=void 0!==o.maxResolution?o.maxResolution:1/0,r[h.MIN_RESOLUTION]=void 0!==o.minResolution?o.minResolution:0,r[h.MIN_ZOOM]=void 0!==o.minZoom?o.minZoom:-1/0,r[h.MAX_ZOOM]=void 0!==o.maxZoom?o.maxZoom:1/0,e.className_=void 0!==r.className?o.className:"ol-layer",delete r.className,e.setProperties(r),e.state_=null,e}return ek(o,t),o.prototype.getClassName=function(){return this.className_},o.prototype.getLayerState=function(t){var o=this.state_||{layer:this,managed:void 0===t||t},e=this.getZIndex();return o.opacity=z(Math.round(100*this.getOpacity())/100,0,1),o.sourceState=this.getSourceState(),o.visible=this.getVisible(),o.extent=this.getExtent(),o.zIndex=void 0!==e?e:!1===o.managed?1/0:0,o.maxResolution=this.getMaxResolution(),o.minResolution=Math.max(this.getMinResolution(),0),o.minZoom=this.getMinZoom(),o.maxZoom=this.getMaxZoom(),this.state_=o,o},o.prototype.getLayersArray=function(t){return c()},o.prototype.getLayerStatesArray=function(t){return c()},o.prototype.getExtent=function(){return this.get(h.EXTENT)},o.prototype.getMaxResolution=function(){return this.get(h.MAX_RESOLUTION)},o.prototype.getMinResolution=function(){return this.get(h.MIN_RESOLUTION)},o.prototype.getMinZoom=function(){return this.get(h.MIN_ZOOM)},o.prototype.getMaxZoom=function(){return this.get(h.MAX_ZOOM)},o.prototype.getOpacity=function(){return this.get(h.OPACITY)},o.prototype.getSourceState=function(){return c()},o.prototype.getVisible=function(){return this.get(h.VISIBLE)},o.prototype.getZIndex=function(){return this.get(h.Z_INDEX)},o.prototype.setExtent=function(t){this.set(h.EXTENT,t)},o.prototype.setMaxResolution=function(t){this.set(h.MAX_RESOLUTION,t)},o.prototype.setMinResolution=function(t){this.set(h.MIN_RESOLUTION,t)},o.prototype.setMaxZoom=function(t){this.set(h.MAX_ZOOM,t)},o.prototype.setMinZoom=function(t){this.set(h.MIN_ZOOM,t)},o.prototype.setOpacity=function(t){g("number"==typeof t,64),this.set(h.OPACITY,t)},o.prototype.setVisible=function(t){this.set(h.VISIBLE,t)},o.prototype.setZIndex=function(t){this.set(h.Z_INDEX,t)},o.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},o}(e);Xd.default=Yd;var Pa={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var Qa={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};var fk=lc&&lc.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),Zd=function(e){function r(r){var t=this,n=G({},r);delete n.source,(t=e.call(this,n)||this).mapPrecomposeKey_=null,t.mapRenderKey_=null,t.sourceChangeKey_=null,t.renderer_=null,r.render&&(t.render=r.render),r.map&&t.setMap(r.map),t.addEventListener(l(h.SOURCE),t.handleSourcePropertyChange_);var o=r.source?r.source:null;return t.setSource(o),t}return fk(r,e),r.prototype.getLayersArray=function(e){var r=e||[];return r.push(this),r},r.prototype.getLayerStatesArray=function(e){var r=e||[];return r.push(this.getLayerState()),r},r.prototype.getSource=function(){return this.get(h.SOURCE)||null},r.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():Qa.UNDEFINED},r.prototype.handleSourceChange_=function(){this.changed()},r.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(d(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=a(e,f.CHANGE,this.handleSourceChange_,this)),this.changed()},r.prototype.getFeatures=function(e){return this.renderer_.getFeatures(e)},r.prototype.render=function(e,r){var t=this.getRenderer();if(t.prepareFrame(e))return t.renderFrame(e,r)},r.prototype.setMap=function(e){this.mapPrecomposeKey_&&(d(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(d(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=a(e,Pa.PRECOMPOSE,function(e){var r=e.frameState.layerStatesArray,t=this.getLayerState(!1);g(!r.some(function(e){return e.layer===t.layer}),67),r.push(t)},this),this.mapRenderKey_=a(this,f.CHANGE,e.render,e),this.changed())},r.prototype.setSource=function(e){this.set(h.SOURCE,e)},r.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},r.prototype.hasRenderer=function(){return!!this.renderer_},r.prototype.createRenderer=function(){return null},r.prototype.disposeInternal=function(){this.setSource(null),e.prototype.disposeInternal.call(this)},r}(Yd);function Ib(e,r){if(!e.visible)return!1;var t=r.resolution;if(t<e.minResolution||t>=e.maxResolution)return!1;var n=r.zoom;return n>e.minZoom&&n<=e.maxZoom}lc.inView=Ib,lc.default=Zd;var $d={};var _d={};var gk=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,hk=/^([a-z]*)$|^hsla?\(.*\)$/i;function ik(r){return"string"==typeof r?r:Lg(r)}function jk(r){var $=document.createElement("div");if($.style.color=r,""!==$.style.color){document.body.appendChild($);var a=getComputedStyle($).color;return document.body.removeChild($),a}return""}var kk=function(){var r={},$=0;return function(a){var t;if(r.hasOwnProperty(a))t=r[a];else{if($>=1024){var e=0;for(var X in r)0==(3&e++)&&(delete r[X],--$)}t=lk(a),r[a]=t,++$}return t}}();function Jg(r){return Array.isArray(r)?r:kk(r)}function lk(r){var $,a,t,e,X;if(hk.exec(r)&&(r=jk(r)),gk.exec(r)){var o=r.length-1,n=void 0;n=o<=4?1:2;var i=4===o||8===o;$=parseInt(r.substr(1+0*n,n),16),a=parseInt(r.substr(1+1*n,n),16),t=parseInt(r.substr(1+2*n,n),16),e=i?parseInt(r.substr(1+3*n,n),16):255,1==n&&($=($<<4)+$,a=(a<<4)+a,t=(t<<4)+t,i&&(e=(e<<4)+e)),X=[$,a,t,e/255]}else 0==r.indexOf("rgba(")?Kg(X=r.slice(5,-1).split(",").map(Number)):0==r.indexOf("rgb(")?((X=r.slice(4,-1).split(",").map(Number)).push(1),Kg(X)):g(!1,14);return X}function Kg(r){return r[0]=z(r[0]+.5|0,0,255),r[1]=z(r[1]+.5|0,0,255),r[2]=z(r[2]+.5|0,0,255),r[3]=z(r[3],0,1),r}function Lg(r){var $=r[0];$!=(0|$)&&($=$+.5|0);var a=r[1];a!=(0|a)&&(a=a+.5|0);var t=r[2];return t!=(0|t)&&(t=t+.5|0),"rgba("+$+","+a+","+t+","+(void 0===r[3]?1:r[3])+")"}function T(r){return Array.isArray(r)?Lg(r):r}function J(e,t,r){var o=r&&r.length?r.shift():document.createElement("canvas");return e&&(o.width=e),t&&(o.height=t),o.getContext("2d")}function mk(e){var t=e.offsetWidth,r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10)}function nk(e){var t=e.offsetHeight,r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10)}function gb(e,t){var r=t.parentNode;r&&r.replaceChild(e,t)}function mc(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function Mg(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function ok(e,t){for(var r=e.childNodes,o=0;;++o){var $=r[o],n=t[o];if(!$&&!n)break;$!==n&&($?n?e.insertBefore(n,$):(e.removeChild($),--o):e.appendChild(n))}}var m={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};var nc="ol-hidden";var pk="ol-selectable";var S="ol-unselectable";var qk="ol-unsupported";var Ra="ol-control";var oc="ol-collapsed";var rk=function(){var $,e={};return function(t){if($||($=document.createElement("div").style),!(t in e)){$.font=t;var S=$.fontFamily,r=$.fontWeight,n=$.fontStyle;if($.font="",!S)return null;var o=S.split(/,\s?/);e[t]={families:o,weight:r,style:n}}return e[t]}}();var Ng="10px sans-serif";var ja="#000";var hb="round";var pc=[];var qc=0;var ib="round";var Jb=10;var Kb="#000";var Lb="center";var rc="middle";var jb=[0,0,0,0];var Mb=1;var ka=new e;var sk=new Da;sk.setSize=function(){console.warn("labelCache is deprecated.")};var tk,sc=null,Og={};var uk=function(){var e,t,$=100,r="32px ",a=["monospace","serif"],o=a.length,n="wmytzilWMYTZIL@#/&?$%10\uF013";function s(e,$,s){for(var i=!0,x=0;x<o;++x){var p=a[x];if(t=tc(e+" "+$+" "+r+p,n),s!=p){var l=tc(e+" "+$+" "+r+s+","+p,n);i=i&&l!=t}}return!!i}function i(){for(var t=!0,r=ka.getKeys(),a=0,o=r.length;a<o;++a){var n=r[a];ka.get(n)<$&&(s.apply(this,n.split("\n"))?(Xa(Og),sc=null,tk=void 0,ka.set(n,$)):(ka.set(n,ka.get(n)+1,!0),t=!1))}t&&(clearInterval(e),e=void 0)}return function(t){var r=rk(t);if(r)for(var a=r.families,o=0,n=a.length;o<n;++o){var x=a[o],p=r.style+"\n"+r.weight+"\n"+x;void 0===ka.get(p)&&(ka.set(p,$,!0),s(r.style,r.weight,x)||(ka.set(p,0,!0),void 0===e&&(e=setInterval(i,32))))}}}();var vk=function(){var e,t=Og;return function($){var r=t[$];return null==r&&(e||((e=document.createElement("div")).innerHTML="M",e.style.margin="0 !important",e.style.padding="0 !important",e.style.position="absolute !important",e.style.left="-99999px !important"),e.style.font=$,document.body.appendChild(e),r=e.offsetHeight,t[$]=r,document.body.removeChild(e)),r}}();function tc(e,t){return sc||(sc=J(1,1)),e!=tk&&(sc.font=e,tk=sc.font),sc.measureText(t).width}function Pg(e,t,$){if(t in $)return $[t];var r=tc(e,t);return $[t]=r,r}function wk(e,t,$){for(var r=t.length,a=0,o=0;o<r;++o){var n=tc(e,t[o]);a=Math.max(a,n),$.push(n)}return a}function Qg(e,t,$,r){0!==t&&(e.translate($,r),e.rotate(t),e.translate(-$,-r))}function Rg(e,t,$,r,a,o,n,s,i,x,p){e.save(),1!==$&&(e.globalAlpha*=$),t&&e.setTransform.apply(e,t),r.contextInstructions?(e.translate(i,x),e.scale(p,p),xk(r,e)):e.drawImage(r,a,o,n,s,i,x,n*p,s*p),e.restore()}function xk(e,t){for(var $=e.contextInstructions,r=0,a=$.length;r<a;r+=2)Array.isArray($[r+1])?CanvasRenderingContext2D.prototype[$[r]].apply(t,$[r+1]):t[$[r]]=$[r+1]}var Sg=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.displacement_=t.displacement}return t.prototype.clone=function(){return new t({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getDisplacement=function(){return this.displacement_},t.prototype.getAnchor=function(){return c()},t.prototype.getImage=function(t){return c()},t.prototype.getHitDetectionImage=function(t){return c()},t.prototype.getImageState=function(){return c()},t.prototype.getImageSize=function(){return c()},t.prototype.getHitDetectionImageSize=function(){return c()},t.prototype.getOrigin=function(){return c()},t.prototype.getSize=function(){return c()},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t},t.prototype.listenImageChange=function(t){c()},t.prototype.load=function(){c()},t.prototype.unlistenImageChange=function(t){c()},t}();var yk=_d&&_d.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),Tg=function(t){function i(i){var e=this,s=void 0!==i.rotateWithView&&i.rotateWithView;return(e=t.call(this,{opacity:1,rotateWithView:s,rotation:void 0!==i.rotation?i.rotation:0,scale:1,displacement:void 0!==i.displacement?i.displacement:[0,0]})||this).canvas_=null,e.hitDetectionCanvas_=null,e.fill_=void 0!==i.fill?i.fill:null,e.origin_=[0,0],e.points_=i.points,e.radius_=void 0!==i.radius?i.radius:i.radius1,e.radius2_=i.radius2,e.angle_=void 0!==i.angle?i.angle:0,e.stroke_=void 0!==i.stroke?i.stroke:null,e.anchor_=null,e.size_=null,e.imageSize_=null,e.hitDetectionImageSize_=null,e.render(),e}return yk(i,t),i.prototype.clone=function(){var t=new i({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},i.prototype.getAnchor=function(){return this.anchor_},i.prototype.getAngle=function(){return this.angle_},i.prototype.getFill=function(){return this.fill_},i.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_},i.prototype.getImage=function(t){return this.canvas_},i.prototype.getImageSize=function(){return this.imageSize_},i.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},i.prototype.getImageState=function(){return m.LOADED},i.prototype.getOrigin=function(){return this.origin_},i.prototype.getPoints=function(){return this.points_},i.prototype.getRadius=function(){return this.radius_},i.prototype.getRadius2=function(){return this.radius2_},i.prototype.getSize=function(){return this.size_},i.prototype.getStroke=function(){return this.stroke_},i.prototype.listenImageChange=function(t){},i.prototype.load=function(){},i.prototype.unlistenImageChange=function(t){},i.prototype.render=function(){var t,i=hb,e=ib,s=0,r=null,o=0,n=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=Kb),t=T(t),void 0===(n=this.stroke_.getWidth())&&(n=Mb),r=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=ib),void 0===(i=this.stroke_.getLineCap())&&(i=hb),void 0===(s=this.stroke_.getMiterLimit())&&(s=Jb));var a=2*(this.radius_+n)+1,l={strokeStyle:t,strokeWidth:n,size:a,lineCap:i,lineDash:r,lineDashOffset:o,lineJoin:e,miterLimit:s},h=J(a,a);this.canvas_=h.canvas;var u=a=this.canvas_.width,p=this.getDisplacement();this.draw_(l,h,0,0),this.createHitDetectionCanvas_(l),this.anchor_=[a/2-p[0],a/2+p[1]],this.size_=[a,a],this.imageSize_=[u,u]},i.prototype.draw_=function(t,i,e,s){var r,o,n;i.setTransform(1,0,0,1,0,0),i.translate(e,s),i.beginPath();var a=this.points_;if(a===1/0)i.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var l=void 0!==this.radius2_?this.radius2_:this.radius_;for(l!==this.radius_&&(a*=2),r=0;r<=a;r++)o=2*r*Math.PI/a-Math.PI/2+this.angle_,n=r%2==0?this.radius_:l,i.lineTo(t.size/2+n*Math.cos(o),t.size/2+n*Math.sin(o))}if(this.fill_){var h=this.fill_.getColor();null===h&&(h=ja),i.fillStyle=T(h),i.fill()}this.stroke_&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,i.setLineDash&&t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineCap=t.lineCap,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke()),i.closePath()},i.prototype.createHitDetectionCanvas_=function(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.hitDetectionCanvas_=this.canvas_,this.fill_){var i=this.fill_.getColor(),e=0;if("string"==typeof i&&(i=Jg(i)),null===i?e=1:Array.isArray(i)&&(e=4===i.length?i[3]:1),0===e){var s=J(t.size,t.size);this.hitDetectionCanvas_=s.canvas,this.drawHitDetectionCanvas_(t,s,0,0)}}},i.prototype.drawHitDetectionCanvas_=function(t,i,e,s){i.setTransform(1,0,0,1,0,0),i.translate(e,s),i.beginPath();var r=this.points_;if(r===1/0)i.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var o=void 0!==this.radius2_?this.radius2_:this.radius_;o!==this.radius_&&(r*=2);var n=void 0,a=void 0,l=void 0;for(n=0;n<=r;n++)l=2*n*Math.PI/r-Math.PI/2+this.angle_,a=n%2==0?this.radius_:o,i.lineTo(t.size/2+a*Math.cos(l),t.size/2+a*Math.sin(l))}i.fillStyle=ja,i.fill(),this.stroke_&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.stroke()),i.closePath()},i}(Sg);_d.default=Tg;var zk=$d&&$d.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function s(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),ae=function(t){function e(e){var r=e||{};return t.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,displacement:void 0!==r.displacement?r.displacement:[0,0]})||this}return zk(e,t),e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),displacement:this.getDisplacement().slice()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(Tg);$d.default=ae;var be=function(){function o(o){var r=o||{};this.color_=void 0!==r.color?r.color:null}return o.prototype.clone=function(){var r=this.getColor();return new o({color:Array.isArray(r)?r.slice():r||void 0})},o.prototype.getColor=function(){return this.color_},o.prototype.setColor=function(o){this.color_=o},o}();var uc=function(){function t(t){var i=t||{};this.color_=void 0!==i.color?i.color:null,this.lineCap_=i.lineCap,this.lineDash_=void 0!==i.lineDash?i.lineDash:null,this.lineDashOffset_=i.lineDashOffset,this.lineJoin_=i.lineJoin,this.miterLimit_=i.miterLimit,this.width_=i.width}return t.prototype.clone=function(){var i=this.getColor();return new t({color:Array.isArray(i)?i.slice():i||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}();var Nb=function(){function t(t){var e=t||{};this.geometry_=null,this.geometryFunction_=Vg,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return t.prototype.clone=function(){var e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.setRenderer=function(t){this.renderer_=t},t.prototype.getGeometry=function(){return this.geometry_},t.prototype.getGeometryFunction=function(){return this.geometryFunction_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(t){this.fill_=t},t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(t){this.image_=t},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.getText=function(){return this.text_},t.prototype.setText=function(t){this.text_=t},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Vg,this.geometry_=t},t.prototype.setZIndex=function(t){this.zIndex_=t},t}();function Ak(t){var e;if("function"==typeof t)e=t;else{var r;if(Array.isArray(t))r=t;else g("function"==typeof t.getZIndex,41),r=[t];e=function(){return r}}return e}var Ug=null;function Bk(t,e){if(!Ug){var r=new be({color:"rgba(255,255,255,0.4)"}),o=new uc({color:"#3399CC",width:1.25});Ug=[new Nb({image:new ae({fill:r,stroke:o,radius:5}),fill:r,stroke:o})]}return Ug}function Ob(){var t={},e=[255,255,255,1],r=[0,153,255,1];return t[k.POLYGON]=[new Nb({fill:new be({color:[255,255,255,.5]})})],t[k.MULTI_POLYGON]=t[k.POLYGON],t[k.LINE_STRING]=[new Nb({stroke:new uc({color:e,width:5})}),new Nb({stroke:new uc({color:r,width:3})})],t[k.MULTI_LINE_STRING]=t[k.LINE_STRING],t[k.CIRCLE]=t[k.POLYGON].concat(t[k.LINE_STRING]),t[k.POINT]=[new Nb({image:new ae({radius:6,fill:new be({color:r}),stroke:new uc({color:e,width:1.5})}),zIndex:1/0})],t[k.MULTI_POINT]=t[k.POINT],t[k.GEOMETRY_COLLECTION]=t[k.POLYGON].concat(t[k.LINE_STRING],t[k.POINT]),t}function Vg(t){return t.getGeometry()}var Ck=Wd&&Wd.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wg={RENDER_ORDER:"renderOrder"},Xg=function(t){function e(e){var r=this,n=e||{},i=G({},n);return delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,(r=t.call(this,i)||this).declutter_=void 0!==n.declutter&&n.declutter,r.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,r.style_=null,r.styleFunction_=void 0,r.setStyle(n.style),r.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,r.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,r}return Ck(e,t),e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(Wg.RENDER_ORDER)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.setRenderOrder=function(t){this.set(Wg.RENDER_ORDER,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:Bk,this.styleFunction_=null===t?void 0:Ak(this.style_),this.changed()},e}(Zd);Wd.default=Xg;var ce={};var B={ANIMATING:0,INTERACTING:1};var de={};var Yg=function(){function t(){}return t.prototype.drawCustom=function(t,o,e){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,o){},t.prototype.drawFeature=function(t,o){},t.prototype.drawGeometryCollection=function(t,o){},t.prototype.drawLineString=function(t,o){},t.prototype.drawMultiLineString=function(t,o){},t.prototype.drawMultiPoint=function(t,o){},t.prototype.drawMultiPolygon=function(t,o){},t.prototype.drawPoint=function(t,o){},t.prototype.drawPolygon=function(t,o){},t.prototype.drawText=function(t,o){},t.prototype.setFillStrokeStyle=function(t,o){},t.prototype.setImageStyle=function(t,o){},t.prototype.setTextStyle=function(t,o){},t}();var aa={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},vc=[aa.FILL];var wa=[aa.STROKE];var Sa=[aa.BEGIN_PATH];var Zg=[aa.CLOSE_PATH];var Dk=de&&de.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),kb=function(t){function e(e,i,n,r){var o=t.call(this)||this;return o.tolerance=e,o.maxExtent=i,o.pixelRatio=r,o.maxLineWidth=0,o.resolution=n,o.beginGeometryInstruction1_=null,o.beginGeometryInstruction2_=null,o.bufferedMaxExtent_=null,o.instructions=[],o.coordinates=[],o.tmpCoordinate_=[],o.hitDetectionInstructions=[],o.state={},o}return Dk(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},e.prototype.appendFlatCoordinates=function(t,e,i,n,r,o){var s=this.coordinates.length,a=this.getBufferedMaxExtent();o&&(e+=n);var u,$,l,p=t[e],c=t[e+1],h=this.tmpCoordinate_,d=!0;for(u=e+n;u<i;u+=n)h[0]=t[u],h[1]=t[u+1],(l=td(a,h))!==$?(d&&(this.coordinates[s++]=p,this.coordinates[s++]=c),this.coordinates[s++]=h[0],this.coordinates[s++]=h[1],d=!1):l===v.INTERSECTING?(this.coordinates[s++]=h[0],this.coordinates[s++]=h[1],d=!1):d=!0,p=h[0],c=h[1],$=l;return(r&&d||u===e+n)&&(this.coordinates[s++]=p,this.coordinates[s++]=c),s},e.prototype.drawCustomCoordinates_=function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o],u=this.appendFlatCoordinates(t,e,a,n,!1,!1);r.push(u),e=a}return e},e.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var n,r,o,s,a,u=t.getType(),$=t.getStride(),l=this.coordinates.length;if(u==k.MULTI_POLYGON){n=(t=t).getOrientedFlatCoordinates(),s=[];var p=t.getEndss();a=0;for(var c=0,h=p.length;c<h;++c){var d=[];a=this.drawCustomCoordinates_(n,a,p[c],$,d),s.push(d)}this.instructions.push([aa.CUSTOM,l,s,t,i,Bg])}else u==k.POLYGON||u==k.MULTI_LINE_STRING?(o=[],n=u==k.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),a=this.drawCustomCoordinates_(n,0,t.getEnds(),$,o),this.instructions.push([aa.CUSTOM,l,o,t,i,jc])):u==k.LINE_STRING||u==k.MULTI_POINT?(n=t.getFlatCoordinates(),r=this.appendFlatCoordinates(n,0,n.length,$,!1,!1),this.instructions.push([aa.CUSTOM,l,r,t,i,Hb])):u==k.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),r=this.coordinates.length,this.instructions.push([aa.CUSTOM,l,r,t,i]));this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){var i=t.getExtent();this.beginGeometryInstruction1_=[aa.BEGIN_GEOMETRY,e,0,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[aa.BEGIN_GEOMETRY,e,0,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,n,r=e.length,o=-1;for(t=0;t<r;++t)(n=(i=e[t])[0])==aa.END_GEOMETRY?o=t:n==aa.BEGIN_GEOMETRY&&(i[2]=t,_i(this.hitDetectionInstructions,o,t),o=-1)},e.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var n=t.getColor();i.fillStyle=T(n||ja)}else i.fillStyle=void 0;if(e){var r=e.getColor();i.strokeStyle=T(r||Kb);var o=e.getLineCap();i.lineCap=void 0!==o?o:hb;var s=e.getLineDash();i.lineDash=s?s.slice():pc;var a=e.getLineDashOffset();i.lineDashOffset=a||qc;var u=e.getLineJoin();i.lineJoin=void 0!==u?u:ib;var $=e.getWidth();i.lineWidth=void 0!==$?$:Mb;var l=e.getMiterLimit();i.miterLimit=void 0!==l?l:Jb,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,i=[aa.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[aa.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},e.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!Ya(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=u)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=s,t.currentLineWidth=a,t.currentMiterLimit=u)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[aa.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Zf(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;dc(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(Yg);de.default=kb;var ee={};var Ek=ee&&ee.__extends||function(){var t=function(i,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])})(i,o)};return function(i,o){function e(){this.constructor=i}t(i,o),i.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}(),$g=function(t){function i(i,o,e,h){var s=t.call(this,i,o,e,h)||this;return s.declutterGroups_=null,s.hitDetectionImage_=null,s.image_=null,s.anchorX_=void 0,s.anchorY_=void 0,s.height_=void 0,s.opacity_=void 0,s.originX_=void 0,s.originY_=void 0,s.rotateWithView_=void 0,s.rotation_=void 0,s.scale_=void 0,s.width_=void 0,s}return Ek(i,t),i.prototype.drawCoordinates_=function(t,i,o,e){return this.appendFlatCoordinates(t,i,o,e,!1,!1)},i.prototype.drawPoint=function(t,i){if(this.image_){this.beginGeometry(t,i);var o=t.getFlatCoordinates(),e=t.getStride(),h=this.coordinates.length,s=this.drawCoordinates_(o,0,o.length,e);this.instructions.push([aa.DRAW_IMAGE,h,s,this.image_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([aa.DRAW_IMAGE,h,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(i)}},i.prototype.drawMultiPoint=function(t,i){if(this.image_){this.beginGeometry(t,i);var o=t.getFlatCoordinates(),e=t.getStride(),h=this.coordinates.length,s=this.drawCoordinates_(o,0,o.length,e);this.instructions.push([aa.DRAW_IMAGE,h,s,this.image_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([aa.DRAW_IMAGE,h,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(i)}},i.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,t.prototype.finish.call(this)},i.prototype.setImageStyle=function(t,i){var o=t.getAnchor(),e=t.getSize(),h=t.getHitDetectionImage(1),s=t.getImage(1),r=t.getOrigin();this.anchorX_=o[0],this.anchorY_=o[1],this.declutterGroups_=i,this.hitDetectionImage_=h,this.image_=s,this.height_=e[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.width_=e[0]},i}(kb);ee.default=$g;var fe={};var Fk=fe&&fe.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),_g=function(t){function i(i,e,n,o){return t.call(this,i,e,n,o)||this}return Fk(i,t),i.prototype.drawFlatCoordinates_=function(t,i,e,n){var o=this.coordinates.length,r=this.appendFlatCoordinates(t,i,e,n,!1,!1),s=[aa.MOVE_TO_LINE_TO,o,r];return this.instructions.push(s),this.hitDetectionInstructions.push(s),e},i.prototype.drawLineString=function(t,i){var e=this.state,n=e.strokeStyle,o=e.lineWidth;if(void 0!==n&&void 0!==o){this.updateStrokeStyle(e,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([aa.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash,e.lineDashOffset],Sa);var r=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(r,0,r.length,s),this.hitDetectionInstructions.push(wa),this.endGeometry(i)}},i.prototype.drawMultiLineString=function(t,i){var e=this.state,n=e.strokeStyle,o=e.lineWidth;if(void 0!==n&&void 0!==o){this.updateStrokeStyle(e,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([aa.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash,e.lineDashOffset],Sa);for(var r=t.getEnds(),s=t.getFlatCoordinates(),u=t.getStride(),a=0,h=0,p=r.length;h<p;++h)a=this.drawFlatCoordinates_(s,a,r[h],u);this.hitDetectionInstructions.push(wa),this.endGeometry(i)}},i.prototype.finish=function(){var i=this.state;return null!=i.lastStroke&&i.lastStroke!=this.coordinates.length&&this.instructions.push(wa),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},i.prototype.applyStroke=function(i){null!=i.lastStroke&&i.lastStroke!=this.coordinates.length&&(this.instructions.push(wa),i.lastStroke=this.coordinates.length),i.lastStroke=0,t.prototype.applyStroke.call(this,i),this.instructions.push(Sa)},i}(kb);fe.default=_g;var ge={};var Gk=ge&&ge.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),he=function(t){function i(i,e,s,o){return t.call(this,i,e,s,o)||this}return Gk(i,t),i.prototype.drawFlatCoordinatess_=function(t,i,e,s){var o=this.state,n=void 0!==o.fillStyle,r=void 0!==o.strokeStyle,l=e.length;this.instructions.push(Sa),this.hitDetectionInstructions.push(Sa);for(var h=0;h<l;++h){var a=e[h],$=this.coordinates.length,u=this.appendFlatCoordinates(t,i,a,s,!0,!r),d=[aa.MOVE_TO_LINE_TO,$,u];this.instructions.push(d),this.hitDetectionInstructions.push(d),r&&(this.instructions.push(Zg),this.hitDetectionInstructions.push(Zg)),i=a}return n&&(this.instructions.push(vc),this.hitDetectionInstructions.push(vc)),r&&(this.instructions.push(wa),this.hitDetectionInstructions.push(wa)),i},i.prototype.drawCircle=function(t,i){var e=this.state,s=e.fillStyle,o=e.strokeStyle;if(void 0!==s||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,i),void 0!==e.fillStyle&&this.hitDetectionInstructions.push([aa.SET_FILL_STYLE,ja]),void 0!==e.strokeStyle&&this.hitDetectionInstructions.push([aa.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash,e.lineDashOffset]);var n=t.getFlatCoordinates(),r=t.getStride(),l=this.coordinates.length;this.appendFlatCoordinates(n,0,n.length,r,!1,!1);var h=[aa.CIRCLE,l];this.instructions.push(Sa,h),this.hitDetectionInstructions.push(Sa,h),void 0!==e.fillStyle&&(this.instructions.push(vc),this.hitDetectionInstructions.push(vc)),void 0!==e.strokeStyle&&(this.instructions.push(wa),this.hitDetectionInstructions.push(wa)),this.endGeometry(i)}},i.prototype.drawPolygon=function(t,i){var e=this.state,s=e.fillStyle,o=e.strokeStyle;if(void 0!==s||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,i),void 0!==e.fillStyle&&this.hitDetectionInstructions.push([aa.SET_FILL_STYLE,ja]),void 0!==e.strokeStyle&&this.hitDetectionInstructions.push([aa.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash,e.lineDashOffset]);var n=t.getEnds(),r=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(r,0,n,l),this.endGeometry(i)}},i.prototype.drawMultiPolygon=function(t,i){var e=this.state,s=e.fillStyle,o=e.strokeStyle;if(void 0!==s||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,i),void 0!==e.fillStyle&&this.hitDetectionInstructions.push([aa.SET_FILL_STYLE,ja]),void 0!==e.strokeStyle&&this.hitDetectionInstructions.push([aa.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash,e.lineDashOffset]);for(var n=t.getEndss(),r=t.getOrientedFlatCoordinates(),l=t.getStride(),h=0,a=0,$=n.length;a<$;++a)h=this.drawFlatCoordinatess_(r,h,n[a],l);this.endGeometry(i)}},i.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var i=this.tolerance;if(0!==i)for(var e=this.coordinates,s=0,o=e.length;s<o;++s)e[s]=Ma(e[s],i);return t.prototype.finish.call(this)},i.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},i}(kb);ge.default=he;var wc={};function Hk(t,r,i,$,a){var n,o,h,d,c,e,u,v,p,s=i,x=i,g=0,k=0,m=i;for(n=i;n<$;n+=a){var C=r[n],f=r[n+1];void 0!==d&&(v=C-d,p=f-c,h=Math.sqrt(v*v+p*p),void 0!==e&&(k+=o,Math.acos((e*v+u*p)/(o*h))>t&&(k>g&&(g=k,s=m,x=n),k=0,m=n-a)),o=h,e=v,u=p),d=C,c=f}return(k+=h)>g?[m,n]:[s,x]}var Ik={POINT:"point",LINE:"line"};var Jk=wc&&wc.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),lb={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};wc.TEXT_ALIGN=lb;var ah=function(t){function e(e,i,r,s){var o=t.call(this,e,i,r,s)||this;return o.declutterGroups_,o.labels_=null,o.text_="",o.textOffsetX_=0,o.textOffsetY_=0,o.textRotateWithView_=void 0,o.textRotation_=0,o.textFillState_=null,o.fillStates={},o.textStrokeState_=null,o.strokeStates={},o.textState_={},o.textStates={},o.textKey_="",o.fillKey_="",o.strokeKey_="",o}return Jk(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var i=this.textFillState_,r=this.textStrokeState_,s=this.textState_;if(""!==this.text_&&s&&(i||r)){var o,l,a=this.coordinates.length,n=t.getType(),$=null,h=2,p=2;if(s.placement===Ik.LINE){if(!fa(this.getBufferedMaxExtent(),t.getExtent()))return;var u=void 0;if($=t.getFlatCoordinates(),p=t.getStride(),n==k.LINE_STRING)u=[$.length];else if(n==k.MULTI_LINE_STRING)u=t.getEnds();else if(n==k.POLYGON)u=t.getEnds().slice(0,1);else if(n==k.MULTI_POLYGON){var f=t.getEndss();for(u=[],o=0,l=f.length;o<l;++o)u.push(f[o][0])}this.beginGeometry(t,e);for(var v=s.textAlign,d=0,c=void 0,_=0,x=u.length;_<x;++_){if(null==v){var g=Hk(s.maxAngle,$,d,u[_],p);d=g[0],c=g[1]}else c=u[_];for(o=d;o<c;o+=p)this.coordinates.push($[o],$[o+1]);h=this.coordinates.length,d=u[_];var G=this.declutterGroups_?0===_?this.declutterGroups_[0]:[].concat(this.declutterGroups_[0]):null;this.drawChars_(a,h,G),a=h}this.endGeometry(e)}else{var S=null;switch(s.overflow||(S=[]),n){case k.POINT:case k.MULTI_POINT:h=($=t.getFlatCoordinates()).length;break;case k.LINE_STRING:$=t.getFlatMidpoint();break;case k.CIRCLE:$=t.getCenter();break;case k.MULTI_LINE_STRING:h=($=t.getFlatMidpoints()).length;break;case k.POLYGON:$=t.getFlatInteriorPoint(),s.overflow||S.push($[2]/this.resolution),p=3;break;case k.MULTI_POLYGON:var y=t.getFlatInteriorPoints();for($=[],o=0,l=y.length;o<l;o+=3)s.overflow||S.push(y[o+2]/this.resolution),$.push(y[o],y[o+1]);if(0==(h=$.length))return;}h=this.appendFlatCoordinates($,0,h,p,!1,!1),this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var m=this.pixelRatio;this.instructions.push([aa.DRAW_IMAGE,a,h,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1,NaN,s.padding==jb?jb:s.padding.map(function(t){return t*m}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,S]),this.hitDetectionInstructions.push([aa.DRAW_IMAGE,a,h,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1/this.pixelRatio,NaN,s.padding,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,S]),this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||Lb,textBaseline:e.textBaseline||rc,scale:e.scale});var o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))},e.prototype.drawChars_=function(t,e,i){var r=this.textStrokeState_,s=this.textState_,o=this.strokeKey_,l=this.textKey_,a=this.fillKey_;this.saveTextStates_();var n=this.pixelRatio,$=lb[s.textBaseline],h=this.textOffsetY_*n,p=this.text_,u=s.scale,f=r?r.lineWidth*u/2:0;this.instructions.push([aa.DRAW_CHARS,t,e,$,i,s.overflow,a,s.maxAngle,n,h,o,f*n,p,l,1]),this.hitDetectionInstructions.push([aa.DRAW_CHARS,t,e,$,i,s.overflow,a,s.maxAngle,1,h,o,f,p,l,1/n])},e.prototype.setTextStyle=function(t,e){var i,r,s;if(t){this.declutterGroups_=e;var o=t.getFill();o?((r=this.textFillState_)||(r={},this.textFillState_=r),r.fillStyle=T(o.getColor()||ja)):(r=null,this.textFillState_=r);var l=t.getStroke();if(l){(s=this.textStrokeState_)||(s={},this.textStrokeState_=s);var a=l.getLineDash(),n=l.getLineDashOffset(),$=l.getWidth(),h=l.getMiterLimit();s.lineCap=l.getLineCap()||hb,s.lineDash=a?a.slice():pc,s.lineDashOffset=void 0===n?qc:n,s.lineJoin=l.getLineJoin()||ib,s.lineWidth=void 0===$?Mb:$,s.miterLimit=void 0===h?Jb:h,s.strokeStyle=T(l.getColor()||Kb)}else s=null,this.textStrokeState_=s;i=this.textState_;var p=t.getFont()||Ng;uk(p);var u=t.getScale();i.overflow=t.getOverflow(),i.font=p,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||rc,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||jb,i.scale=void 0===u?1:u;var f=t.getOffsetX(),v=t.getOffsetY(),d=t.getRotateWithView(),c=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===v?0:v,this.textRotateWithView_=void 0!==d&&d,this.textRotation_=void 0===c?0:c,this.strokeKey_=s?("string"==typeof s.strokeStyle?s.strokeStyle:ca(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.textBaseline||"?"),this.fillKey_=r?"string"==typeof r.fillStyle?r.fillStyle:"|"+ca(r.fillStyle):""}else this.text_=""},e}(kb);wc.default=ah;var Kk={Circle:he,Default:kb,Image:$g,LineString:_g,Polygon:he,Text:ah},Lk=function(){function e(e,r,t,i,u){this.declutter_=u,this.declutterGroups_=null,this.tolerance_=e,this.maxExtent_=r,this.pixelRatio_=i,this.resolution_=t,this.buildersByZIndex_={}}return e.prototype.addDeclutter=function(e){var r=null;return this.declutter_&&(e?(r=this.declutterGroups_)[0][4]++:(r=[ea()],this.declutterGroups_=r,r[0].push(1))),r},e.prototype.finish=function(){var e={};for(var r in this.buildersByZIndex_){e[r]=e[r]||{};var t=this.buildersByZIndex_[r];for(var i in t){var u=t[i].finish();e[r][i]=u}}return e},e.prototype.getBuilder=function(e,r){var t=void 0!==e?e.toString():"0",i=this.buildersByZIndex_[t];void 0===i&&(i={},this.buildersByZIndex_[t]=i);var u=i[r];void 0===u&&(u=new(0,Kk[r])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[r]=u);return u},e}();var w={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function bh(n,t,r,e){for(var $=n[t],o=n[t+1],i=0,g=t+e;g<r;g+=e){var a=n[g],h=n[g+1];i+=Math.sqrt((a-$)*(a-$)+(h-o)*(h-o)),$=a,o=h}return i}function Mk(t,a,r,h,o,$,e,x,M,p,m){for(var n,P,i=[],v=t[a]>t[r-h],w=o.length,l=t[a],s=t[a+1],I=t[a+=h],f=t[a+1],u=0,d=Math.sqrt(Math.pow(I-l,2)+Math.pow(f-s,2)),q=!1,O=0;O<w;++O){for(var T=o[n=v?w-O-1:O],c=x*M(p,T,m),b=$+c/2;a<r-h&&u+d<b;)l=I,s=f,I=t[a+=h],f=t[a+1],u+=d,d=Math.sqrt(Math.pow(I-l,2)+Math.pow(f-s,2));var g=b-u,j=Math.atan2(f-s,I-l);if(v&&(j+=j>0?-Math.PI:Math.PI),void 0!==P){var k=j-P;if(q=q||0!==k,k+=k>Math.PI?-2*Math.PI:k<-Math.PI?2*Math.PI:0,Math.abs(k)>e)return null}P=j;var y=g/d,z=cb(l,I,y),A=cb(s,f,y);i[n]=[z,A,c/2,j,T],$+=c}return q?i:[[i[0][0],i[0][1],i[0][2],i[0][3],o]]}var ie,xc={},ko=arguments[0];!function(t,i){"object"==typeof xc?xc=i():"function"==typeof ie&&ie.amd?ie(i):(t=t||self).RBush=i()}(xc,function(){function t(t,r,e,a,o){!function t(n,r,e,a,o){for(;a>e;){if(a-e>600){var h=a-e+1,s=r-e+1,l=Math.log(h),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(h-f)/h)*(s-h/2<0?-1:1),m=Math.max(e,Math.floor(r-s*f/h+u)),c=Math.min(a,Math.floor(r+(h-s)*f/h+u));t(n,r,m,c,o)}var p=n[r],d=e,x=a;for(i(n,e,r),o(n[a],p)>0&&i(n,e,a);d<x;){for(i(n,d,x),d++,x--;o(n[d],p)<0;)d++;for(;o(n[x],p)>0;)x--}0===o(n[e],p)?i(n,e,x):i(n,++x,a),x<=r&&(e=x+1),r<=x&&(a=x-1)}}(t,r,e||0,a||t.length-1,o||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){o(t,0,t.children.length,i,t)}function o(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var o=t.children[a];h(e,t.leaf?r(o):o)}return e}function h(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var o=[n,r];o.length;)if(!((r=o.pop())-(n=o.pop())<=e)){var h=n+Math.ceil((r-n)/e/2)*e;t(i,h,n,r,a),o.push(n,h,h,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var o=i.children[a],h=i.leaf?r(o):o;c(t,h)&&(i.leaf?n.push(o):m(t,h)?this._all(o,n):e.push(o))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length){if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,o=this.data,h=this.toBBox(t),s=[],l=[];o||s.length;){if(o||(o=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),o.leaf){var f=e(t,o.children,i);if(-1!==f)return o.children.splice(f,1),s.push(o),this._condense(s),this}a||o.leaf||!m(o,h)?r?(n++,o=r.children[n],a=!1):o=null:(s.push(o),l.push(n),n=0,r=o,o=o.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,o=n-i+1,h=this._maxEntries;if(o<=h)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(o)/Math.log(h)),h=Math.ceil(o/Math.pow(h,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(o/h),l=s*Math.ceil(Math.sqrt(h));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,o=void 0,h=0;h<i.children.length;h++){var s=i.children[h],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,o=s):u===a&&l<e&&(e=l,o=s)}i=o||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),h(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var o=this._chooseSplitIndex(n,e,r),h=p(n.children.splice(o,n.children.length-o));h.height=n.height,h.leaf=n.leaf,a(n,this.toBBox),a(h,this.toBBox),i?t[i-1].children.push(h):this._splitRoot(n,h)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,h,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=o(t,0,p,this.toBBox),x=o(t,p,n,this.toBBox),v=(e=d,a=x,h=void 0,s=void 0,l=void 0,u=void 0,h=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-h)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=o(t,0,i,e),s=o(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];h(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];h(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)h(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r});var Ta=ea(),Pb=R(),la=[],U=[],V=[],ma=[],Nk=function(){function t(t,i,e,r){this.overlaps=e,this.pixelRatio=i,this.resolution=t,this.alignFill_,this.declutterItems=[],this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=R(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,i,e,r){var a=t+i+e+r;if(this.labels_[a])return this.labels_[a];var $=r?this.strokeStates[r]:null,s=e?this.fillStates[e]:null,o=this.textStates[i],n=this.pixelRatio,l=o.scale*n,p=lb[o.textAlign||Lb],h=r&&$.lineWidth?$.lineWidth:0,T=t.split("\n"),L=T.length,v=[],m=wk(o.font,T,v),u=vk(o.font),c=u*L,Z=m+h,f=[],d={width:Math.ceil((Z+2)*l),height:Math.ceil((c+h)*l),contextInstructions:f};1!=l&&f.push("scale",[l,l]),f.push("font",o.font),r&&(f.push("strokeStyle",$.strokeStyle),f.push("lineWidth",h),f.push("lineCap",$.lineCap),f.push("lineJoin",$.lineJoin),f.push("miterLimit",$.miterLimit),CanvasRenderingContext2D.prototype.setLineDash&&(f.push("setLineDash",[$.lineDash]),f.push("lineDashOffset",$.lineDashOffset))),e&&f.push("fillStyle",s.fillStyle),f.push("textBaseline","middle"),f.push("textAlign","center");var x,_=.5-p,g=p*Z+_*h;if(r)for(x=0;x<L;++x)f.push("strokeText",[T[x],g+_*v[x],.5*(h+u)+x*u]);if(e)for(x=0;x<L;++x)f.push("fillText",[T[x],g+_*v[x],.5*(h+u)+x*u]);return this.labels_[a]=d,d},t.prototype.replayTextBackground_=function(t,i,e,r,a,$,s){t.beginPath(),t.moveTo.apply(t,i),t.lineTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,a),t.lineTo.apply(t,i),$&&(this.alignFill_=$[2],this.fill_(t)),s&&(this.setStrokeStyle_(t,s),t.stroke())},t.prototype.replayImageOrLabel_=function(t,i,e,r,a,$,s,o,n,l,p,h,T,L,v,m,u,c){var Z=u||c;i-=a*=T,e-=$*=T;var f=v+l>r.width?r.width-l:v,d=o+p>r.height?r.height-p:o,x=m[3]+f*T+m[1],_=m[0]+d*T+m[2],g=i-m[3],y=e-m[0];(Z||0!==h)&&(la[0]=g,ma[0]=g,la[1]=y,U[1]=y,U[0]=g+x,V[0]=U[0],V[1]=y+_,ma[1]=V[1]);var I=null;if(0!==h){var b=i+a,S=e+$;I=ha(Pb,b,S,1,1,h,-b,-S),da(Pb,la),da(Pb,U),da(Pb,V),da(Pb,ma),N(Math.min(la[0],U[0],V[0],ma[0]),Math.min(la[1],U[1],V[1],ma[1]),Math.max(la[0],U[0],V[0],ma[0]),Math.max(la[1],U[1],V[1],ma[1]),Ta)}else N(g,y,g+x,y+_,Ta);var k=t.canvas,C=c?c[2]*T/2:0,E=Ta[0]-C<=k.width&&Ta[2]+C>=0&&Ta[1]-C<=k.height&&Ta[3]+C>=0;if(L&&(i=Math.round(i),e=Math.round(e)),s){if(!E&&1==s[4])return;ag(s,Ta);var w=E?[t,I?I.slice(0):null,n,r,l,p,f,d,i,e,T]:null;w&&(Z&&w.push(u,c,la.slice(0),U.slice(0),V.slice(0),ma.slice(0)),s.push(w))}else E&&(Z&&this.replayTextBackground_(t,la,U,V,ma,u,c),Rg(t,I,n,r,l,p,f,d,i,e,T))},t.prototype.fill_=function(t){if(this.alignFill_){var i=da(this.renderedTransform_,[0,0]),e=512*this.pixelRatio;t.save(),t.translate(i[0]%e,i[1]%e),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,i){t.strokeStyle=i[1],t.lineWidth=i[2],t.lineCap=i[3],t.lineJoin=i[4],t.miterLimit=i[5],t.setLineDash&&(t.lineDashOffset=i[7],t.setLineDash(i[6]))},t.prototype.renderDeclutter=function(t,i,e,r){if(t&&t.length>5){var a=t[4];if(1==a||a==t.length-5){var $={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:i};var $tMOH$$interop$default=Uf(xc);if(r||(r=new $tMOH$$interop$default.d(9)),!r.collides($)){r.insert($);for(var s=5,o=t.length;s<o;++s){var n=t[s],l=n[0],p=l.globalAlpha;p!==e&&(l.globalAlpha=e),n.length>11&&this.replayTextBackground_(n[0],n[13],n[14],n[15],n[16],n[11],n[12]),Rg.apply(void 0,n),p!==e&&(l.globalAlpha=p)}}t.length=5,yb(t)}}return r},t.prototype.drawLabelWithPointPlacement_=function(t,i,e,r){var a=this.textStates[i],$=this.createLabel(t,i,r,e),s=this.strokeStates[e],o=this.pixelRatio,n=lb[a.textAlign||Lb],l=lb[a.textBaseline||rc],p=s&&s.lineWidth?s.lineWidth:0;return{label:$,anchorX:n*($.width/o-2*a.scale)+2*(.5-n)*p,anchorY:l*$.height/o+2*(.5-l)*p}},t.prototype.execute_=function(t,i,e,r,a,$){var s;this.declutterItems.length=0,this.pixelCoordinates_&&Ya(i,this.renderedTransform_)?s=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),s=Ha(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Hj(this.renderedTransform_,i));for(var o,n,l,p,h,T,L,v,m,u,c,Z,f,d,x,_,g,y=0,I=e.length,b=0,S=0,k=0,C=null,E=null,w=this.coordinateCache_,R=this.viewRotation_,A=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,O={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:R},M=this.instructions!=e||this.overlaps?0:200;y<I;){var D=e[y];switch(D[0]){case aa.BEGIN_GEOMETRY:(x=D[1]).getGeometry()?void 0===$||fa($,D[3])?++y:y=D[2]+1:y=D[2];break;case aa.BEGIN_PATH:S>M&&(this.fill_(t),S=0),k>M&&(t.stroke(),k=0),S||k||(t.beginPath(),p=NaN,h=NaN),++y;break;case aa.CIRCLE:var P=s[b=D[1]],q=s[b+1],W=s[b+2]-P,N=s[b+3]-q,j=Math.sqrt(W*W+N*N);t.moveTo(P+j,q),t.arc(P,q,j,0,2*Math.PI,!0),++y;break;case aa.CLOSE_PATH:t.closePath(),++y;break;case aa.CUSTOM:b=D[1],o=D[2];var B=D[3],G=D[4],F=6==D.length?D[5]:void 0;O.geometry=B,O.feature=x,y in w||(w[y]=[]);var X=w[y];F?F(s,b,o,2,X):(X[0]=s[b],X[1]=s[b+1],X.length=2),G(X,O),++y;break;case aa.DRAW_IMAGE:b=D[1],o=D[2],u=D[3],n=D[4],l=D[5],m=a?null:D[6];var Y=D[7],H=D[8],U=D[9],J=D[10],K=D[11],V=D[12],z=D[13],Q=D[14];if(!u&&D.length>=19){c=D[18],Z=D[19],f=D[20],d=D[21];var tt=this.drawLabelWithPointPlacement_(c,Z,f,d);u=tt.label,D[3]=u;var it=D[22];n=(tt.anchorX-it)*this.pixelRatio,D[4]=n;var et=D[23];l=(tt.anchorY-et)*this.pixelRatio,D[5]=l,Y=u.height,D[7]=Y,Q=u.width,D[14]=Q}var rt=void 0;D.length>24&&(rt=D[24]);var at=void 0,$t=void 0,st=void 0;D.length>16?(at=D[15],$t=D[16],st=D[17]):(at=jb,$t=!1,st=!1),K&&A?V+=R:K||A||(V-=R);for(var ot=0,nt=0;b<o;b+=2)if(!(rt&&rt[ot++]<Q/this.pixelRatio)){if(m){var lt=Math.floor(nt);m.length<lt+1&&((v=ea()).push(m[0][4]),m.push(v)),v=m[lt]}this.replayImageOrLabel_(t,s[b],s[b+1],u,n,l,v,Y,H,U,J,V,z,r,Q,at,$t?C:null,st?E:null),v&&(nt===Math.floor(nt)&&this.declutterItems.push(this,v,x),nt+=1/v[4])}++y;break;case aa.DRAW_CHARS:var pt=D[1],ht=D[2],Tt=D[3];v=a?null:D[4];var Lt=D[5];d=D[6];var vt=D[7],mt=D[8],ut=D[9];f=D[10];var ct=D[11];c=D[12],Z=D[13];var Zt=D[14],ft=this.textStates[Z],dt=ft.font,xt=ft.scale*mt,_t=void 0;dt in this.widths_?_t=this.widths_[dt]:(_t={},this.widths_[dt]=_t);var gt=bh(s,pt,ht,2),yt=xt*Pg(dt,c,_t);if(Lt||yt<=gt){var It=this.textStates[Z].textAlign,bt=(gt-yt)*lb[It],St=Mk(s,pt,ht,2,c,bt,vt,xt,Pg,dt,_t);if(St){var kt=void 0,Ct=void 0,Et=void 0,wt=void 0,Rt=void 0;if(f)for(kt=0,Ct=St.length;kt<Ct;++kt)Et=(Rt=St[kt])[4],wt=this.createLabel(Et,Z,"",f),n=Rt[2]+ct,l=Tt*wt.height+2*(.5-Tt)*ct-ut,this.replayImageOrLabel_(t,Rt[0],Rt[1],wt,n,l,v,wt.height,1,0,0,Rt[3],Zt,!1,wt.width,jb,null,null);if(d)for(kt=0,Ct=St.length;kt<Ct;++kt)Et=(Rt=St[kt])[4],wt=this.createLabel(Et,Z,d,""),n=Rt[2],l=Tt*wt.height-ut,this.replayImageOrLabel_(t,Rt[0],Rt[1],wt,n,l,v,wt.height,1,0,0,Rt[3],Zt,!1,wt.width,jb,null,null)}}this.declutterItems.push(this,v,x),++y;break;case aa.END_GEOMETRY:if(void 0!==a){var At=a(x=D[1]);if(At)return At}++y;break;case aa.FILL:M?S++:this.fill_(t),++y;break;case aa.MOVE_TO_LINE_TO:for(b=D[1],o=D[2],_=s[b],L=(g=s[b+1])+.5|0,(T=_+.5|0)===p&&L===h||(t.moveTo(_,g),p=T,h=L),b+=2;b<o;b+=2)T=(_=s[b])+.5|0,L=(g=s[b+1])+.5|0,b!=o-2&&T===p&&L===h||(t.lineTo(_,g),p=T,h=L);++y;break;case aa.SET_FILL_STYLE:C=D,this.alignFill_=D[2],S&&(this.fill_(t),S=0,k&&(t.stroke(),k=0)),t.fillStyle=D[1],++y;break;case aa.SET_STROKE_STYLE:E=D,k&&(t.stroke(),k=0),this.setStrokeStyle_(t,D),++y;break;case aa.STROKE:M?k++:t.stroke(),++y;break;default:++y;}}S&&this.fill_(t),k&&t.stroke()},t.prototype.execute=function(t,i,e,r){this.viewRotation_=e,this.execute_(t,i,this.instructions,r,void 0,void 0)},t.prototype.executeHitDetection=function(t,i,e,r,a){return this.viewRotation_=e,this.execute_(t,i,this.hitDetectionInstructions,!0,r,a)},t}();var je=[w.POLYGON,w.CIRCLE,w.LINE_STRING,w.IMAGE,w.TEXT,w.DEFAULT],Ok=function(){function r(r,t,e,i,o,$){this.maxExtent_=r,this.overlaps_=i,this.pixelRatio_=e,this.resolution_=t,this.renderBuffer_=$,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=R(),this.createExecutors_(o)}return r.prototype.clip=function(r,t){var e=this.getClipCoords(t);r.beginPath(),r.moveTo(e[0],e[1]),r.lineTo(e[2],e[3]),r.lineTo(e[4],e[5]),r.lineTo(e[6],e[7]),r.clip()},r.prototype.createExecutors_=function(r){for(var t in r){var e=this.executorsByZIndex_[t];void 0===e&&(e={},this.executorsByZIndex_[t]=e);var i=r[t];for(var o in i){var $=i[o];e[o]=new Nk(this.resolution_,this.pixelRatio_,this.overlaps_,$)}}},r.prototype.hasExecutors=function(r){for(var t in this.executorsByZIndex_)for(var e=this.executorsByZIndex_[t],i=0,o=r.length;i<o;++i)if(r[i]in e)return!0;return!1},r.prototype.forEachFeatureAtCoordinate=function(r,t,e,i,o,$){var s=2*(i=Math.round(i))+1,a=ha(this.hitDetectionTransform_,i+.5,i+.5,1/t,-1/t,-e,-r[0],-r[1]);this.hitDetectionContext_||(this.hitDetectionContext_=J(s,s));var n,l=this.hitDetectionContext_;l.canvas.width!==s||l.canvas.height!==s?(l.canvas.width=s,l.canvas.height=s):l.clearRect(0,0,s,s),void 0!==this.renderBuffer_&&(n=ea(),_a(n,r),dc(n,t*(this.renderBuffer_+i),n));var c,C=Pk(i);function p(r){for(var t=l.getImageData(0,0,s,s).data,e=0;e<s;e++)for(var i=0;i<s;i++)if(C[e][i]&&t[4*(i*s+e)+3]>0){var a=void 0;return(!$||c!=w.IMAGE&&c!=w.TEXT||-1!==$.indexOf(r))&&(a=o(r)),a||void l.clearRect(0,0,s,s)}}var u,f,j,v,d,h=Object.keys(this.executorsByZIndex_).map(Number);for(h.sort(ra),u=h.length-1;u>=0;--u){var x=h[u].toString();for(j=this.executorsByZIndex_[x],f=je.length-1;f>=0;--f)if(void 0!==(v=j[c=je[f]])&&(d=v.executeHitDetection(l,a,e,p,n)))return d}},r.prototype.getClipCoords=function(r){var t=this.maxExtent_;if(!t)return null;var e=t[0],i=t[1],o=t[2],$=t[3],s=[e,i,e,$,o,$,o,i];return Ha(s,0,8,2,r,s),s},r.prototype.isEmpty=function(){return bc(this.executorsByZIndex_)},r.prototype.execute=function(r,t,e,i,o,$){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(ra),this.maxExtent_&&(r.save(),this.clip(r,t));var a,n,l,c,C,p,u=o||je;for(a=0,n=s.length;a<n;++a){var f=s[a].toString();for(C=this.executorsByZIndex_[f],l=0,c=u.length;l<c;++l){var j=u[l];if(void 0!==(p=C[j]))if(!$||j!=w.IMAGE&&j!=w.TEXT)p.execute(r,t,e,i);else{var v=$[f];v?v.push(p,t.slice(0)):$[f]=[p,t.slice(0)]}}}this.maxExtent_&&r.restore()},r}(),ke={0:[[!0]]};function xa(r,t,e){var i,o=Math.floor(r.length/2);if(t>=o)for(i=o;i<t;i++)r[i][e]=!0;else if(t<o)for(i=t+1;i<o;i++)r[i][e]=!0}function Pk(r){if(void 0!==ke[r])return ke[r];for(var t=2*r+1,e=new Array(t),i=0;i<t;i++)e[i]=new Array(t);for(var o=r,$=0,s=0;o>=$;)xa(e,r+o,r+$),xa(e,r+$,r+o),xa(e,r-$,r+o),xa(e,r-o,r+$),xa(e,r-o,r-$),xa(e,r-$,r-o),xa(e,r+$,r-o),xa(e,r+o,r-$),2*((s+=1+2*++$)-o)+1>0&&(s+=1-2*(o-=1));return ke[r]=e,e}function Qk(r,t,e,i,o,$){for(var s=Object.keys(r).map(Number).sort(ra),a=0,n=s.length;a<n;++a)for(var l=r[s[a].toString()],c=void 0,C=0,p=l.length;C<p;){var u=l[C++];u!==c&&(c=u,$.push({items:u.declutterItems,opacity:i}));var f=l[C++];u.execute(t,f,e,o)}}var le={};var me={};var Rk=me&&me.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ne=function(t){function e(e,r,n,o){var $=t.call(this,e)||this;return $.inversePixelTransform=r,$.frameState=n,$.context=o,$}return Rk(e,t),e}(A);me.default=ne;var oe={};var Sk=oe&&oe.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),ch=function(t){function e(e){var r=t.call(this)||this;return r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=e,r}return Sk(e,t),e.prototype.getFeatures=function(t){return c()},e.prototype.prepareFrame=function(t){return c()},e.prototype.renderFrame=function(t,e){return c()},e.prototype.loadedTileCallback=function(t,e,r){t[e]||(t[e]={}),t[e][r.tileCoord.toString()]=r},e.prototype.createLoadedTileFinder=function(t,e,r){return function(a,o){var n=this.loadedTileCallback.bind(this,r,a);return t.forEachLoadedTile(e,a,o,n)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,a,o){},e.prototype.getDataAtPixel=function(t,e,r){return c()},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){t.target.getState()===m.LOADED&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return e!=m.LOADED&&e!=m.ERROR&&t.addEventListener(f.CHANGE,this.boundHandleImageChange_),e==m.IDLE&&(t.load(),e=t.getState()),e==m.LOADED},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Qa.READY&&t.changed()},e}(pd);oe.default=ch;var Tk=le&&le.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),pe=function(t){function r(r){var e=t.call(this,r)||this;return e.container=null,e.renderedResolution,e.tempTransform_=R(),e.pixelTransform=R(),e.inversePixelTransform=R(),e.context=null,e.containerReused=!1,e.createTransformStringCanvas_=J(1,1).canvas,e}return Tk(r,t),r.prototype.useContainer=function(t,r,e){var o,n,a=this.getLayer().getClassName();t&&""===t.style.opacity&&t.className===a&&(s=t.firstElementChild)instanceof HTMLCanvasElement&&(n=s.getContext("2d"));if(n&&n.canvas.style.transform===r?(this.container=t,this.context=n,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(o=document.createElement("div")).className=a;var i=o.style;i.position="absolute",i.width="100%",i.height="100%";var s=(n=J()).canvas;o.appendChild(s),(i=s.style).position="absolute",i.left="0",i.transformOrigin="top left",this.container=o,this.context=n}},r.prototype.clip=function(t,r,e){var o=r.pixelRatio,n=r.size[0]*o/2,a=r.size[1]*o/2,i=r.viewState.rotation,s=ga(e),$=Ga(e),p=Fa(e),m=sa(e);da(r.coordinateToPixelTransform,s),da(r.coordinateToPixelTransform,$),da(r.coordinateToPixelTransform,p),da(r.coordinateToPixelTransform,m),t.save(),Qg(t,-i,n,a),t.beginPath(),t.moveTo(s[0]*o,s[1]*o),t.lineTo($[0]*o,$[1]*o),t.lineTo(p[0]*o,p[1]*o),t.lineTo(m[0]*o,m[1]*o),t.clip(),Qg(t,i,n,a)},r.prototype.clipUnrotated=function(t,r,e){var o=ga(e),n=Ga(e),a=Fa(e),i=sa(e);da(r.coordinateToPixelTransform,o),da(r.coordinateToPixelTransform,n),da(r.coordinateToPixelTransform,a),da(r.coordinateToPixelTransform,i);var s=this.inversePixelTransform;da(s,o),da(s,n),da(s,a),da(s,i),t.save(),t.beginPath(),t.moveTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.clip()},r.prototype.dispatchRenderEvent_=function(t,r,e){var o=this.getLayer();if(o.hasListener(t)){var n=new ne(t,this.inversePixelTransform,e,r);o.dispatchEvent(n)}},r.prototype.preRender=function(t,r){this.dispatchRenderEvent_(Pa.PRERENDER,t,r)},r.prototype.postRender=function(t,r){this.dispatchRenderEvent_(Pa.POSTRENDER,t,r)},r.prototype.getRenderTransform=function(t,r,e,o,n,a,i){var s=n/2,$=a/2,p=o/r,m=-p,c=-t[0]+i,l=-t[1];return ha(this.tempTransform_,s,$,p,m,-e,c,l)},r.prototype.getDataAtPixel=function(t,r,e){var o,n=da(this.inversePixelTransform,t.slice()),a=this.context;try{o=a.getImageData(Math.round(n[0]),Math.round(n[1]),1,1).data}catch(i){return"SecurityError"===i.name?new Uint8Array:o}return 0===o[3]?null:o},r.prototype.createTransformString=function(t){return this.createTransformStringCanvas_.style.transform=tg(t),this.createTransformStringCanvas_.style.transform},r}(ch);le.default=pe;var Uk=.5,dh={Point:bl,LineString:$k,Polygon:dl,MultiPoint:cl,MultiLineString:_k,MultiPolygon:al,GeometryCollection:Zk,Circle:Xk};function Vk(e,r){return parseInt(ca(e),10)-parseInt(ca(r),10)}function Wk(e,r){var t=eh(e,r);return t*t}function eh(e,r){return Uk*e/r}function Xk(e,r,t,i){var o=t.getFill(),$=t.getStroke();if(o||$){var a=e.getBuilder(t.getZIndex(),w.CIRCLE);a.setFillStrokeStyle(o,$),a.drawCircle(r,i)}var n=t.getText();if(n){var l=e.getBuilder(t.getZIndex(),w.TEXT);l.setTextStyle(n,e.addDeclutter(!1)),l.drawText(r,i)}}function fh(e,r,t,i,o,$){var a=!1,n=t.getImage();if(n){var l=n.getImageState();l==m.LOADED||l==m.ERROR?n.unlistenImageChange(o):(l==m.IDLE&&n.load(),l=n.getImageState(),n.listenImageChange(o),a=!0)}return Yk(e,r,t,i,$),a}function Yk(e,r,t,i,o){var $=t.getGeometryFunction()(r);if($){var a=$.simplifyTransformed(i,o);if(t.getRenderer())gh(e,a,t,r);else(0,dh[a.getType()])(e,a,t,r)}}function gh(e,r,t,i){if(r.getType()!=k.GEOMETRY_COLLECTION)e.getBuilder(t.getZIndex(),w.DEFAULT).drawCustom(r,i,t.getRenderer());else for(var o=r.getGeometries(),$=0,a=o.length;$<a;++$)gh(e,o[$],t,i)}function Zk(e,r,t,i){var o,$,a=r.getGeometriesArray();for(o=0,$=a.length;o<$;++o){(0,dh[a[o].getType()])(e,a[o],t,i)}}function $k(e,r,t,i){var o=t.getStroke();if(o){var $=e.getBuilder(t.getZIndex(),w.LINE_STRING);$.setFillStrokeStyle(null,o),$.drawLineString(r,i)}var a=t.getText();if(a){var n=e.getBuilder(t.getZIndex(),w.TEXT);n.setTextStyle(a,e.addDeclutter(!1)),n.drawText(r,i)}}function _k(e,r,t,i){var o=t.getStroke();if(o){var $=e.getBuilder(t.getZIndex(),w.LINE_STRING);$.setFillStrokeStyle(null,o),$.drawMultiLineString(r,i)}var a=t.getText();if(a){var n=e.getBuilder(t.getZIndex(),w.TEXT);n.setTextStyle(a,e.addDeclutter(!1)),n.drawText(r,i)}}function al(e,r,t,i){var o=t.getFill(),$=t.getStroke();if($||o){var a=e.getBuilder(t.getZIndex(),w.POLYGON);a.setFillStrokeStyle(o,$),a.drawMultiPolygon(r,i)}var n=t.getText();if(n){var l=e.getBuilder(t.getZIndex(),w.TEXT);l.setTextStyle(n,e.addDeclutter(!1)),l.drawText(r,i)}}function bl(e,r,t,i){var o=t.getImage();if(o){if(o.getImageState()!=m.LOADED)return;var $=e.getBuilder(t.getZIndex(),w.IMAGE);$.setImageStyle(o,e.addDeclutter(!1)),$.drawPoint(r,i)}var a=t.getText();if(a){var n=e.getBuilder(t.getZIndex(),w.TEXT);n.setTextStyle(a,e.addDeclutter(!!o)),n.drawText(r,i)}}function cl(e,r,t,i){var o=t.getImage();if(o){if(o.getImageState()!=m.LOADED)return;var $=e.getBuilder(t.getZIndex(),w.IMAGE);$.setImageStyle(o,e.addDeclutter(!1)),$.drawMultiPoint(r,i)}var a=t.getText();if(a){var n=e.getBuilder(t.getZIndex(),w.TEXT);n.setTextStyle(a,e.addDeclutter(!!o)),n.drawText(r,i)}}function dl(e,r,t,i){var o=t.getFill(),$=t.getStroke();if(o||$){var a=e.getBuilder(t.getZIndex(),w.POLYGON);a.setFillStrokeStyle(o,$),a.drawPolygon(r,i)}var n=t.getText();if(n){var l=e.getBuilder(t.getZIndex(),w.TEXT);l.setTextStyle(n,e.addDeclutter(!1)),l.drawText(r,i)}}function el(e,t,r,a,o,i,n){var s=e[0]/2,$=e[1]/2,c=J(s,$);c.imageSmoothingEnabled=!1;for(var m=c.canvas,g=new hh(c,.5,o,null,n),p=r.length,h=Math.floor(16777215/p),l={},S=1;S<=p;++S){var U=r[S-1],v=U.getStyleFunction()||a;if(a){var F=v(U,i);if(F){Array.isArray(F)||(F=[F]);for(var d="#"+("000000"+(S*h).toString(16)).slice(-6),u=0,y=F.length;u<y;++u){var I=F[u],f=I.clone(),x=f.getFill();x&&x.setColor(d);var C=f.getStroke();C&&C.setColor(d),f.setText(void 0);var D=I.getImage();if(D){var w=D.getImageSize(),T=document.createElement("canvas");T.width=w[0],T.height=w[1];var G=T.getContext("2d",{alpha:!1});G.fillStyle=d;var j=G.canvas;G.fillRect(0,0,j.width,j.height);var q=w?w[0]:j.width,E=w?w[1]:j.height;J(q,E).drawImage(j,0,0),f.setImage(new oh({img:j,imgSize:w,anchor:D.getAnchor(),anchorXUnits:ya.PIXELS,anchorYUnits:ya.PIXELS,offset:D.getOrigin(),size:D.getSize(),opacity:D.getOpacity(),scale:D.getScale(),rotation:D.getRotation(),rotateWithView:D.getRotateWithView()}))}var b=Number(f.getZIndex());(R=l[b])||(R={},l[b]=R,R[k.POLYGON]=[],R[k.CIRCLE]=[],R[k.LINE_STRING]=[],R[k.POINT]=[]);var A=f.getGeometryFunction()(U);A&&fa(o,A.getExtent())&&R[A.getType().replace("Multi","")].push(A,f)}}}}for(var N=Object.keys(l).map(Number).sort(ra),O=(S=0,N.length);S<O;++S){var R=l[N[S]];for(var L in R){var M=R[L];for(u=0,y=M.length;u<y;u+=2){g.setStyle(M[u+1]);for(var z=0,P=t.length;z<P;++z)g.setTransform(t[z]),g.drawGeometry(M[u])}}}return document.body.appendChild(c.canvas),c.getImageData(0,0,m.width,m.height)}function fl(e,t,r){var a=[];if(r){var o=4*(Math.round(e[0]/2)+Math.round(e[1]/2)*r.width),i=r.data[o],n=r.data[o+1],s=r.data[o+2]+256*(n+256*i),$=Math.floor(16777215/t.length);s&&s%$==0&&a.push(t[s/$-1])}return a}var qe={};var gl=qe&&qe.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),hh=function(t){function e(e,i,o,a,r,n,s){var l=t.call(this)||this;return l.context_=e,l.pixelRatio_=i,l.extent_=o,l.transform_=a,l.viewRotation_=r,l.squaredTolerance_=n,l.userTransform_=s,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=0,l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=0,l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=R(),l}return gl(e,t),e.prototype.drawImages_=function(t,e,i,o){if(this.image_){var a=Ha(t,e,i,2,this.transform_,this.pixelCoordinates_),r=this.context_,n=this.tmpLocalTransform_,s=r.globalAlpha;1!=this.imageOpacity_&&(r.globalAlpha=s*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var h=0,_=a.length;h<_;h+=2){var x=a[h]-this.imageAnchorX_,f=a[h+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_){var m=x+this.imageAnchorX_,p=f+this.imageAnchorY_;ha(n,m,p,this.imageScale_,this.imageScale_,l,-m,-p),r.setTransform.apply(r,n)}r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,x,f,this.imageWidth_,this.imageHeight_)}0===l&&1==this.imageScale_||r.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(r.globalAlpha=s)}},e.prototype.drawText_=function(t,e,i,o){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var a=Ha(t,e,i,o,this.transform_,this.pixelCoordinates_),r=this.context_,n=this.textRotation_;for(this.textRotateWithView_&&(n+=this.viewRotation_);e<i;e+=o){var s=a[e]+this.textOffsetX_,l=a[e+1]+this.textOffsetY_;if(0!==n||1!=this.textScale_){var h=ha(this.tmpLocalTransform_,s,l,this.textScale_,this.textScale_,n,-s,-l);r.setTransform.apply(r,h)}this.textStrokeState_&&r.strokeText(this.text_,s,l),this.textFillState_&&r.fillText(this.text_,s,l)}0===n&&1==this.textScale_||r.setTransform(1,0,0,1,0,0)}},e.prototype.moveToLineTo_=function(t,e,i,o,a){var r=this.context_,n=Ha(t,e,i,o,this.transform_,this.pixelCoordinates_);r.moveTo(n[0],n[1]);var s=n.length;a&&(s-=2);for(var l=2;l<s;l+=2)r.lineTo(n[l],n[l+1]);return a&&r.closePath(),i},e.prototype.drawRings_=function(t,e,i,o){for(var a=0,r=i.length;a<r;++a)e=this.moveToLineTo_(t,e,i[a],o,!0);return e},e.prototype.drawCircle=function(t){if(fa(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=wg(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],o=e[3]-e[1],a=Math.sqrt(i*i+o*o),r=this.context_;r.beginPath(),r.arc(e[0],e[1],a,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case k.POINT:this.drawPoint(t);break;case k.LINE_STRING:this.drawLineString(t);break;case k.POLYGON:this.drawPolygon(t);break;case k.MULTI_POINT:this.drawMultiPoint(t);break;case k.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case k.MULTI_POLYGON:this.drawMultiPolygon(t);break;case k.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case k.CIRCLE:this.drawCircle(t);}},e.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);i&&fa(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,o=e.length;i<o;++i)this.drawGeometry(e[i])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),fa(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var o=t.getFlatMidpoint();this.drawText_(o,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(fa(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,o=t.getFlatCoordinates(),a=0,r=t.getEnds(),n=t.getStride();i.beginPath();for(var s=0,l=r.length;s<l;++s)a=this.moveToLineTo_(o,a,r[s],n,!1);i.stroke()}if(""!==this.text_){var h=t.getFlatMidpoints();this.drawText_(h,0,h.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),fa(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),fa(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),o=0,a=t.getEndss(),r=t.getStride();e.beginPath();for(var n=0,s=a.length;n<s;++n){var l=a[n];o=this.drawRings_(i,o,l,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var h=t.getFlatInteriorPoints();this.drawText_(h,0,h.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(Ya(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,o=t.textAlign?t.textAlign:Lb;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=o&&(i.textAlign=o,e.textAlign=o),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=o,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:o,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){if(t){var i=t.getColor();this.fillState_={fillStyle:T(i||ja)}}else this.fillState_=null;if(e){var o=e.getColor(),a=e.getLineCap(),r=e.getLineDash(),n=e.getLineDashOffset(),s=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit();this.strokeState_={lineCap:void 0!==a?a:hb,lineDash:r||pc,lineDashOffset:n||qc,lineJoin:void 0!==s?s:ib,lineWidth:this.pixelRatio_*(void 0!==l?l:Mb),miterLimit:void 0!==h?h:Jb,strokeStyle:T(o||Kb)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){if(t){var e=t.getAnchor(),i=t.getImage(1),o=t.getOrigin(),a=t.getSize();this.imageAnchorX_=e[0],this.imageAnchorY_=e[1],this.imageHeight_=a[1],this.image_=i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScale()*this.pixelRatio_,this.imageWidth_=a[0]}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:T(i||ja)}}else this.textFillState_=null;var o=t.getStroke();if(o){var a=o.getColor(),r=o.getLineCap(),n=o.getLineDash(),s=o.getLineDashOffset(),l=o.getLineJoin(),h=o.getWidth(),_=o.getMiterLimit();this.textStrokeState_={lineCap:void 0!==r?r:hb,lineDash:n||pc,lineDashOffset:s||qc,lineJoin:void 0!==l?l:ib,lineWidth:void 0!==h?h:Mb,miterLimit:void 0!==_?_:Jb,strokeStyle:T(a||Kb)}}else this.textStrokeState_=null;var x=t.getFont(),f=t.getOffsetX(),m=t.getOffsetY(),p=t.getRotateWithView(),g=t.getRotation(),$=t.getScale(),S=t.getText(),c=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:void 0!==x?x:Ng,textAlign:void 0!==c?c:Lb,textBaseline:void 0!==d?d:rc},this.text_=void 0!==S?S:"",this.textOffsetX_=void 0!==f?this.pixelRatio_*f:0,this.textOffsetY_=void 0!==m?this.pixelRatio_*m:0,this.textRotateWithView_=void 0!==p&&p,this.textRotation_=void 0!==g?g:0,this.textScale_=this.pixelRatio_*(void 0!==$?$:1)}else this.text_=""},e}(Yg);qe.default=hh;var re={};var ya={FRACTION:"fraction",PIXELS:"pixels"};var yc={};var hl=function(){function e(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return e.prototype.clear=function(){this.cache_={},this.cacheSize_=0},e.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},e.prototype.expire=function(){if(this.canExpireCache()){var e=0;for(var t in this.cache_){var r=this.cache_[t];0!=(3&e++)||r.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}},e.prototype.get=function(e,t,r){var i=ih(e,t,r);return i in this.cache_?this.cache_[i]:null},e.prototype.set=function(e,t,r,i){var a=ih(e,t,r);this.cache_[a]=i,++this.cacheSize_},e.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()},e}();function ih(e,t,r){return t+":"+e+":"+(r?ik(r):"null")}var zc=new hl;var Ac={};var se={};var il=se&&se.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),jh=function(t){function e(e,r,o,n){var i=t.call(this)||this;return i.extent=e,i.pixelRatio_=o,i.resolution=r,i.state=n,i}return il(e,t),e.prototype.changed=function(){this.dispatchEvent(f.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return c()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){c()},e}(Da);se.default=jh;var mb="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",jl=-1!==mb.indexOf("firefox");var lo=-1!==mb.indexOf("safari")&&-1==mb.indexOf("chrom");var kl=-1!==mb.indexOf("webkit")&&-1==mb.indexOf("edge");var ll=-1!==mb.indexOf("macintosh");var Bc=window.devicePixelRatio||1;var kh="undefined"!=typeof Image&&Image.prototype.decode;var lh=function(){var $=!1;try{var e=Object.defineProperty({},"passive",{get:function(){$=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(p){}return $}();var ml=Ac&&Ac.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),nl=function(t){function e(e,n,i,r,o,a){var $=t.call(this,e,n,i,m.IDLE)||this;return $.src_=r,$.image_=new Image,null!==o&&($.image_.crossOrigin=o),$.unlisten_=null,$.state=m.IDLE,$.imageLoadFunction_=a,$}return ml(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=m.ERROR,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=P(this.extent)/this.image_.height),this.state=m.LOADED,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state!=m.IDLE&&this.state!=m.ERROR||(this.state=m.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Cc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(jh);function Cc(t,e,n){var i=t;if(i.src&&kh){var r=i.decode(),o=!0;return r.then(function(){o&&e()}).catch(function(t){o&&("EncodingError"===t.name&&"Invalid image type."===t.message?e():n())}),function(){o=!1}}var a=[vb(i,f.LOAD,e),vb(i,f.ERROR,n)];return function(){a.forEach(d)}}Ac.listenImage=Cc,Ac.default=nl;var ol=yc&&yc.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),mh=function(t){function e(e,i,r,a,n,s){var o=t.call(this)||this;return o.hitDetectionImage_=null,o.image_=e||new Image,null!==a&&(o.image_.crossOrigin=a),o.canvas_=s?document.createElement("canvas"):null,o.color_=s,o.unlisten_=null,o.imageState_=n,o.size_=r,o.src_=i,o.tainted_,o}return ol(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===m.LOADED){this.tainted_=!1;var t=J(1,1);try{t.drawImage(this.image_,0,0),t.getImageData(0,0,1,1)}catch(e){this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(f.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=m.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=m.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.replaceColor_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],i=this.size_[1],r=J(e,i);r.fillRect(0,0,e,i),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==m.IDLE){this.imageState_=m.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=Cc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),i=e.data,r=this.color_[0]/255,a=this.color_[1]/255,n=this.color_[2]/255,s=0,o=i.length;s<o;s+=4)i[s]*=r,i[s+1]*=a,i[s+2]*=n;t.putImageData(e,0,0)}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(Da);function nh(t,e,i,r,a,n){var s=zc.get(e,r,n);return s||(s=new mh(t,e,i,r,a,n),zc.set(e,r,n,s)),s}yc.get=nh,yc.default=mh;var L={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};var pl=re&&re.__extends||function(){var i=function(t,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}i(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),oh=function(i){function t(t){var o=this,r=t||{},n=void 0!==r.opacity?r.opacity:1,e=void 0!==r.rotation?r.rotation:0,s=void 0!==r.scale?r.scale:1,c=void 0!==r.rotateWithView&&r.rotateWithView;(o=i.call(this,{opacity:n,rotation:e,scale:s,displacement:void 0!==r.displacement?r.displacement:[0,0],rotateWithView:c})||this).anchor_=void 0!==r.anchor?r.anchor:[.5,.5],o.normalizedAnchor_=null,o.anchorOrigin_=void 0!==r.anchorOrigin?r.anchorOrigin:L.TOP_LEFT,o.anchorXUnits_=void 0!==r.anchorXUnits?r.anchorXUnits:ya.FRACTION,o.anchorYUnits_=void 0!==r.anchorYUnits?r.anchorYUnits:ya.FRACTION,o.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null;var a=void 0!==r.img?r.img:null,l=void 0!==r.imgSize?r.imgSize:null,h=r.src;g(!(void 0!==h&&a),4),g(!a||a&&l,5),void 0!==h&&0!==h.length||!a||(h=a.src||ca(a)),g(void 0!==h&&h.length>0,6);var $=void 0!==r.src?m.IDLE:m.LOADED;return o.color_=void 0!==r.color?Jg(r.color):null,o.iconImage_=nh(a,h,l,o.crossOrigin_,$,o.color_),o.offset_=void 0!==r.offset?r.offset:[0,0],o.offsetOrigin_=void 0!==r.offsetOrigin?r.offsetOrigin:L.TOP_LEFT,o.origin_=null,o.size_=void 0!==r.size?r.size:null,o}return pl(t,i),t.prototype.clone=function(){return new t({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},t.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var i=this.anchor_,t=this.getSize();if(this.anchorXUnits_==ya.FRACTION||this.anchorYUnits_==ya.FRACTION){if(!t)return null;i=this.anchor_.slice(),this.anchorXUnits_==ya.FRACTION&&(i[0]*=t[0]),this.anchorYUnits_==ya.FRACTION&&(i[1]*=t[1])}if(this.anchorOrigin_!=L.TOP_LEFT){if(!t)return null;i===this.anchor_&&(i=this.anchor_.slice()),this.anchorOrigin_!=L.TOP_RIGHT&&this.anchorOrigin_!=L.BOTTOM_RIGHT||(i[0]=-i[0]+t[0]),this.anchorOrigin_!=L.BOTTOM_LEFT&&this.anchorOrigin_!=L.BOTTOM_RIGHT||(i[1]=-i[1]+t[1])}return this.normalizedAnchor_=i,this.normalizedAnchor_},t.prototype.setAnchor=function(i){this.anchor_=i,this.normalizedAnchor_=null},t.prototype.getColor=function(){return this.color_},t.prototype.getImage=function(i){return this.iconImage_.getImage(i)},t.prototype.getImageSize=function(){return this.iconImage_.getSize()},t.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},t.prototype.getImageState=function(){return this.iconImage_.getImageState()},t.prototype.getHitDetectionImage=function(i){return this.iconImage_.getHitDetectionImage(i)},t.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var i=this.offset_,t=this.getDisplacement();if(this.offsetOrigin_!=L.TOP_LEFT){var o=this.getSize(),r=this.iconImage_.getSize();if(!o||!r)return null;i=i.slice(),this.offsetOrigin_!=L.TOP_RIGHT&&this.offsetOrigin_!=L.BOTTOM_RIGHT||(i[0]=r[0]-o[0]-i[0]),this.offsetOrigin_!=L.BOTTOM_LEFT&&this.offsetOrigin_!=L.BOTTOM_RIGHT||(i[1]=r[1]-o[1]-i[1])}return i[0]+=t[0],i[1]+=t[1],this.origin_=i,this.origin_},t.prototype.getSrc=function(){return this.iconImage_.getSrc()},t.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},t.prototype.listenImageChange=function(i){this.iconImage_.addEventListener(f.CHANGE,i)},t.prototype.load=function(){this.iconImage_.load()},t.prototype.unlistenImageChange=function(i){this.iconImage_.removeEventListener(f.CHANGE,i)},t}(Sg);re.default=oh;var ql=ce&&ce.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),ph=function(e){function t(t){var r=e.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.dirty_=!1,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=ea(),r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r}return ql(t,e),t.prototype.useContainer=function(t,r,a){a<1&&(t=null),e.prototype.useContainer.call(this,t,r,a)},t.prototype.renderFrame=function(e,t){var r=e.pixelRatio,a=e.layerStatesArray[e.layerIndex];Ij(this.pixelTransform,1/r,1/r),Hd(this.inversePixelTransform,this.pixelTransform);var i=tg(this.pixelTransform);this.useContainer(t,i,a.opacity);var n=this.context,o=n.canvas,s=this.replayGroup_;if(!s||s.isEmpty())return!this.containerReused&&o.width>0&&(o.width=0),this.container;var $=Math.round(e.size[0]*r),d=Math.round(e.size[1]*r);o.width!=$||o.height!=d?(o.width=$,o.height=d,o.style.transform!==i&&(o.style.transform=i)):this.containerReused||n.clearRect(0,0,$,d),this.preRender(n,e);var p=e.extent,u=e.viewState,h=u.center,c=u.resolution,l=u.projection,g=u.rotation,m=l.getExtent(),C=this.getLayer().getSource(),f=!1;if(a.extent){var v=ua(a.extent,l);(f=!Z(v,e.extent)&&fa(v,e.extent))&&this.clip(n,e,v)}var _=e.viewHints,y=!(_[B.ANIMATING]||_[B.INTERACTING]),Q=this.getRenderTransform(h,c,g,r,$,d,0),x=this.getLayer().getDeclutter()?{}:null;if(s.execute(n,Q,g,y,void 0,x),C.getWrapX()&&l.canWrapX()&&!Z(m,p)){for(var R=p[0],I=D(m),E=0,w=void 0;R<m[0];){w=I*--E;var T=this.getRenderTransform(h,c,g,r,$,d,w);s.execute(n,T,g,y,void 0,x),R+=I}for(E=0,R=p[2];R>m[2];){w=I*++E;var j=this.getRenderTransform(h,c,g,r,$,d,w);s.execute(n,j,g,y,void 0,x),R-=I}}if(x){var F=e.viewHints,G=!(F[B.ANIMATING]||F[B.INTERACTING]);Qk(x,n,g,1,G,e.declutterItems)}f&&n.restore(),this.postRender(n,e);var S=a.opacity,A=this.container;return S!==parseFloat(A.style.opacity)&&(A.style.opacity=1===S?"":S),this.container},t.prototype.getFeatures=function(e){return new Promise(function(t,r){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var a=[this.context.canvas.width,this.context.canvas.height];da(this.pixelTransform,a);var i=this.renderedCenter_,n=this.renderedResolution_,o=this.renderedRotation_,s=this.renderedProjection_,$=this.renderedExtent_,d=this.getLayer(),p=[],u=a[0]/2,h=a[1]/2;p.push(this.getRenderTransform(i,n,o,.5,u,h,0).slice());var c=d.getSource(),l=s.getExtent();if(c.getWrapX()&&s.canWrapX()&&!Z(l,$)){for(var g=$[0],m=D(l),C=0,f=void 0;g<l[0];)f=m*--C,p.push(this.getRenderTransform(i,n,o,.5,u,h,f).slice()),g+=m;for(C=0,g=$[2];g>l[2];)f=m*++C,p.push(this.getRenderTransform(i,n,o,.5,u,h,f).slice()),g-=m}this.hitDetectionImageData_=el(a,p,this.renderedFeatures_,d.getStyleFunction(),$,n,o)}t(fl(e,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,a,i){if(this.replayGroup_){var n=t.viewState.resolution,o=t.viewState.rotation,s=this.getLayer(),$={};return this.replayGroup_.forEachFeatureAtCoordinate(e,n,o,r,function(e){var t=ca(e);if(!(t in $))return $[t]=!0,a(e,s)},s.getDeclutter()?i:null)}},t.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.prepareFrame=function(e){var t=this.getLayer(),r=t.getSource();if(!r)return!1;var a=e.viewHints[B.ANIMATING],i=e.viewHints[B.INTERACTING],n=t.getUpdateWhileAnimating(),o=t.getUpdateWhileInteracting();if(!this.dirty_&&!n&&a||!o&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var s=e.extent,$=e.viewState,d=$.projection,p=$.resolution,u=e.pixelRatio,h=t.getRevision(),c=t.getRenderBuffer(),l=t.getRenderOrder();void 0===l&&(l=Vk);var g=$.center.slice(),m=dc(s,c*p),C=$.projection.getExtent();if(r.getWrapX()&&$.projection.canWrapX()&&!Z(C,e.extent)){var f=D(C),v=Math.max(D(m)/2,f);m[0]=C[0]-v,m[2]=C[2]+v;var _=Math.floor((g[0]-C[0])/f);g[0]-=_*f}if(!this.dirty_&&this.renderedResolution_==p&&this.renderedRevision_==h&&this.renderedRenderOrder_==l&&Z(this.renderedExtent_,m))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var y,Q=new Lk(eh(p,u),m,p,u,t.getDeclutter()),x=fb();x?(r.loadFeatures(Gb(m,d),p,x),y=bb(x,d)):r.loadFeatures(m,p,d);var R=Wk(p,u),I=function(e){var r,a=e.getStyleFunction()||t.getStyleFunction();if(a&&(r=a(e,p)),r){var i=this.renderFeature(e,R,r,Q,y);this.dirty_=this.dirty_||i}}.bind(this),E=Gb(m,d),w=r.getFeaturesInExtent(E);l&&w.sort(l);for(var T=0,j=w.length;T<j;++T)I(w[T]);this.renderedFeatures_=w;var F=Q.finish(),G=new Ok(m,p,u,r.getOverlaps(),F,t.getRenderBuffer());return this.renderedResolution_=p,this.renderedRevision_=h,this.renderedRenderOrder_=l,this.renderedExtent_=m,this.renderedRotation_=$.rotation,this.renderedCenter_=g,this.renderedProjection_=d,this.replayGroup_=G,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},t.prototype.renderFeature=function(e,t,r,a,i){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var o=0,s=r.length;o<s;++o)n=fh(a,e,r[o],t,this.boundHandleStyleImageChange_,i)||n;else n=fh(a,e,r,t,this.boundHandleStyleImageChange_,i);return n},t}(pe);ce.default=ph;var rl=Vd&&Vd.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),Qb=function(e){function r(r){return e.call(this,r)||this}return rl(r,e),r.prototype.createRenderer=function(){return new ph(this)},r}(Xg);Vd.default=Qb;function sl(t,e){return t[0]+=+e[0],t[1]+=+e[1],t}function tl(t,e){var r=e.getRadius(),$=e.getCenter(),o=$[0],n=$[1],M=t[0]-o,s=t[1]-n;0===M&&0===s&&(M=1);var a=Math.sqrt(M*M+s*s);return[o+r*M/a,n+r*s/a]}function Dc(t,e){var r,$,o=t[0],n=t[1],M=e[0],s=e[1],a=M[0],O=M[1],p=s[0],C=s[1],i=p-a,x=C-O,c=0===i&&0===x?0:(i*(o-a)+x*(n-O))/(i*i+x*x||0);return c<=0?(r=a,$=O):c>=1?(r=p,$=C):(r=a+c*i,$=O+c*x),[r,$]}function W(t,e){for(var r=!0,$=t.length-1;$>=0;--$)if(t[$]!=e[$]){r=!1;break}return r}function te(t,e){var r=Math.cos(e),$=Math.sin(e),o=t[0]*r-t[1]*$,n=t[1]*r+t[0]*$;return t[0]=o,t[1]=n,t}function ul(t,e){return t[0]*=e,t[1]*=e,t}function I(t,e){var r=t[0]-e[0],$=t[1]-e[1];return r*r+$*$}function Ec(t,e){return Math.sqrt(I(t,e))}function Fc(t,e){return I(t,Dc(t,e))}var ue={};function qh(r,e,t,i,n,$){var o=NaN,l=NaN,a=(t-e)/i;if(1===a)o=r[e],l=r[e+1];else if(2==a)o=(1-n)*r[e]+n*r[e+i],l=(1-n)*r[e+1]+n*r[e+i+1];else if(0!==a){for(var u=r[e],p=r[e+1],f=0,s=[0],H=e+i;H<t;H+=i){var R=r[H],T=r[H+1];f+=Math.sqrt((R-u)*(R-u)+(T-p)*(T-p)),s.push(f),u=R,p=T}var V=n*f,v=$i(s,V);if(v<0){var c=(V-s[-v-2])/(s[-v-1]-s[-v-2]),g=e+(-v-2)*i;o=cb(r[g],r[g+i],c),l=cb(r[g+1],r[g+i+1],c)}else o=r[e+v*i],l=r[e+v*i+1]}return $?($[0]=o,$[1]=l,$):[o,l]}function ve(r,e,t,i,n,$){if(t==e)return null;var o;if(n<r[e+i-1])return $?((o=r.slice(e,e+i))[i-1]=n,o):null;if(r[t-1]<n)return $?((o=r.slice(t-i,t))[i-1]=n,o):null;if(n==r[e+i-1])return r.slice(e,e+i);for(var l=e/i,a=t/i;l<a;){var u=l+a>>1;n<r[(u+1)*i-1]?a=u:l=u+1}var p=r[l*i-1];if(n==p)return r.slice((l-1)*i,(l-1)*i+i);var f=(n-p)/(r[(l+1)*i-1]-p);o=[];for(var s=0;s<i-1;++s)o.push(cb(r[(l-1)*i+s],r[l*i+s],f));return o.push(n),o}function vl(r,e,t,i,n,$,o){if(o)return ve(r,e,t[t.length-1],i,n,$);var l;if(n<r[i-1])return $?((l=r.slice(0,i))[i-1]=n,l):null;if(r[r.length-1]<n)return $?((l=r.slice(r.length-i))[i-1]=n,l):null;for(var a=0,u=t.length;a<u;++a){var p=t[a];if(e!=p){if(n<r[e+i-1])return null;if(n<=r[p-1])return ve(r,e,p,i,n,!1);e=p}}return null}var wl=ue&&ue.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),nb=function(t){function e(e,i){var o=t.call(this)||this;return o.flatMidpoint_=null,o.flatMidpointRevision_=-1,o.maxDelta_=-1,o.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?o.setCoordinates(e,i):o.setFlatCoordinates(i,e),o}return wl(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?K(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,o){return o<Za(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ld(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,o))},e.prototype.forEachSegment=function(t){return Fg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=p.XYM&&this.layout!=p.XYZM)return null;var i=void 0!==e&&e;return ve(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)},e.prototype.getCoordinates=function(){return Hb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return qh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)},e.prototype.getLength=function(){return bh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=Od(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,p.XY)},e.prototype.getType=function(){return k.LINE_STRING},e.prototype.intersectsExtent=function(t){return kc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ic(this.flatCoordinates,0,t,this.stride),this.changed()},e}($);ue.default=nb;var Gc={};var Rb={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};var xl=!1;function yl(e,t,r,i){return function($,o,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof e?e($,o,a):e,!0),t.getType()==Rb.ARRAY_BUFFER&&(s.responseType="arraybuffer"),s.withCredentials=xl,s.onload=function(e){if(!s.status||s.status>=200&&s.status<300){var o=t.getType(),n=void 0;o==Rb.JSON||o==Rb.TEXT?n=s.responseText:o==Rb.XML?(n=s.responseXML)||(n=new DOMParser().parseFromString(s.responseText,"application/xml")):o==Rb.ARRAY_BUFFER&&(n=s.response),n?r.call(this,t.readFeatures(n,{extent:$,featureProjection:a}),t.readProjection(n)):i.call(this)}else i.call(this)}.bind(this),s.onerror=function(){i.call(this)}.bind(this),s.send()}}function rh(e,t){return yl(e,t,function(e,t){"function"==typeof this.addFeatures&&this.addFeatures(e)},Y)}function zl(t,e){return[[-1/0,-1/0,1/0,1/0]]}var we={};var Al=we&&we.__extends||function(){var t=function(r,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(r,o)};return function(r,o){function e(){this.constructor=r}t(r,o),r.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}(),xe=function(t){function r(r){var o=t.call(this)||this;return o.projection_=C(r.projection),o.attributions_=sh(r.attributions),o.attributionsCollapsible_=void 0===r.attributionsCollapsible||r.attributionsCollapsible,o.loading=!1,o.state_=void 0!==r.state?r.state:Qa.READY,o.wrapX_=void 0!==r.wrapX&&r.wrapX,o}return Al(r,t),r.prototype.getAttributions=function(){return this.attributions_},r.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},r.prototype.getProjection=function(){return this.projection_},r.prototype.getResolutions=function(){return c()},r.prototype.getState=function(){return this.state_},r.prototype.getWrapX=function(){return this.wrapX_},r.prototype.refresh=function(){this.changed()},r.prototype.setAttributions=function(t){this.attributions_=sh(t),this.changed()},r.prototype.setState=function(t){this.state_=t,this.changed()},r}(e);function sh(t){return t?Array.isArray(t)?function(r){return t}:"function"==typeof t?t:function(r){return[t]}:null}we.default=xe;var O={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};var Hc=function(){function t(t){var $tMOH$$interop$default=Uf(xc);this.rbush_=new $tMOH$$interop$default.d(t),this.items_={}}return t.prototype.insert=function(t,r){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:r};this.rbush_.insert(e),this.items_[ca(r)]=e},t.prototype.load=function(t,r){for(var e=new Array(r.length),n=0,i=r.length;n<i;n++){var o=t[n],s=r[n],u={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:s};e[n]=u,this.items_[ca(s)]=u}this.rbush_.load(e)},t.prototype.remove=function(t){var r=ca(t),e=this.items_[r];return delete this.items_[r],null!==this.rbush_.remove(e)},t.prototype.update=function(t,r){var e=this.items_[ca(r)],n=[e.minX,e.minY,e.maxX,e.maxY];$a(n,t)||(this.remove(r),this.insert(t,r))},t.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},t.prototype.getInExtent=function(t){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(r).map(function(t){return t.value})},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,r){return this.forEach_(this.getInExtent(t),r)},t.prototype.forEach_=function(t,r){for(var e,n=0,i=t.length;n<i;n++)if(e=r(t[n]))return e;return e},t.prototype.isEmpty=function(){return bc(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var r=this.rbush_.toJSON();return N(r.minX,r.minY,r.maxX,r.maxY,t)},t.prototype.concat=function(t){for(var r in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[r]=t.items_[r]},t}();var th=Gc&&Gc.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),ob=function(e){function t(t,r){var o=e.call(this,t)||this;return o.feature=r,o}return th(t,e),t}(A);Gc.VectorSourceEvent=ob;var Sb=function(e){function t(t){var r=this,o=t||{};(r=e.call(this,{attributions:o.attributions,projection:void 0,state:Qa.READY,wrapX:void 0===o.wrapX||o.wrapX})||this).loader_=Y,r.format_=o.format,r.overlaps_=null==o.overlaps||o.overlaps,r.url_=o.url,void 0!==o.loader?r.loader_=o.loader:void 0!==r.url_&&(g(r.format_,7),r.loader_=rh(r.url_,r.format_)),r.strategy_=void 0!==o.strategy?o.strategy:zl;var n,i,s=void 0===o.useSpatialIndex||o.useSpatialIndex;return r.featuresRtree_=s?new Hc:null,r.loadedExtentsRtree_=new Hc,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null,Array.isArray(o.features)?i=o.features:o.features&&(i=(n=o.features).getArray()),s||void 0!==n||(n=new x(i)),void 0!==i&&r.addFeaturesInternal(i),void 0!==n&&r.bindFeaturesCollection_(n),r}return th(t,e),t.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},t.prototype.addFeatureInternal=function(e){var t=ca(e);if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var r=e.getGeometry();if(r){var o=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ob(O.ADDFEATURE,e))}else this.featuresCollection_&&this.featuresCollection_.remove(e)},t.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[a(t,f.CHANGE,this.handleFeatureChange_,this),a(t,qa.PROPERTYCHANGE,this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(e,t){var r=!0,o=t.getId();return void 0!==o&&(o.toString()in this.idIndex_?r=!1:this.idIndex_[o.toString()]=t),r&&(g(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),r},t.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},t.prototype.addFeaturesInternal=function(e){for(var t=[],r=[],o=[],n=0,i=e.length;n<i;n++){var s=e[n],a=ca(s);this.addToIndex_(a,s)&&r.push(s)}n=0;for(var u=r.length;n<u;n++){s=r[n],a=ca(s);this.setupChangeEvents_(a,s);var $=s.getGeometry();if($){var l=$.getExtent();t.push(l),o.push(s)}else this.nullGeometryFeatures_[a]=s}this.featuresRtree_&&this.featuresRtree_.load(t,o);n=0;for(var v=r.length;n<v;n++)this.dispatchEvent(new ob(O.ADDFEATURE,r[n]))},t.prototype.bindFeaturesCollection_=function(e){var t=!1;this.addEventListener(O.ADDFEATURE,function(r){t||(t=!0,e.push(r.feature),t=!1)}),this.addEventListener(O.REMOVEFEATURE,function(r){t||(t=!0,e.remove(r.feature),t=!1)}),e.addEventListener(u.ADD,function(e){t||(t=!0,this.addFeature(e.element),t=!1)}.bind(this)),e.addEventListener(u.REMOVE,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(e){if(e){for(var t in this.featureChangeKeys_){this.featureChangeKeys_[t].forEach(d)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var r in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var o=new ob(O.CLEAR);this.dispatchEvent(o),this.changed()},t.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,t){var r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,function(r){return r.getGeometry().intersectsCoordinate(e)?t(r):void 0})},t.prototype.forEachFeatureInExtent=function(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},t.prototype.forEachFeatureIntersectingExtent=function(e,t){return this.forEachFeatureInExtent(e,function(r){if(r.getGeometry().intersectsExtent(e)){var o=t(r);if(o)return o}})},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray():this.featuresRtree_&&(e=this.featuresRtree_.getAll(),bc(this.nullGeometryFeatures_)||K(e,ld(this.nullGeometryFeatures_))),e},t.prototype.getFeaturesAtCoordinate=function(e){var t=[];return this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)}),t},t.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_?this.featuresRtree_.getInExtent(e):this.featuresCollection_?this.featuresCollection_.getArray():[]},t.prototype.getClosestFeatureToCoordinate=function(e,t){var r=e[0],o=e[1],n=null,i=[NaN,NaN],s=1/0,a=[-1/0,-1/0,1/0,1/0],u=t||H;return this.featuresRtree_.forEachInExtent(a,function(e){if(u(e)){var t=e.getGeometry(),$=s;if((s=t.closestPointXY(r,o,i,s))<$){n=e;var l=Math.sqrt(s);a[0]=r-l,a[1]=o-l,a[2]=r+l,a[3]=o+l}}}),n},t.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},t.prototype.getFeatureById=function(e){var t=this.idIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getFeatureByUid=function(e){var t=this.uidIndex_[e];return void 0!==t?t:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(e){var t=e.target,r=ca(t),o=t.getGeometry();if(o){var n=o.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(n,t)):this.featuresRtree_&&this.featuresRtree_.update(n,t)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);var i=t.getId();if(void 0!==i){var s=i.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new ob(O.CHANGEFEATURE,t))},t.prototype.hasFeature=function(e){var t=e.getId();return void 0!==t?t in this.idIndex_:ca(e)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&bc(this.nullGeometryFeatures_)},t.prototype.loadFeatures=function(e,t,r){var o=this.loadedExtentsRtree_,n=this.strategy_(e,t);this.loading=!1;for(var i=function(e,i){var a=n[e];o.forEachInExtent(a,function(e){return Z(e.extent,a)})||(s.loader_.call(s,a,t,r),o.insert(a,{extent:a.slice()}),s.loading=s.loader_!==Y)},s=this,a=0,u=n.length;a<u;++a)i(a)},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),e.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var t,r=this.loadedExtentsRtree_;r.forEachInExtent(e,function(r){if($a(r.extent,e))return t=r,!0}),t&&r.remove(t)},t.prototype.removeFeature=function(e){var t=ca(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e),this.changed()},t.prototype.removeFeatureInternal=function(e){var t=ca(e);this.featureChangeKeys_[t].forEach(d),delete this.featureChangeKeys_[t];var r=e.getId();void 0!==r&&delete this.idIndex_[r.toString()],delete this.uidIndex_[t],this.dispatchEvent(new ob(O.REMOVEFEATURE,e))},t.prototype.removeFromIdIndex_=function(e){var t=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===e){delete this.idIndex_[r],t=!0;break}return t},t.prototype.setLoader=function(e){this.loader_=e},t.prototype.setUrl=function(e){g(this.format_,7),this.setLoader(rh(e,this.format_))},t}(xe);Gc.default=Sb;function Bl(e,r){r&&r.clear();for(var t=e.declutterItems,$=t.length-1;$>=0;--$)for(var o=t[$],l=o.items,i=0,n=l.length;i<n;i+=3)r=l[i].renderDeclutter(l[i+1],l[i+2],o.opacity,r);return t.length=0,r}var ye={};var ze={};var ba={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function uh($){return Math.pow($,3)}function Ua($){return 1-uh(1-$)}function Cl($){return 3*$*$-2*$*$*$}function Dl($){return $}var El=ze&&ze.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function r(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ae=function(t){function i(i,e,r){var n=t.call(this)||this,o=r||{};return n.tileCoord=i,n.state=e,n.interimTile=null,n.hifi=!0,n.key="",n.transition_=void 0===o.transition?250:o.transition,n.transitionStarts_={},n}return El(i,t),i.prototype.changed=function(){this.dispatchEvent(f.CHANGE)},i.prototype.release=function(){},i.prototype.getKey=function(){return this.key+"/"+this.tileCoord},i.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==ba.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},i.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,i=this;do{if(t.getState()==ba.LOADED){t.interimTile=null;break}t.getState()==ba.LOADING?i=t:t.getState()==ba.IDLE?i.interimTile=t.interimTile:i=t,t=i.interimTile}while(t)}},i.prototype.getTileCoord=function(){return this.tileCoord},i.prototype.getState=function(){return this.state},i.prototype.setState=function(t){if(this.state!==ba.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},i.prototype.load=function(){c()},i.prototype.getAlpha=function(t,i){if(!this.transition_)return 1;var e=this.transitionStarts_[t];if(e){if(-1===e)return 1}else e=i,this.transitionStarts_[t]=e;var r=i-e+1e3/60;return r>=this.transition_?1:uh(r/this.transition_)},i.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},i.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},i}(Da);ze.default=Ae;var Fl=ye&&ye.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),vh=function(t){function e(e,i,r,n,a,s){var o=t.call(this,e,i,s)||this;return o.crossOrigin_=n,o.src_=r,o.image_=new Image,null!==n&&(o.image_.crossOrigin=n),o.unlisten_=null,o.tileLoadFunction_=a,o}return Fl(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.getKey=function(){return this.src_},e.prototype.handleImageError_=function(){this.state=ba.ERROR,this.unlistenImage_(),this.image_=Gl(),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=ba.LOADED:this.state=ba.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==ba.ERROR&&(this.state=ba.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==ba.IDLE&&(this.state=ba.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Cc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(Ae);function Gl(){var t=J(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}ye.default=vh;var Hl=function(){function t(t,i,n){this.decay_=t,this.minVelocity_=i,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}return t.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},t.prototype.update=function(t,i){this.points_.push(t,i,Date.now())},t.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<t)return!1;for(var n=i-3;n>0&&this.points_[n+2]>t;)n-=3;var e=this.points_[i+2]-this.points_[n+2];if(e<1e3/60)return!1;var s=this.points_[i]-this.points_[n],o=this.points_[i+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/e,this.initialVelocity_>this.minVelocity_},t.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},t.prototype.getAngle=function(){return this.angle_},t}();var Be={};var Ce={};var De={};var Ee={};var Il=Ee&&Ee.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tb=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.map=r,o.frameState=void 0!==n?n:null,o}return Il(e,t),e}(A);Ee.default=Tb;var Jl=De&&De.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Fe=function(t){function e(e,o,n,r,i){var p=t.call(this,e,o,i)||this;return p.originalEvent=n,p.pixel_=null,p.coordinate_=null,p.dragging=void 0!==r&&r,p}return Jl(e,t),Object.defineProperty(e.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!0,configurable:!0}),e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},e}(Tb);De.default=Fe;var Ge={};var wh=null,xh=null;function Kl(){Element.prototype.setPointerCapture=Element.prototype.setCapture,Element.prototype.releasePointerCapture=Element.prototype.releaseCapture}function He(e,t,r){e.addEventListener(t,function(e){var n=new MouseEvent(r,e);n.pointerId=1,n.isPrimary=!0,n.pointerType="mouse",n.width=1,n.height=1,n.tiltX=0,n.tiltY=0,"buttons"in e&&0!==e.buttons?n.pressure=.5:n.pressure=0;var o=e.target;null!==xh&&(o=xh,"mouseup"===t&&(xh=null)),o.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()})}function Ie(e,t,r){e.addEventListener(t,function(e){for(var n=e.changedTouches,o=n.length,i=0;i<o;i++){var a=new CustomEvent(r,{bubbles:!0,cancelable:!0});a.ctrlKey=e.ctrlKey,a.shiftKey=e.shiftKey,a.altKey=e.altKey,a.metaKey=e.metaKey;var u=n.item(i);a.clientX=u.clientX,a.clientY=u.clientY,a.screenX=u.screenX,a.screenY=u.screenY,a.pageX=u.pageX,a.pageY=u.pageY;var $=u.target.getBoundingClientRect();a.offsetX=u.clientX-$.left,a.offsetY=u.clientY-$.top,a.pointerId=1+u.identifier,a.button=0,a.buttons=1,a.movementX=0,a.movementY=0,a.region=null,a.relatedTarget=null,a.x=a.clientX,a.y=a.clientY,a.pointerType="touch",a.width=1,a.height=1,a.tiltX=0,a.tiltY=0,a.pressure=1,"touchstart"===t&&null===wh&&(wh=u.identifier),a.isPrimary=u.identifier===wh,"touchend"===t&&a.isPrimary&&(wh=null),e.target.dispatchEvent(a),a.defaultPrevented&&e.preventDefault()}})}"PointerEvent"in window||(Kl(),"TouchEvent"in window||(He(document,"mousedown","pointerdown"),He(document,"mousemove","pointermove"),He(document,"mouseup","pointerup")),Ie(document,"touchstart","pointerdown"),Ie(document,"touchmove","pointermove"),Ie(document,"touchend","pointerup"));var b={SINGLECLICK:"singleclick",CLICK:f.CLICK,DBLCLICK:f.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var Je={};var Ll=Je&&Je.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),na=function(t){function r(r,e,o,n,s){var $=t.call(this,r,e,o,n,s)||this;return $.pointerEvent=o,$}return Ll(r,t),r}(Fe);Je.default=na;var oa={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var Ml=Ge&&Ge.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),yh=function(t){function e(e,i){var r=t.call(this,e)||this;r.map_=e,r.clickTimeoutId_,r.dragging_=!1,r.dragListenerKeys_=[],r.moveTolerance_=i?i*Bc:Bc,r.down_=null;var n=r.map_.getViewport();return r.activePointers_=0,r.trackedTouches_={},r.element_=n,r.pointerdownListenerKey_=a(n,oa.POINTERDOWN,r.handlePointerDown_,r),r.originalPointerMoveEvent_,r.relayedListenerKey_=a(n,oa.POINTERMOVE,r.relayEvent_,r),r.boundHandleTouchMove_=r.handleTouchMove_.bind(r),r.element_.addEventListener(f.TOUCHMOVE,r.boundHandleTouchMove_,!!lh&&{passive:!1}),r}return Ml(e,t),e.prototype.emulateClick_=function(t){var e=new na(b.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new na(b.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var e=new na(b.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)},e.prototype.updateActivePointers_=function(t){var e=t;e.type==b.POINTERUP||e.type==b.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==b.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new na(b.POINTERUP,this.map_,t);this.dispatchEvent(e),e.propagationStopped||this.dragging_||!this.isMouseActionButton_(t)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(d),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},e.prototype.isMouseActionButton_=function(t){return 0===t.button},e.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var e=new na(b.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_=t,0===this.dragListenerKeys_.length&&this.dragListenerKeys_.push(a(document,b.POINTERMOVE,this.handlePointerMove_,this),a(document,b.POINTERUP,this.handlePointerUp_,this),a(this.element_,b.POINTERCANCEL,this.handlePointerUp_,this))},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new na(b.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}},e.prototype.relayEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new na(t.type,this.map_,t,e))},e.prototype.handleTouchMove_=function(t){this.originalPointerMoveEvent_.defaultPrevented&&t.preventDefault()},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(d(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(f.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(d(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(d),this.dragListenerKeys_.length=0,this.element_=null,t.prototype.disposeInternal.call(this)},e}(Da);Ge.default=yh;var pb={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"};var s={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var Ke={};var Ic=1/0;var Nl=function(){function t(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return t.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,Xa(this.queuedElements_)},t.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(i);return delete this.queuedElements_[n],i},t.prototype.enqueue=function(t){g(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=Ic&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},t.prototype.getCount=function(){return this.elements_.length},t.prototype.getLeftChildIndex_=function(t){return 2*t+1},t.prototype.getRightChildIndex_=function(t){return 2*t+2},t.prototype.getParentIndex_=function(t){return t-1>>1},t.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},t.prototype.isEmpty=function(){return 0===this.elements_.length},t.prototype.isKeyQueued=function(t){return t in this.queuedElements_},t.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},t.prototype.siftUp_=function(t){for(var e=this.elements_,i=this.priorities_,n=e.length,r=e[t],s=i[t],o=t;t<n>>1;){var u=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),p=h<n&&i[h]<i[u]?h:u;e[t]=e[p],i[t]=i[p],t=p}e[t]=r,i[t]=s,this.siftDown_(o,t)},t.prototype.siftDown_=function(t,e){for(var i=this.elements_,n=this.priorities_,r=i[e],s=n[e];e>t;){var o=this.getParentIndex_(e);if(!(n[o]>s))break;i[e]=i[o],n[e]=n[o],e=o}i[e]=r,n[e]=s},t.prototype.reprioritize=function(){var t,e,i,n=this.priorityFunction_,r=this.elements_,s=this.priorities_,o=0,u=r.length;for(e=0;e<u;++e)(i=n(t=r[e]))==Ic?delete this.queuedElements_[this.keyFunction_(t)]:(s[o]=i,r[o++]=t);r.length=o,s.length=o,this.heapify_()},t}();var Ol=Ke&&Ke.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zh=function(e){function t(t,i){var n=e.call(this,function(e){return t.apply(null,e)},function(e){return e[0].getKey()})||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=i,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return Ol(t,e),t.prototype.enqueue=function(t){var i=e.prototype.enqueue.call(this,t);i&&t[0].addEventListener(f.CHANGE,this.boundHandleTileChange_);return i},t.prototype.getTilesLoading=function(){return this.tilesLoading_},t.prototype.handleTileChange=function(e){var t=e.target,i=t.getState();if(t.hifi&&i===ba.LOADED||i===ba.ERROR||i===ba.EMPTY){t.removeEventListener(f.CHANGE,this.boundHandleTileChange_);var n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},t.prototype.loadMoreTiles=function(e,t){for(var i,n,r=0;this.tilesLoading_<e&&r<t&&this.getCount()>0;)n=(i=this.dequeue()[0]).getKey(),i.getState()!==ba.IDLE||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++r,i.load())},t}(Nl);Ke.default=zh;var Va={};var Pl=42;var Le=256;function Ah(t,$,e){return function(r,a,o,n){if(r){var f=$?0:o[0]*a,x=$?0:o[1]*a,E=t[0]+f/2,p=t[2]-f/2,B=t[1]+x/2,P=t[3]-x/2;E>p&&(p=E=(p+E)/2),B>P&&(P=B=(P+B)/2);var c=z(r[0],E,p),h=z(r[1],B,P),m=30*a;return n&&e&&(c+=-m*Math.log(1+Math.max(0,E-r[0])/m)+m*Math.log(1+Math.max(0,r[0]-p)/m),h+=-m*Math.log(1+Math.max(0,B-r[1])/m)+m*Math.log(1+Math.max(0,r[1]-P)/m)),[c,h]}}}function Ql(t){return t}function Me(t,e,o,r){var a=D(e)/o[0],$=P(e)/o[1];return r?Math.min(t,Math.max(a,$)):Math.min(t,Math.min(a,$))}function Ne(t,e,o){var r=Math.min(t,e);return r*=Math.log(1+50*Math.max(0,t/e-1))/50+1,o&&(r=Math.max(r,o),r/=Math.log(1+50*Math.max(0,o/t-1))/50+1),z(r,o/2,2*e)}function Rl(t,e,o,r){return function(a,$,u,i){if(void 0!==a){var n=t[0],x=t[t.length-1],p=o?Me(n,o,u,r):n;if(i)return void 0===e||e?Ne(a,p,x):z(a,x,p);var l=Math.min(p,a),m=Math.floor(od(t,l,$));return t[m]>p&&m<t.length-1?t[m+1]:t[m]}}}function Sl(t,e,o,r,a,$){return function(u,i,n,x){if(void 0!==u){var p=a?Me(e,a,n,$):e,l=void 0!==o?o:0;if(x)return void 0===r||r?Ne(u,p,l):z(u,l,p);var m=Math.ceil(Math.log(e/p)/Math.log(t)-1e-9),h=-i*(.5-1e-9)+.5,O=Math.min(p,u),M=Math.floor(Math.log(e/O)/Math.log(t)+h),c=Math.max(m,M),s=e/Math.pow(t,c);return z(s,l,p)}}}function Bh(t,e,o,r,a){return function($,u,i,n){if(void 0!==$){var x=r?Me(t,r,i,a):t;return(void 0===o||o)&&n?Ne($,x,e):z($,e,x)}}}function Oe(e){return void 0!==e?0:void 0}function Ch(e){return void 0!==e?e:void 0}function Tl(e){var o=2*Math.PI/e;return function(e,r){return r?e:void 0!==e?e=Math.floor(e/o+.5)*o:void 0}}function Ul(e){var o=e||_(5);return function(e,r){return r?e:void 0!==e?Math.abs(e)<=o?0:e:void 0}}var M={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var Vl=Va&&Va.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Pe=0,Ub=function(t){function o(o){var e=t.call(this)||this,r=G({},o);return e.hints_=[0,0],e.animations_=[],e.updateAnimationKey_,e.projection_=Ad(r.projection,"EPSG:3857"),e.viewportSize_=[100,100],e.targetCenter_=null,e.targetResolution_,e.targetRotation_,e.cancelAnchor_=void 0,r.center&&(r.center=q(r.center,e.projection_)),r.extent&&(r.extent=ua(r.extent,e.projection_)),e.applyOptions_(r),e}return Vl(o,t),o.prototype.applyOptions_=function(t){var o=Eh(t);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=o.minZoom;var e=Dh(t),r=o.constraint,i=Fh(t);this.constraints_={center:e,resolution:r,rotation:i},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom),this.resolveConstraints(0),this.setProperties({}),this.options_=t},o.prototype.getUpdatedOptions_=function(t){var o=G({},this.options_);return void 0!==o.resolution?o.resolution=this.getResolution():o.zoom=this.getZoom(),o.center=this.getCenterInternal(),o.rotation=this.getRotation(),G({},o,t)},o.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var o=new Array(arguments.length),e=0;e<o.length;++e){var r=arguments[e];r.center&&((r=G({},r)).center=q(r.center,this.getProjection())),r.anchor&&((r=G({},r)).anchor=q(r.anchor,this.getProjection())),o[e]=r}this.animateInternal.apply(this,o)},o.prototype.animateInternal=function(t){var o,e=arguments.length;if(e>1&&"function"==typeof arguments[e-1]&&(o=arguments[e-1],--e),!this.isDef()){var r=arguments[e-1];return r.center&&this.setCenterInternal(r.center),void 0!==r.zoom&&this.setZoom(r.zoom),void 0!==r.rotation&&this.setRotation(r.rotation),void(o&&Jc(o,!0))}for(var i=Date.now(),n=this.targetCenter_.slice(),s=this.targetResolution_,a=this.targetRotation_,p=[],$=0;$<e;++$){var u=arguments[$],h={start:i,complete:!1,anchor:u.anchor,duration:void 0!==u.duration?u.duration:1e3,easing:u.easing||Cl,callback:o};if(u.center&&(h.sourceCenter=n,h.targetCenter=u.center.slice(),n=h.targetCenter),void 0!==u.zoom?(h.sourceResolution=s,h.targetResolution=this.getResolutionForZoom(u.zoom),s=h.targetResolution):u.resolution&&(h.sourceResolution=s,h.targetResolution=u.resolution,s=h.targetResolution),void 0!==u.rotation){h.sourceRotation=a;var l=Ja(u.rotation-a+Math.PI,2*Math.PI)-Math.PI;h.targetRotation=a+l,a=h.targetRotation}Gh(h)?h.complete=!0:i+=h.duration,p.push(h)}this.animations_.push(p),this.setHint(B.ANIMATING,1),this.updateAnimations_()},o.prototype.getAnimating=function(){return this.hints_[B.ANIMATING]>0},o.prototype.getInteracting=function(){return this.hints_[B.INTERACTING]>0},o.prototype.cancelAnimations=function(){var t;this.setHint(B.ANIMATING,-this.hints_[B.ANIMATING]);for(var o=0,e=this.animations_.length;o<e;++o){var r=this.animations_[o];if(r[0].callback&&Jc(r[0].callback,!1),!t)for(var i=0,n=r.length;i<n;++i){var s=r[i];if(!s.complete){t=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t},o.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),o=!1,e=this.animations_.length-1;e>=0;--e){for(var r=this.animations_[e],i=!0,n=0,s=r.length;n<s;++n){var a=r[n];if(!a.complete){var p=t-a.start,$=a.duration>0?p/a.duration:1;$>=1?(a.complete=!0,$=1):i=!1;var u=a.easing($);if(a.sourceCenter){var h=a.sourceCenter[0],l=a.sourceCenter[1],c=h+u*(a.targetCenter[0]-h),m=l+u*(a.targetCenter[1]-l);this.targetCenter_=[c,m]}if(a.sourceResolution&&a.targetResolution){var g=1===u?a.targetResolution:a.sourceResolution+u*(a.targetResolution-a.sourceResolution);if(a.anchor){var _=this.getViewportSize_(this.getRotation()),R=this.constraints_.resolution(g,0,_,!0);this.targetCenter_=this.calculateCenterZoom(R,a.anchor)}this.targetResolution_=g,this.applyTargetState_(!0)}if(void 0!==a.sourceRotation&&void 0!==a.targetRotation){var L=1===u?Ja(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+u*(a.targetRotation-a.sourceRotation);if(a.anchor){var v=this.constraints_.rotation(L,!0);this.targetCenter_=this.calculateCenterRotate(v,a.anchor)}this.targetRotation_=L}if(this.applyTargetState_(!0),o=!0,!a.complete)break}}if(i){this.animations_[e]=null,this.setHint(B.ANIMATING,-1);var f=r[0].callback;f&&Jc(f,!0)}}this.animations_=this.animations_.filter(Boolean),o&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},o.prototype.calculateCenterRotate=function(t,o){var e,r=this.getCenterInternal();return void 0!==r&&(e=[r[0]-o[0],r[1]-o[1]],te(e,t-this.getRotation()),sl(e,o)),e},o.prototype.calculateCenterZoom=function(t,o){var e,r=this.getCenterInternal(),i=this.getResolution();void 0!==r&&void 0!==i&&(e=[o[0]-t*(o[0]-r[0])/i,o[1]-t*(o[1]-r[1])/i]);return e},o.prototype.getViewportSize_=function(t){var o=this.viewportSize_;if(t){var e=o[0],r=o[1];return[Math.abs(e*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(e*Math.sin(t))+Math.abs(r*Math.cos(t))]}return o},o.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100]},o.prototype.getCenter=function(){var t=this.getCenterInternal();return t?Fb(t,this.getProjection()):t},o.prototype.getCenterInternal=function(){return this.get(M.CENTER)},o.prototype.getConstraints=function(){return this.constraints_},o.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},o.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},o.prototype.calculateExtent=function(t){var o=this.calculateExtentInternal(t);return Gb(o,this.getProjection())},o.prototype.calculateExtentInternal=function(t){var o=t||this.getViewportSize_(),e=this.getCenterInternal();g(e,1);var r=this.getResolution();g(void 0!==r,2);var i=this.getRotation();return g(void 0!==i,3),dg(e,r,i,o)},o.prototype.getMaxResolution=function(){return this.maxResolution_},o.prototype.getMinResolution=function(){return this.minResolution_},o.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},o.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},o.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},o.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},o.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},o.prototype.getProjection=function(){return this.projection_},o.prototype.getResolution=function(){return this.get(M.RESOLUTION)},o.prototype.getResolutions=function(){return this.resolutions_},o.prototype.getResolutionForExtent=function(t,o){return this.getResolutionForExtentInternal(ua(t,this.getProjection()),o)},o.prototype.getResolutionForExtentInternal=function(t,o){var e=o||this.getViewportSize_(),r=D(t)/e[0],i=P(t)/e[1];return Math.max(r,i)},o.prototype.getResolutionForValueFunction=function(t){var o=t||2,e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,i=Math.log(e/r)/Math.log(o);return function(t){return e/Math.pow(o,t*i)}},o.prototype.getRotation=function(){return this.get(M.ROTATION)},o.prototype.getValueForResolutionFunction=function(t){var o=Math.log(t||2),e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,i=Math.log(e/r)/o;return function(t){return Math.log(e/t)/o/i}},o.prototype.getState=function(){var t=this.getCenterInternal(),o=this.getProjection(),e=this.getResolution(),r=this.getRotation();return{center:t.slice(0),projection:void 0!==o?o:null,resolution:e,rotation:r,zoom:this.getZoom()}},o.prototype.getZoom=function(){var t,o=this.getResolution();return void 0!==o&&(t=this.getZoomForResolution(o)),t},o.prototype.getZoomForResolution=function(t){var o,e,r=this.minZoom_||0;if(this.resolutions_){var i=od(this.resolutions_,t,1);r=i,o=this.resolutions_[i],e=i==this.resolutions_.length-1?2:o/this.resolutions_[i+1]}else o=this.maxResolution_,e=this.zoomFactor_;return r+Math.log(o/t)/Math.log(e)},o.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var o=z(Math.floor(t),0,this.resolutions_.length-2),e=this.resolutions_[o]/this.resolutions_[o+1];return this.resolutions_[o]/Math.pow(e,z(t-o,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},o.prototype.fit=function(t,o){var e,r=G({size:this.getViewportSize_()},o||{});if(g(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)){g(!vd(t),25);var i=ua(t,this.getProjection());e=Oa(i)}else if(t.getType()===k.CIRCLE){i=ua(t.getExtent(),this.getProjection());(e=Oa(i)).rotate(this.getRotation(),zb(i))}else{var n=fb();e=n?t.clone().transform(n,this.getProjection()):t}this.fitInternal(e,r)},o.prototype.fitInternal=function(t,o){var e=o||{},r=e.size;r||(r=this.getViewportSize_());var i,n=void 0!==e.padding?e.padding:[0,0,0,0],s=void 0!==e.nearest&&e.nearest;i=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;for(var a=t.getFlatCoordinates(),p=this.getRotation(),$=Math.cos(-p),u=Math.sin(-p),h=1/0,l=1/0,c=-1/0,m=-1/0,g=t.getStride(),_=0,R=a.length;_<R;_+=g){var L=a[_]*$-a[_+1]*u,v=a[_]*u+a[_+1]*$;h=Math.min(h,L),l=Math.min(l,v),c=Math.max(c,L),m=Math.max(m,v)}var f=this.getResolutionForExtentInternal([h,l,c,m],[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]);f=isNaN(f)?i:Math.max(f,i),f=this.getConstrainedResolution(f,s?0:1),u=-u;var d=(h+c)/2,X=(l+m)/2,y=[(d+=(n[1]-n[3])/2*f)*$-(X+=(n[0]-n[2])/2*f)*u,X*$+d*u],C=e.callback?e.callback:Y;void 0!==e.duration?this.animateInternal({resolution:f,center:this.getConstrainedCenter(y,f),duration:e.duration,easing:e.easing},C):(this.targetResolution_=f,this.targetCenter_=y,this.applyTargetState_(!1,!0),Jc(C,!0))},o.prototype.centerOn=function(t,o,e){this.centerOnInternal(q(t,this.getProjection()),o,e)},o.prototype.centerOnInternal=function(t,o,e){var r=this.getRotation(),i=Math.cos(-r),n=Math.sin(-r),s=t[0]*i-t[1]*n,a=t[1]*i+t[0]*n,p=this.getResolution(),$=(s+=(o[0]/2-e[0])*p)*i-(a+=(e[1]-o[1]/2)*p)*(n=-n),u=a*i+s*n;this.setCenterInternal([$,u])},o.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},o.prototype.adjustCenter=function(t){var o=Fb(this.targetCenter_,this.getProjection());this.setCenter([o[0]+t[0],o[1]+t[1]])},o.prototype.adjustCenterInternal=function(t){var o=this.targetCenter_;this.setCenterInternal([o[0]+t[0],o[1]+t[1]])},o.prototype.adjustResolution=function(t,o){var e=o&&q(o,this.getProjection());this.adjustResolutionInternal(t,e)},o.prototype.adjustResolutionInternal=function(t,o){var e=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(this.targetResolution_*t,0,r,e);o&&(this.targetCenter_=this.calculateCenterZoom(i,o)),this.targetResolution_*=t,this.applyTargetState_()},o.prototype.adjustZoom=function(t,o){this.adjustResolution(Math.pow(this.zoomFactor_,-t),o)},o.prototype.adjustRotation=function(t,o){o&&(o=q(o,this.getProjection())),this.adjustRotationInternal(t,o)},o.prototype.adjustRotationInternal=function(t,o){var e=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,e);o&&(this.targetCenter_=this.calculateCenterRotate(r,o)),this.targetRotation_+=t,this.applyTargetState_()},o.prototype.setCenter=function(t){this.setCenterInternal(q(t,this.getProjection()))},o.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},o.prototype.setHint=function(t,o){return this.hints_[t]+=o,this.changed(),this.hints_[t]},o.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},o.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},o.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},o.prototype.applyTargetState_=function(t,o){var e=this.getAnimating()||this.getInteracting()||o,r=this.constraints_.rotation(this.targetRotation_,e),i=this.getViewportSize_(r),n=this.constraints_.resolution(this.targetResolution_,0,i,e),s=this.constraints_.center(this.targetCenter_,n,i,e);this.get(M.ROTATION)!==r&&this.set(M.ROTATION,r),this.get(M.RESOLUTION)!==n&&this.set(M.RESOLUTION,n),this.get(M.CENTER)&&W(this.get(M.CENTER),s)||this.set(M.CENTER,s),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},o.prototype.resolveConstraints=function(t,o,e){var r=void 0!==t?t:200,i=o||0,n=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(n),a=this.constraints_.resolution(this.targetResolution_,i,s),p=this.constraints_.center(this.targetCenter_,a,s);if(0===r&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=n,this.targetCenter_=p,void this.applyTargetState_();var $=e||(0===r?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===a&&this.getRotation()===n&&this.getCenterInternal()&&W(this.getCenterInternal(),p)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:n,center:p,resolution:a,duration:r,easing:Ua,anchor:$}))},o.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(B.INTERACTING,1)},o.prototype.endInteraction=function(t,o,e){var r=e&&q(e,this.getProjection());this.endInteractionInternal(t,o,r)},o.prototype.endInteractionInternal=function(t,o,e){this.setHint(B.INTERACTING,-1),this.resolveConstraints(t,o,e)},o.prototype.getConstrainedCenter=function(t,o){var e=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,o||this.getResolution(),e)},o.prototype.getConstrainedZoom=function(t,o){var e=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(e,o))},o.prototype.getConstrainedResolution=function(t,o){var e=o||0,r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,r)},o}(e);function Jc(t,o){setTimeout(function(){t(o)},0)}function Dh(t){if(void 0!==t.extent){var o=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Ah(t.extent,t.constrainOnlyCenter,o)}var e=Ad(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){var r=e.getExtent().slice();return r[0]=-1/0,r[2]=1/0,Ah(r,!1,!1)}return Ql}function Eh(t){var o,e,r,i=void 0!==t.minZoom?t.minZoom:Pe,n=void 0!==t.maxZoom?t.maxZoom:28,s=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,p=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,$=void 0!==t.showFullExtent&&t.showFullExtent,u=Ad(t.projection,"EPSG:3857"),h=u.getExtent(),l=t.constrainOnlyCenter,c=t.extent;if(a||c||!u.isGlobal()||(l=!1,c=h),void 0!==t.resolutions){var m=t.resolutions;e=m[i],r=void 0!==m[n]?m[n]:m[m.length-1],o=t.constrainResolution?Rl(m,p,!l&&c,$):Bh(e,r,p,!l&&c,$)}else{var g=(h?Math.max(D(h),P(h)):360*Q[E.DEGREES]/u.getMetersPerUnit())/Le/Math.pow(2,Pe),_=g/Math.pow(2,28-Pe);void 0!==(e=t.maxResolution)?i=0:e=g/Math.pow(s,i),void 0===(r=t.minResolution)&&(r=void 0!==t.maxZoom?void 0!==t.maxResolution?e/Math.pow(s,n):g/Math.pow(s,n):_),n=i+Math.floor(Math.log(e/r)/Math.log(s)),r=e/Math.pow(s,n-i),o=t.constrainResolution?Sl(s,e,r,p,!l&&c,$):Bh(e,r,p,!l&&c,$)}return{constraint:o,maxResolution:e,minResolution:r,minZoom:i,zoomFactor:s}}function Fh(t){if(void 0===t.enableRotation||t.enableRotation){var o=t.constrainRotation;return void 0===o||!0===o?Ul():!1===o?Ch:"number"==typeof o?Tl(o):Ch}return Oe}function Gh(t){return!(t.sourceCenter&&t.targetCenter&&!W(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}Va.createCenterConstraint=Dh,Va.createResolutionConstraint=Eh,Va.createRotationConstraint=Fh,Va.isNoopAnimation=Gh,Va.default=Ub;var Qe={};var Wl=Qe&&Qe.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),Re={LAYERS:"layers"},Hh=function(e){function t(t){var r=this,s=t||{},i=G({},s);delete i.layers;var n=s.layers;return(r=e.call(this,i)||this).layersListenerKeys_=[],r.listenerKeys_={},r.addEventListener(l(Re.LAYERS),r.handleLayersChanged_),n?Array.isArray(n)?n=new x(n.slice(),{unique:!0}):g("function"==typeof n.getArray,43):n=new x(void 0,{unique:!0}),r.setLayers(n),r}return Wl(t,e),t.prototype.handleLayerChange_=function(){this.changed()},t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(d),this.layersListenerKeys_.length=0;var e=this.getLayers();for(var t in this.layersListenerKeys_.push(a(e,u.ADD,this.handleLayersAdd_,this),a(e,u.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(d);Xa(this.listenerKeys_);for(var r=e.getArray(),s=0,i=r.length;s<i;s++){var n=r[s];this.listenerKeys_[ca(n)]=[a(n,qa.PROPERTYCHANGE,this.handleLayerChange_,this),a(n,f.CHANGE,this.handleLayerChange_,this)]}this.changed()},t.prototype.handleLayersAdd_=function(e){var t=e.element;this.listenerKeys_[ca(t)]=[a(t,qa.PROPERTYCHANGE,this.handleLayerChange_,this),a(t,f.CHANGE,this.handleLayerChange_,this)],this.changed()},t.prototype.handleLayersRemove_=function(e){var t=e.element,r=ca(t);this.listenerKeys_[r].forEach(d),delete this.listenerKeys_[r],this.changed()},t.prototype.getLayers=function(){return this.get(Re.LAYERS)},t.prototype.setLayers=function(e){this.set(Re.LAYERS,e)},t.prototype.getLayersArray=function(e){var t=void 0!==e?e:[];return this.getLayers().forEach(function(e){e.getLayersArray(t)}),t},t.prototype.getLayerStatesArray=function(e){var t=void 0!==e?e:[],r=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});for(var s=this.getLayerState(),i=r,n=t.length;i<n;i++){var o=t[i];o.opacity*=s.opacity,o.visible=o.visible&&s.visible,o.maxResolution=Math.min(o.maxResolution,s.maxResolution),o.minResolution=Math.max(o.minResolution,s.minResolution),o.minZoom=Math.max(o.minZoom,s.minZoom),o.maxZoom=Math.min(o.maxZoom,s.maxZoom),void 0!==s.extent&&(void 0!==o.extent?o.extent=Ab(o.extent,s.extent):o.extent=s.extent)}return t},t.prototype.getSourceState=function(){return Qa.READY},t}(Yd);Qe.default=Hh;function Xl($){return $[0]>0&&$[1]>0}function Yl($,r,e){return void 0===e&&(e=[0,0]),e[0]=$[0]*r+.5|0,e[1]=$[1]*r+.5|0,e}function za($,r){return Array.isArray($)?$:(void 0===r?r=[$,$]:(r[0]=$,r[1]=$),r)}var Zl=Ce&&Ce.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Se=function(e){function t(t){var r=e.call(this)||this,i=$l(t);r.boundHandleBrowserEvent_=r.handleBrowserEvent.bind(r),r.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,r.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Bc,r.postRenderTimeoutHandle_,r.animationDelayKey_,r.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(r),r.coordinateToPixelTransform_=R(),r.pixelToCoordinateTransform_=R(),r.frameIndex_=0,r.frameState_=null,r.previousExtent_=null,r.viewPropertyListenerKey_=null,r.viewChangeListenerKey_=null,r.layerGroupPropertyListenerKeys_=null,r.viewport_=document.createElement("div"),r.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),r.viewport_.style.position="relative",r.viewport_.style.overflow="hidden",r.viewport_.style.width="100%",r.viewport_.style.height="100%",r.overlayContainer_=document.createElement("div"),r.overlayContainer_.style.position="absolute",r.overlayContainer_.style.zIndex="0",r.overlayContainer_.style.width="100%",r.overlayContainer_.style.height="100%",r.overlayContainer_.className="ol-overlaycontainer",r.viewport_.appendChild(r.overlayContainer_),r.overlayContainerStopEvent_=document.createElement("div"),r.overlayContainerStopEvent_.style.position="absolute",r.overlayContainerStopEvent_.style.zIndex="0",r.overlayContainerStopEvent_.style.width="100%",r.overlayContainerStopEvent_.style.height="100%",r.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",r.viewport_.appendChild(r.overlayContainerStopEvent_),r.mapBrowserEventHandler_=new yh(r,t.moveTolerance);var n=r.handleMapBrowserEvent.bind(r);for(var o in b)r.mapBrowserEventHandler_.addEventListener(b[o],n);r.keyboardEventTarget_=i.keyboardEventTarget,r.keyHandlerKeys_=null;var a=r.handleBrowserEvent.bind(r);return r.viewport_.addEventListener(f.CONTEXTMENU,a,!1),r.viewport_.addEventListener(f.WHEEL,a,!!lh&&{passive:!1}),r.controls=i.controls||new x,r.interactions=i.interactions||new x,r.overlays_=i.overlays,r.overlayIdIndex_={},r.renderer_=null,r.handleResize_,r.postRenderFunctions_=[],r.tileQueue_=new zh(r.getTilePriority.bind(r),r.handleTileChange_.bind(r)),r.addEventListener(l(s.LAYERGROUP),r.handleLayerGroupChanged_),r.addEventListener(l(s.VIEW),r.handleViewChanged_),r.addEventListener(l(s.SIZE),r.handleSizeChanged_),r.addEventListener(l(s.TARGET),r.handleTargetChanged_),r.setProperties(i.values),r.controls.forEach(function(e){e.setMap(this)}.bind(r)),r.controls.addEventListener(u.ADD,function(e){e.element.setMap(this)}.bind(r)),r.controls.addEventListener(u.REMOVE,function(e){e.element.setMap(null)}.bind(r)),r.interactions.forEach(function(e){e.setMap(this)}.bind(r)),r.interactions.addEventListener(u.ADD,function(e){e.element.setMap(this)}.bind(r)),r.interactions.addEventListener(u.REMOVE,function(e){e.element.setMap(null)}.bind(r)),r.overlays_.forEach(r.addOverlayInternal_.bind(r)),r.overlays_.addEventListener(u.ADD,function(e){this.addOverlayInternal_(e.element)}.bind(r)),r.overlays_.addEventListener(u.REMOVE,function(e){var t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}.bind(r)),r}return Zl(t,e),t.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},t.prototype.addControl=function(e){this.getControls().push(e)},t.prototype.addInteraction=function(e){this.getInteractions().push(e)},t.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)},t.prototype.addOverlay=function(e){this.getOverlays().push(e)},t.prototype.addOverlayInternal_=function(e){var t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)},t.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),this.viewport_.removeEventListener(f.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(f.WHEEL,this.boundHandleBrowserEvent_),void 0!==this.handleResize_&&(removeEventListener(f.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.setTarget(null),e.prototype.disposeInternal.call(this)},t.prototype.forEachFeatureAtPixel=function(e,t,r){if(this.frameState_){var i=this.getCoordinateFromPixelInternal(e),n=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,o=void 0!==r.layerFilter?r.layerFilter:H,a=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,n,a,t,null,o,null)}},t.prototype.getFeaturesAtPixel=function(e,t){var r=[];return this.forEachFeatureAtPixel(e,function(e){r.push(e)},t),r},t.prototype.forEachLayerAtPixel=function(e,t,r){if(this.frameState_){var i=r||{},n=void 0!==i.hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,o=i.layerFilter||H;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,n,t,o)}},t.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_)return!1;var r=this.getCoordinateFromPixelInternal(e),i=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:H,n=void 0!==t.hitTolerance?t.hitTolerance*this.frameState_.pixelRatio:0,o=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,n,o,i,null)},t.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},t.prototype.getEventCoordinateInternal=function(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))},t.prototype.getEventPixel=function(e){var t=this.viewport_.getBoundingClientRect(),r="changedTouches"in e?e.changedTouches[0]:e;return[r.clientX-t.left,r.clientY-t.top]},t.prototype.getTarget=function(){return this.get(s.TARGET)},t.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null},t.prototype.getCoordinateFromPixel=function(e){return Fb(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())},t.prototype.getCoordinateFromPixelInternal=function(e){var t=this.frameState_;return t?da(t.pixelToCoordinateTransform,e.slice()):null},t.prototype.getControls=function(){return this.controls},t.prototype.getOverlays=function(){return this.overlays_},t.prototype.getOverlayById=function(e){var t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getInteractions=function(){return this.interactions},t.prototype.getLayerGroup=function(){return this.get(s.LAYERGROUP)},t.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},t.prototype.getLoading=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),t=0,r=e.length;t<r;++t){var i=e[t].layer.getSource();if(i&&i.loading)return!0}return!1},t.prototype.getPixelFromCoordinate=function(e){var t=q(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)},t.prototype.getPixelFromCoordinateInternal=function(e){var t=this.frameState_;return t?da(t.coordinateToPixelTransform,e.slice(0,2)):null},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.getSize=function(){return this.get(s.SIZE)},t.prototype.getView=function(){return this.get(s.VIEW)},t.prototype.getViewport=function(){return this.viewport_},t.prototype.getOverlayContainer=function(){return this.overlayContainer_},t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.prototype.getTilePriority=function(e,t,r,i){var n=this.frameState_;if(!(n&&t in n.wantedTiles))return Ic;if(!n.wantedTiles[t][e.getKey()])return Ic;var o=n.viewState.center,a=r[0]-o[0],s=r[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i},t.prototype.handleBrowserEvent=function(e,t){var r=t||e.type,i=new Fe(r,this,e);this.handleMapBrowserEvent(i)},t.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){var t=e.originalEvent.target;if(e.dragging||!this.overlayContainerStopEvent_.contains(t)&&(document.body.contains(t)||this.viewport_.getRootNode&&this.viewport_.getRootNode().contains(t))){e.frameState=this.frameState_;var r=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(var i=r.length-1;i>=0;i--){var n=r[i];if(n.getActive())if(!n.handleEvent(e))break}}}},t.prototype.handlePostRender=function(){var e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){var r=this.maxTilesLoading_,i=r;if(e){var n=e.viewHints;if(n[B.ANIMATING]||n[B.INTERACTING]){var o=!kh&&Date.now()-e.time>8;r=o?0:8,i=o?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,i))}!e||!this.hasListener(Pa.RENDERCOMPLETE)||e.animate||this.tileQueue_.getTilesLoading()||this.getLoading()||this.renderer_.dispatchRenderEvent(Pa.RENDERCOMPLETE,e);for(var a=this.postRenderFunctions_,s=0,p=a.length;s<p;++s)a[s](this,e);a.length=0},t.prototype.handleSizeChanged_=function(){this.getView()&&this.getView().resolveConstraints(0),this.render()},t.prototype.handleTargetChanged_=function(){var e;if(this.getTarget()&&(e=this.getTargetElement()),this.keyHandlerKeys_){for(var t=0,r=this.keyHandlerKeys_.length;t<r;++t)d(this.keyHandlerKeys_[t]);this.keyHandlerKeys_=null}if(e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer());var i=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[a(i,f.KEYDOWN,this.handleBrowserEvent,this),a(i,f.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(f.RESIZE,this.handleResize_,!1))}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),mc(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(f.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},t.prototype.handleTileChange_=function(){this.render()},t.prototype.handleViewPropertyChanged_=function(){this.render()},t.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(d(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(d(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=a(e,qa.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=a(e,f.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()},t.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(d),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[a(e,qa.PROPERTYCHANGE,this.render,this),a(e,f.CHANGE,this.render,this)]),this.render()},t.prototype.isRendered=function(){return!!this.frameState_},t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},t.prototype.redrawText=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),t=0,r=e.length;t<r;++t){var i=e[t].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}},t.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},t.prototype.removeControl=function(e){return this.getControls().remove(e)},t.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},t.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)},t.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},t.prototype.renderFrame_=function(e){var t=this.getSize(),r=this.getView(),i=this.frameState_,n=null;if(void 0!==t&&Xl(t)&&r&&r.isDef()){var o=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=r.getState();n={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterItems:i?i.declutterItems:[],extent:dg(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{}}}if(this.frameState_=n,this.renderer_.renderFrame(n),n){if(n.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,n.postRenderFunctions),i)(!this.previousExtent_||!vd(this.previousExtent_)&&!$a(n.extent,this.previousExtent_))&&(this.dispatchEvent(new Tb(pb.MOVESTART,this,i)),this.previousExtent_=yb(this.previousExtent_));this.previousExtent_&&!n.viewHints[B.ANIMATING]&&!n.viewHints[B.INTERACTING]&&!$a(n.extent,this.previousExtent_)&&(this.dispatchEvent(new Tb(pb.MOVEEND,this,n)),Zf(n.extent,this.previousExtent_))}this.dispatchEvent(new Tb(pb.POSTRENDER,this,n)),this.postRenderTimeoutHandle_=setTimeout(this.handlePostRender.bind(this),0)},t.prototype.setLayerGroup=function(e){this.set(s.LAYERGROUP,e)},t.prototype.setSize=function(e){this.set(s.SIZE,e)},t.prototype.setTarget=function(e){this.set(s.TARGET,e)},t.prototype.setView=function(e){this.set(s.VIEW,e)},t.prototype.updateSize=function(){var e=this.getTargetElement();if(e){var t=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)])}else this.setSize(void 0);this.updateViewportSize_()},t.prototype.updateViewportSize_=function(){var e=this.getView();if(e){var t=void 0,r=getComputedStyle(this.viewport_);r.width&&r.height&&(t=[parseInt(r.width,10),parseInt(r.height,10)]),e.setViewportSize(t)}},t}(e);function $l(e){var t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);var r,i,n,o={},a=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new Hh({layers:e.layers});return o[s.LAYERGROUP]=a,o[s.TARGET]=e.target,o[s.VIEW]=void 0!==e.view?e.view:new Ub,void 0!==e.controls&&(Array.isArray(e.controls)?r=new x(e.controls.slice()):(g("function"==typeof e.controls.getArray,47),r=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?i=new x(e.interactions.slice()):(g("function"==typeof e.interactions.getArray,48),i=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?n=new x(e.overlays.slice()):(g("function"==typeof e.overlays.getArray,49),n=e.overlays):n=new x,{controls:r,interactions:i,keyboardEventTarget:t,overlays:n,values:o}}Ce.default=Se;function _l(o){var i=o||{},r=new x;return(void 0===i.zoom||i.zoom)&&r.push(new Mh(i.zoomOptions)),(void 0===i.rotate||i.rotate)&&r.push(new Kh(i.rotateOptions)),(void 0===i.attribution||i.attribution)&&r.push(new Ih(i.attributionOptions)),r}var Kc={};var Te={};var am=Te&&Te.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=function(e){function t(t){var r=e.call(this)||this;return r.element=t.element?t.element:null,r.target_=null,r.map_=null,r.listenerKeys=[],r.render_=t.render?t.render:Y,t.target&&r.setTarget(t.target),r}return am(t,e),t.prototype.disposeInternal=function(){mc(this.element),e.prototype.disposeInternal.call(this)},t.prototype.getMap=function(){return this.map_},t.prototype.setMap=function(e){this.map_&&mc(this.element);for(var t=0,r=this.listenerKeys.length;t<r;++t)d(this.listenerKeys[t]);(this.listenerKeys.length=0,this.map_=e,this.map_)&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Y&&this.listenerKeys.push(a(e,pb.POSTRENDER,this.render,this)),e.render())},t.prototype.render=function(e){this.render_.call(this,e)},t.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e},t}(e);Te.default=o;var bm=Kc&&Kc.__extends||function(){var e=function(t,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(t,l)};return function(t,l){function r(){this.constructor=t}e(t,l),t.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),Ih=function(e){function t(t){var l=this,r=t||{};(l=e.call(this,{element:document.createElement("div"),render:r.render||Jh,target:r.target})||this).ulElement_=document.createElement("ul"),l.collapsed_=void 0===r.collapsed||r.collapsed,l.overrideCollapsible_=void 0!==r.collapsible,l.collapsible_=void 0===r.collapsible||r.collapsible,l.collapsible_||(l.collapsed_=!1);var o=void 0!==r.className?r.className:"ol-attribution",i=void 0!==r.tipLabel?r.tipLabel:"Attributions",a=void 0!==r.collapseLabel?r.collapseLabel:"\xBB";"string"==typeof a?(l.collapseLabel_=document.createElement("span"),l.collapseLabel_.textContent=a):l.collapseLabel_=a;var s=void 0!==r.label?r.label:"i";"string"==typeof s?(l.label_=document.createElement("span"),l.label_.textContent=s):l.label_=s;var n=l.collapsible_&&!l.collapsed_?l.collapseLabel_:l.label_,p=document.createElement("button");p.setAttribute("type","button"),p.title=i,p.appendChild(n),p.addEventListener(f.CLICK,l.handleClick_.bind(l),!1);var d=o+" "+S+" "+Ra+(l.collapsed_&&l.collapsible_?" "+oc:"")+(l.collapsible_?"":" ol-uncollapsible"),c=l.element;return c.className=d,c.appendChild(l.ulElement_),c.appendChild(p),l.renderedAttributions_=[],l.renderedVisible_=!0,l}return bm(t,e),t.prototype.collectSourceAttributions_=function(e){for(var t={},l=[],r=e.layerStatesArray,o=0,i=r.length;o<i;++o){var a=r[o];if(Ib(a,e.viewState)){var s=a.layer.getSource();if(s){var n=s.getAttributions();if(n){var p=n(e);if(p)if(this.overrideCollapsible_||!1!==s.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(p))for(var d=0,c=p.length;d<c;++d)p[d]in t||(l.push(p[d]),t[p[d]]=!0);else p in t||(l.push(p),t[p]=!0)}}}}return l},t.prototype.updateElement_=function(e){if(e){var t=this.collectSourceAttributions_(e),l=t.length>0;if(this.renderedVisible_!=l&&(this.element.style.display=l?"":"none",this.renderedVisible_=l),!Ya(t,this.renderedAttributions_)){Mg(this.ulElement_);for(var r=0,o=t.length;r<o;++r){var i=document.createElement("li");i.innerHTML=t[r],this.ulElement_.appendChild(i)}this.renderedAttributions_=t}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},t.prototype.handleToggle_=function(){this.element.classList.toggle(oc),this.collapsed_?gb(this.collapseLabel_,this.label_):gb(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t}(o);function Jh(e){this.updateElement_(e.frameState)}Kc.render=Jh,Kc.default=Ih;var Lc={};var cm=Lc&&Lc.__extends||function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),Kh=function(t){function e(e){var a=this,r=e||{};a=t.call(this,{element:document.createElement("div"),render:r.render||Lh,target:r.target})||this;var o=void 0!==r.className?r.className:"ol-rotate",i=void 0!==r.label?r.label:"\u21E7";a.label_=null,"string"==typeof i?(a.label_=document.createElement("span"),a.label_.className="ol-compass",a.label_.textContent=i):(a.label_=i,a.label_.classList.add("ol-compass"));var n=r.tipLabel?r.tipLabel:"Reset rotation",s=document.createElement("button");s.className=o+"-reset",s.setAttribute("type","button"),s.title=n,s.appendChild(a.label_),s.addEventListener(f.CLICK,a.handleClick_.bind(a),!1);var l=o+" "+S+" "+Ra,u=a.element;return u.className=l,u.appendChild(s),a.callResetNorth_=r.resetNorth?r.resetNorth:void 0,a.duration_=void 0!==r.duration?r.duration:250,a.autoHide_=void 0===r.autoHide||r.autoHide,a.rotation_=void 0,a.autoHide_&&a.element.classList.add(nc),a}return cm(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();if(t){var e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Ua}):t.setRotation(0))}},e}(o);function Lh(t){var e=t.frameState;if(e){var a=e.viewState.rotation;if(a!=this.rotation_){var r="rotate("+a+"rad)";if(this.autoHide_){var o=this.element.classList.contains(nc);o||0!==a?o&&0!==a&&this.element.classList.remove(nc):this.element.classList.add(nc)}this.label_.style.transform=r}this.rotation_=a}}Lc.render=Lh,Lc.default=Kh;var Ue={};var dm=Ue&&Ue.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Mh=function(e){function t(t){var o=this,n=t||{};o=e.call(this,{element:document.createElement("div"),target:n.target})||this;var r=void 0!==n.className?n.className:"ol-zoom",a=void 0!==n.delta?n.delta:1,i=void 0!==n.zoomInLabel?n.zoomInLabel:"+",p=void 0!==n.zoomOutLabel?n.zoomOutLabel:"\u2212",l=void 0!==n.zoomInTipLabel?n.zoomInTipLabel:"Zoom in",d=void 0!==n.zoomOutTipLabel?n.zoomOutTipLabel:"Zoom out",s=document.createElement("button");s.className=r+"-in",s.setAttribute("type","button"),s.title=l,s.appendChild("string"==typeof i?document.createTextNode(i):i),s.addEventListener(f.CLICK,o.handleClick_.bind(o,a),!1);var u=document.createElement("button");u.className=r+"-out",u.setAttribute("type","button"),u.title=d,u.appendChild("string"==typeof p?document.createTextNode(p):p),u.addEventListener(f.CLICK,o.handleClick_.bind(o,-a),!1);var $=r+" "+S+" "+Ra,c=o.element;return c.className=$,c.appendChild(s),c.appendChild(u),o.duration_=void 0!==n.duration?n.duration:250,o}return dm(t,e),t.prototype.handleClick_=function(e,t){t.preventDefault(),this.zoomByDelta_(e)},t.prototype.zoomByDelta_=function(e){var t=this.getMap().getView();if(t){var o=t.getZoom();if(void 0!==o){var n=t.getConstrainedZoom(o+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:n,duration:this.duration_,easing:Ua})):t.setZoom(n)}}},t}(o);Ue.default=Mh;var Ve={};var em=Ve&&Ve.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function l(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(l.prototype=r.prototype,new l)}}(),Nh=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],Oh={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},fm=function(e){function t(t){var r=this,l=t||{};(r=e.call(this,{element:document.createElement("div"),target:l.target})||this).cssClassName_=void 0!==l.className?l.className:"ol-full-screen";var s=void 0!==l.label?l.label:"\u2922";r.labelNode_="string"==typeof s?document.createTextNode(s):s;var n=void 0!==l.labelActive?l.labelActive:"\xD7";r.labelActiveNode_="string"==typeof n?document.createTextNode(n):n,r.button_=document.createElement("button");var a=l.tipLabel?l.tipLabel:"Toggle full-screen";r.setClassName_(r.button_,We()),r.button_.setAttribute("type","button"),r.button_.title=a,r.button_.appendChild(r.labelNode_),r.button_.addEventListener(f.CLICK,r.handleClick_.bind(r),!1);var u=r.cssClassName_+" "+S+" "+Ra+" "+(Ph()?"":qk),c=r.element;return c.className=u,c.appendChild(r.button_),r.keys_=void 0!==l.keys&&l.keys,r.source_=l.source,r}return em(t,e),t.prototype.handleClick_=function(e){e.preventDefault(),this.handleFullScreen_()},t.prototype.handleFullScreen_=function(){if(Ph()){var e=this.getMap();if(e)if(We())hm();else{var t=void 0;t=this.source_?"string"==typeof this.source_?document.getElementById(this.source_):this.source_:e.getTargetElement(),this.keys_?gm(t):Qh(t)}}},t.prototype.handleFullScreenChange_=function(){var e=this.getMap();We()?(this.setClassName_(this.button_,!0),gb(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Oh.ENTERFULLSCREEN)):(this.setClassName_(this.button_,!1),gb(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Oh.LEAVEFULLSCREEN)),e&&e.updateSize()},t.prototype.setClassName_=function(e,t){var r=this.cssClassName_+"-true",l=this.cssClassName_+"-false",s=t?r:l;e.classList.remove(r),e.classList.remove(l),e.classList.add(s)},t.prototype.setMap=function(t){if(e.prototype.setMap.call(this,t),t)for(var r=0,l=Nh.length;r<l;++r)this.listenerKeys.push(a(document,Nh[r],this.handleFullScreenChange_,this))},t}(o);function Ph(){var e=document.body;return!!(e.webkitRequestFullscreen||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)}function We(){return!!(document.webkitIsFullScreen||document.msFullscreenElement||document.fullscreenElement)}function Qh(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function gm(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():Qh(e)}function hm(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}Ve.default=fm;var Mc={};var im=Mc&&Mc.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Xe="projection",Rh="coordinateFormat",jm=function(t){function e(e){var r=this,o=e||{},n=document.createElement("div");return n.className=void 0!==o.className?o.className:"ol-mouse-position",(r=t.call(this,{element:n,render:o.render||Sh,target:o.target})||this).addEventListener(l(Xe),r.handleProjectionChanged_),o.coordinateFormat&&r.setCoordinateFormat(o.coordinateFormat),o.projection&&r.setProjection(o.projection),r.undefinedHTML_=void 0!==o.undefinedHTML?o.undefinedHTML:"&#160;",r.renderOnMouseOut_=!!r.undefinedHTML_,r.renderedHTML_=n.innerHTML,r.mapProjection_=null,r.transform_=null,r}return im(e,t),e.prototype.handleProjectionChanged_=function(){this.transform_=null},e.prototype.getCoordinateFormat=function(){return this.get(Rh)},e.prototype.getProjection=function(){return this.get(Xe)},e.prototype.handleMouseMove=function(t){var e=this.getMap();this.updateHTML_(e.getEventPixel(t))},e.prototype.handleMouseOut=function(t){this.updateHTML_(null)},e.prototype.setMap=function(e){if(t.prototype.setMap.call(this,e),e){var r=e.getViewport();this.listenerKeys.push(a(r,oa.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(a(r,oa.POINTEROUT,this.handleMouseOut,this))}},e.prototype.setCoordinateFormat=function(t){this.set(Rh,t)},e.prototype.setProjection=function(t){this.set(Xe,C(t))},e.prototype.updateHTML_=function(t){var e=this.undefinedHTML_;if(t&&this.mapProjection_){if(!this.transform_){var r=this.getProjection();this.transform_=r?bb(this.mapProjection_,r):hg}var o=this.getMap().getCoordinateFromPixelInternal(t);if(o){var n=fb();n&&(this.transform_=bb(this.mapProjection_,n)),this.transform_(o,o);var a=this.getCoordinateFormat();e=a?a(o):o.toString()}}this.renderedHTML_&&e===this.renderedHTML_||(this.element.innerHTML=e,this.renderedHTML_=e)},e}(o);function Sh(t){var e=t.frameState;e?this.mapProjection_!=e.viewState.projection&&(this.mapProjection_=e.viewState.projection,this.transform_=null):this.mapProjection_=null}Mc.render=Sh,Mc.default=jm;var Nc={};var Ye={};var Ze={};var km=Ze&&Ze.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),Th=function(e){function r(r){var t=e.call(this)||this;return t.map_=r,t.declutterTree_=null,t}return km(r,e),r.prototype.dispatchRenderEvent=function(e,r){c()},r.prototype.calculateMatrices2D=function(e){var r=e.viewState,t=e.coordinateToPixelTransform,o=e.pixelToCoordinateTransform;ha(t,e.size[0]/2,e.size[1]/2,1/r.resolution,-1/r.resolution,-r.rotation,-r.center[0],-r.center[1]),Hd(o,t)},r.prototype.forEachFeatureAtCoordinate=function(e,r,t,o,n,a,i,c){var $,p=r.viewState;function f(e,r,t){return n.call(a,r,e?t:null)}var u=p.projection,s=e,l=[[0,0]];if(u.canWrapX()){var C=u.getExtent(),b=D(C),R=e[0];if(R<C[0]||R>C[2])s=[R+b*Math.ceil((C[0]-R)/b),e[1]];o&&l.push([-b,0],[b,0])}var h,d=r.layerStatesArray,m=d.length;this.declutterTree_&&(h=this.declutterTree_.all().map(function(e){return e.value}));for(var v=[],y=0;y<l.length;y++)for(var _=m-1;_>=0;--_){var x=d[_],g=x.layer;if(g.hasRenderer()&&Ib(x,p)&&i.call(c,g)){var j=g.getRenderer(),T=g.getSource();if(j&&T){var E=T.getWrapX()?s:e,I=f.bind(null,x.managed);v[0]=E[0]+l[y][0],v[1]=E[1]+l[y][1],$=j.forEachFeatureAtCoordinate(v,r,t,I,h)}if($)return $}}},r.prototype.forEachLayerAtPixel=function(e,r,t,o,n){return c()},r.prototype.hasFeatureAtCoordinate=function(e,r,t,o,n,a){return void 0!==this.forEachFeatureAtCoordinate(e,r,t,o,H,this,n,a)},r.prototype.getMap=function(){return this.map_},r.prototype.renderFrame=function(e){this.declutterTree_=Bl(e,this.declutterTree_)},r.prototype.scheduleExpireIconCache=function(e){zc.canExpireCache()&&e.postRenderFunctions.push(lm)},r}(nd);function lm(e,r){zc.expire()}Ze.default=Th;var mm=Ye&&Ye.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),$e=function(e){function r(r){var t=e.call(this,r)||this;t.fontChangeListenerKey_=a(ka,qa.PROPERTYCHANGE,r.redrawText.bind(r)),t.element_=document.createElement("div");var n=t.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",t.element_.className=S+" ol-layers";var i=r.getViewport();return i.insertBefore(t.element_,i.firstChild||null),t.children_=[],t.renderedVisible_=!0,t}return mm(r,e),r.prototype.dispatchRenderEvent=function(e,r){var t=this.getMap();if(t.hasListener(e)){var n=new ne(e,void 0,r);t.dispatchEvent(n)}},r.prototype.disposeInternal=function(){d(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),e.prototype.disposeInternal.call(this)},r.prototype.renderFrame=function(r){if(r){this.calculateMatrices2D(r),this.dispatchRenderEvent(Pa.PRECOMPOSE,r);var t=r.layerStatesArray.sort(function(e,r){return e.zIndex-r.zIndex}),n=r.viewState;this.children_.length=0;for(var i=null,a=0,s=t.length;a<s;++a){var o=t[a];if(r.layerIndex=a,Ib(o,n)&&(o.sourceState==Qa.READY||o.sourceState==Qa.UNDEFINED)){var h=o.layer.render(r,i);h&&h!==i&&(this.children_.push(h),i=h)}}e.prototype.renderFrame.call(this,r),ok(this.element_,this.children_),this.dispatchRenderEvent(Pa.POSTCOMPOSE,r),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(r)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},r.prototype.forEachLayerAtPixel=function(e,r,t,n,i){for(var a=r.viewState,s=r.layerStatesArray,o=s.length-1;o>=0;--o){var h=s[o],$=h.layer;if($.hasRenderer()&&Ib(h,a)&&i($)){var l=$.getRenderer().getDataAtPixel(e,r,t);if(l){var p=n($,l);if(p)return p}}}},r}(Th);Ye.default=$e;var _e={};var F={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"};var nm=_e&&_e.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),n={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},Uh=function(t){function e(e){var i=t.call(this)||this;return i.options=e,i.id=e.id,i.insertFirst=void 0===e.insertFirst||e.insertFirst,i.stopEvent=void 0===e.stopEvent||e.stopEvent,i.element=document.createElement("div"),i.element.className=void 0!==e.className?e.className:"ol-overlay-container "+pk,i.element.style.position="absolute",i.autoPan=void 0!==e.autoPan&&e.autoPan,i.autoPanAnimation=e.autoPanAnimation||{},i.autoPanMargin=void 0!==e.autoPanMargin?e.autoPanMargin:20,i.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0},i.mapPostrenderListenerKey=null,i.addEventListener(l(n.ELEMENT),i.handleElementChanged),i.addEventListener(l(n.MAP),i.handleMapChanged),i.addEventListener(l(n.OFFSET),i.handleOffsetChanged),i.addEventListener(l(n.POSITION),i.handlePositionChanged),i.addEventListener(l(n.POSITIONING),i.handlePositioningChanged),void 0!==e.element&&i.setElement(e.element),i.setOffset(void 0!==e.offset?e.offset:[0,0]),i.setPositioning(void 0!==e.positioning?e.positioning:F.TOP_LEFT),void 0!==e.position&&i.setPosition(e.position),i}return nm(e,t),e.prototype.getElement=function(){return this.get(n.ELEMENT)},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(n.MAP)},e.prototype.getOffset=function(){return this.get(n.OFFSET)},e.prototype.getPosition=function(){return this.get(n.POSITION)},e.prototype.getPositioning=function(){return this.get(n.POSITIONING)},e.prototype.handleElementChanged=function(){Mg(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(mc(this.element),d(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=a(t,pb.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(n.POSITION)&&this.autoPan&&this.panIntoView()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(n.ELEMENT,t)},e.prototype.setMap=function(t){this.set(n.MAP,t)},e.prototype.setOffset=function(t){this.set(n.OFFSET,t)},e.prototype.setPosition=function(t){this.set(n.POSITION,t)},e.prototype.panIntoView=function(){var t=this.getMap();if(t&&t.getTargetElement()){var e=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),n=this.getRect(i,[mk(i),nk(i)]),o=this.autoPanMargin;if(!Z(e,n)){var r=n[0]-e[0],s=e[2]-n[2],a=n[1]-e[1],p=e[3]-n[3],$=[0,0];if(r<0?$[0]=r-o:s<0&&($[0]=Math.abs(s)+o),a<0?$[1]=a-o:p<0&&($[1]=Math.abs(p)+o),0!==$[0]||0!==$[1]){var u=t.getView().getCenterInternal(),d=t.getPixelFromCoordinateInternal(u),h=[d[0]+$[0],d[1]+$[1]];t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(h),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},e.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,o=i.top+window.pageYOffset;return[n,o,n+e[0],o+e[1]]},e.prototype.setPositioning=function(t){this.set(n.POSITIONING,t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var i=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(i,n)}else this.setVisible(!1)},e.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,n=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var r=n[0],s=n[1];if(o==F.BOTTOM_RIGHT||o==F.CENTER_RIGHT||o==F.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_="",i.left="");var a=Math.round(e[0]-t[0]-r)+"px";this.rendered.right_!=a&&(this.rendered.right_=a,i.right=a)}else{""!==this.rendered.right_&&(this.rendered.right_="",i.right=""),o!=F.BOTTOM_CENTER&&o!=F.CENTER_CENTER&&o!=F.TOP_CENTER||(r-=this.element.offsetWidth/2);var p=Math.round(t[0]+r)+"px";this.rendered.left_!=p&&(this.rendered.left_=p,i.left=p)}if(o==F.BOTTOM_LEFT||o==F.BOTTOM_CENTER||o==F.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_="",i.top="");var $=Math.round(e[1]-t[1]-s)+"px";this.rendered.bottom_!=$&&(this.rendered.bottom_=$,i.bottom=$)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_="",i.bottom=""),o!=F.CENTER_LEFT&&o!=F.CENTER_CENTER&&o!=F.CENTER_RIGHT||(s-=this.element.offsetHeight/2);var u=Math.round(t[1]+s)+"px";this.rendered.top_!=u&&(this.rendered.top_="top",i.top=u)}},e.prototype.getOptions=function(){return this.options},e}(e);_e.default=Uh;var Vh=Nc&&Nc.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Oc=.75,Vb=.1,om=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vh(t,e),t.prototype.createRenderer=function(){return new $e(this)},t}(Se),pm=function(e){function t(t){var i=this,o=t||{};(i=e.call(this,{element:document.createElement("div"),render:o.render||Wh,target:o.target})||this).boundHandleRotationChanged_=i.handleRotationChanged_.bind(i),i.collapsed_=void 0===o.collapsed||o.collapsed,i.collapsible_=void 0===o.collapsible||o.collapsible,i.collapsible_||(i.collapsed_=!1),i.rotateWithView_=void 0!==o.rotateWithView&&o.rotateWithView,i.viewExtent_=void 0;var r=void 0!==o.className?o.className:"ol-overviewmap",a=void 0!==o.tipLabel?o.tipLabel:"Overview map",n=void 0!==o.collapseLabel?o.collapseLabel:"\xAB";"string"==typeof n?(i.collapseLabel_=document.createElement("span"),i.collapseLabel_.textContent=n):i.collapseLabel_=n;var l=void 0!==o.label?o.label:"\xBB";"string"==typeof l?(i.label_=document.createElement("span"),i.label_.textContent=l):i.label_=l;var p=i.collapsible_&&!i.collapsed_?i.collapseLabel_:i.label_,s=document.createElement("button");s.setAttribute("type","button"),s.title=a,s.appendChild(p),s.addEventListener(f.CLICK,i.handleClick_.bind(i),!1),i.ovmapDiv_=document.createElement("div"),i.ovmapDiv_.className="ol-overviewmap-map",i.view_=o.view,i.ovmap_=new om({view:o.view});var $=i.ovmap_;o.layers&&o.layers.forEach(function(e){$.addLayer(e)});var v=document.createElement("div");v.className="ol-overviewmap-box",v.style.boxSizing="border-box",i.boxOverlay_=new Uh({position:[0,0],positioning:F.CENTER_CENTER,element:v}),i.ovmap_.addOverlay(i.boxOverlay_);var d=r+" "+S+" "+Ra+(i.collapsed_&&i.collapsible_?" "+oc:"")+(i.collapsible_?"":" ol-uncollapsible"),c=i.element;c.className=d,c.appendChild(i.ovmapDiv_),c.appendChild(s);var _=i,h=i.boxOverlay_,x=i.boxOverlay_.getElement(),u=function(e){var t,i={clientX:(t=e).clientX,clientY:t.clientY},o=$.getEventCoordinateInternal(i);h.setPosition(o)},m=function(e){var t=$.getEventCoordinateInternal(e);_.getMap().getView().setCenterInternal(t),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",m)};return x.addEventListener("mousedown",function(){window.addEventListener("mousemove",u),window.addEventListener("mouseup",m)}),i}return Vh(t,e),t.prototype.setMap=function(t){var i=this.getMap();if(t!==i){if(i){var o=i.getView();o&&this.unbindView_(o),this.ovmap_.setTarget(null)}if(e.prototype.setMap.call(this,t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(a(t,qa.PROPERTYCHANGE,this.handleMapPropertyChange_,this));var r=t.getView();r&&(this.bindView_(r),r.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},t.prototype.handleMapPropertyChange_=function(e){if(e.key===s.VIEW){var t=e.oldValue;t&&this.unbindView_(t);var i=this.getMap().getView();this.bindView_(i)}},t.prototype.bindView_=function(e){if(!this.view_){var t=new Ub({projection:e.getProjection()});this.ovmap_.setView(t)}e.addEventListener(l(M.ROTATION),this.boundHandleRotationChanged_),this.handleRotationChanged_()},t.prototype.unbindView_=function(e){e.removeEventListener(l(M.ROTATION),this.boundHandleRotationChanged_)},t.prototype.handleRotationChanged_=function(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},t.prototype.validateExtent_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var i=e.getSize(),o=e.getView().calculateExtentInternal(i);if(!this.viewExtent_||!$a(o,this.viewExtent_)){this.viewExtent_=o;var r=t.getSize(),a=t.getView().calculateExtentInternal(r),n=t.getPixelFromCoordinateInternal(ga(o)),l=t.getPixelFromCoordinateInternal(Fa(o)),p=Math.abs(n[0]-l[0]),s=Math.abs(n[1]-l[1]),$=r[0],v=r[1];p<$*Vb||s<v*Vb||p>$*Oc||s>v*Oc?this.resetExtent_():Z(a,o)||this.recenter_()}}},t.prototype.resetExtent_=function(){if(0!==Oc&&0!==Vb){var e=this.getMap(),t=this.ovmap_,i=e.getSize(),o=e.getView().calculateExtentInternal(i),r=t.getView(),a=Math.log(Oc/Vb)/Math.LN2,n=1/(Math.pow(2,a/2)*Vb);eg(o,n),r.fitInternal(Oa(o))}},t.prototype.recenter_=function(){var e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())},t.prototype.updateBox_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var i=e.getSize(),o=e.getView(),r=t.getView(),a=this.rotateWithView_?0:-o.getRotation(),n=this.boxOverlay_,l=this.boxOverlay_.getElement(),p=o.getCenterInternal(),s=o.getResolution(),$=r.getResolution(),v=i[0]*s/$,d=i[1]*s/$;if(n.setPosition(p),l){l.style.width=v+"px",l.style.height=d+"px";var c="rotate("+a+"rad)";l.style.transform=c}}},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},t.prototype.handleToggle_=function(){this.element.classList.toggle(oc),this.collapsed_?gb(this.collapseLabel_,this.label_):gb(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),vb(e,pb.POSTRENDER,function(e){this.updateBox_()},this)}},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.setRotateWithView=function(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))},t.prototype.getOverviewMap=function(){return this.ovmap_},t}(o);function Wh(e){this.validateExtent_(),this.updateBox_()}Nc.render=Wh,Nc.default=pm;var Wb={};var qm=Wb&&Wb.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),af="units",Aa={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"};Wb.Units=Aa;var rm=[1,2,5],sm=function(e){function t(t){var r=this,s=t||{},i=void 0!==s.className?s.className:s.bar?"ol-scale-bar":"ol-scale-line";return(r=e.call(this,{element:document.createElement("div"),render:s.render||Xh,target:s.target})||this).innerElement_=document.createElement("div"),r.innerElement_.className=i+"-inner",r.element.className=i+" "+S,r.element.appendChild(r.innerElement_),r.viewState_=null,r.minWidth_=void 0!==s.minWidth?s.minWidth:64,r.renderedVisible_=!1,r.renderedWidth_=void 0,r.renderedHTML_="",r.addEventListener(l(af),r.handleUnitsChanged_),r.setUnits(s.units||Aa.METRIC),r.scaleBar_=s.bar||!1,r.scaleBarSteps_=s.steps||4,r.scaleBarText_=s.text||!1,r}return qm(t,e),t.prototype.getUnits=function(){return this.get(af)},t.prototype.handleUnitsChanged_=function(){this.updateElement_()},t.prototype.setUnits=function(e){this.set(af,e)},t.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,r=e.projection,s=this.getUnits(),i=s==Aa.DEGREES?E.DEGREES:E.METERS,n=zd(r,e.resolution,t,i),a=this.minWidth_*n,o="";if(s==Aa.DEGREES){var l=Q[E.DEGREES];(a*=l)<l/60?(o="\u2033",n*=3600):a<l?(o="\u2032",n*=60):o="\xB0"}else s==Aa.IMPERIAL?a<.9144?(o="in",n/=.0254):a<1609.344?(o="ft",n/=.3048):(o="mi",n/=1609.344):s==Aa.NAUTICAL?(n/=1852,o="nm"):s==Aa.METRIC?a<.001?(o="\u03BCm",n*=1e6):a<1?(o="mm",n*=1e3):a<1e3?o="m":(o="km",n/=1e3):s==Aa.US?a<.9144?(o="in",n*=39.37):a<1609.344?(o="ft",n/=.30480061):(o="mi",n/=1609.3472):g(!1,33);for(var $,p,d,c,h=3*Math.floor(Math.log(this.minWidth_*n)/Math.log(10));;){d=Math.floor(h/3);var _=Math.pow(10,d);if($=rm[(h%3+3)%3]*_,p=Math.round($/n),isNaN(p))return this.element.style.display="none",void(this.renderedVisible_=!1);if(p>=this.minWidth_)break;++h}c=this.scaleBar_?this.createScaleBar(p,$,o):$.toFixed(d<0?-d:0)+" "+o,this.renderedHTML_!=c&&(this.innerElement_.innerHTML=c,this.renderedHTML_=c),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+"px",this.renderedWidth_=p),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.createScaleBar=function(e,t,r){for(var s="1 : "+Math.round(this.getScaleForResolution()).toLocaleString(),i=[],n=e/this.scaleBarSteps_,a="#ffffff",o=0;o<this.scaleBarSteps_;o++)0===o&&i.push(this.createMarker("absolute",o)),i.push("<div><div class=\"ol-scale-singlebar\" style=\"width: "+n+"px;background-color: "+a+";\"></div>"+this.createMarker("relative",o)+(o%2==0||2===this.scaleBarSteps_?this.createStepText(o,e,!1,t,r):"")+"</div>"),o===this.scaleBarSteps_-1&&i.push(this.createStepText(o+1,e,!0,t,r)),a="#ffffff"===a?"#000000":"#ffffff";return"<div style=\"display: flex;\">"+(this.scaleBarText_?"<div class=\"ol-scale-text\" style=\"width: "+e+"px;\">"+s+"</div>":"")+i.join("")+"</div>"},t.prototype.createMarker=function(e,t){return"<div class=\"ol-scale-step-marker\" style=\"position: "+e+";top: "+("absolute"===e?3:-10)+"px;\"></div>"},t.prototype.createStepText=function(e,t,r,s,i){var n=(0===e?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(0===e?"":" "+i);return"<div class=\"ol-scale-step-text\" style=\"margin-left: "+(0===e?-3:t/this.scaleBarSteps_*-1)+"px;text-align: "+(0===e?"left":"center")+"; min-width: "+(0===e?0:t/this.scaleBarSteps_*2)+"px;left: "+(r?t+"px":"unset")+";\">"+n+"</div>"},t.prototype.getScaleForResolution=function(){var e=this.getMap().getView().getResolution(),t=this.viewState_.projection.getMetersPerUnit();return parseFloat(e.toString())*t*39.37*(25.4/.28)},t}(o);function Xh(e){var t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}Wb.render=Xh,Wb.default=sm;var Pc={};var tm=Pc&&Pc.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Xb={VERTICAL:0,HORIZONTAL:1},um=function(t){function e(e){var i=this,r=e||{};(i=t.call(this,{element:document.createElement("div"),render:r.render||Yh})||this).dragListenerKeys_=[],i.currentResolution_=void 0,i.direction_=Xb.VERTICAL,i.dragging_,i.heightLimit_=0,i.widthLimit_=0,i.startX_,i.startY_,i.thumbSize_=null,i.sliderInitialized_=!1,i.duration_=void 0!==r.duration?r.duration:200;var n=void 0!==r.className?r.className:"ol-zoomslider",o=document.createElement("button");o.setAttribute("type","button"),o.className=n+"-thumb "+S;var a=i.element;return a.className=n+" "+S+" "+Ra,a.appendChild(o),a.addEventListener(oa.POINTERDOWN,i.handleDraggerStart_.bind(i),!1),a.addEventListener(oa.POINTERMOVE,i.handleDraggerDrag_.bind(i),!1),a.addEventListener(oa.POINTERUP,i.handleDraggerEnd_.bind(i),!1),a.addEventListener(f.CLICK,i.handleContainerClick_.bind(i),!1),o.addEventListener(f.CLICK,bj,!1),i}return tm(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),e&&e.render()},e.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,i=t.offsetHeight,r=t.firstElementChild,n=getComputedStyle(r),o=r.offsetWidth+parseFloat(n.marginRight)+parseFloat(n.marginLeft),a=r.offsetHeight+parseFloat(n.marginTop)+parseFloat(n.marginBottom);this.thumbSize_=[o,a],e>i?(this.direction_=Xb.HORIZONTAL,this.widthLimit_=e-o):(this.direction_=Xb.VERTICAL,this.heightLimit_=i-a),this.sliderInitialized_=!0},e.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),i=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(i),n=e.getConstrainedZoom(e.getZoomForResolution(r));e.animateInternal({zoom:n,duration:this.duration_,easing:Ua})},e.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.target===this.element.firstElementChild){var e=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=t.clientX-parseFloat(e.style.left),this.startY_=t.clientY-parseFloat(e.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length){var i=this.handleDraggerDrag_,r=this.handleDraggerEnd_;this.dragListenerKeys_.push(a(document,oa.POINTERMOVE,i,this),a(document,oa.POINTERUP,r,this))}}},e.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=t.clientX-this.startX_,i=t.clientY-this.startY_,r=this.getRelativePosition_(e,i);this.currentResolution_=this.getResolutionForPosition_(r),this.getMap().getView().setResolution(this.currentResolution_)}},e.prototype.handleDraggerEnd_=function(t){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(d),this.dragListenerKeys_.length=0)},e.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),i=this.element.firstElementChild;this.direction_==Xb.HORIZONTAL?i.style.left=this.widthLimit_*e+"px":i.style.top=this.heightLimit_*e+"px"},e.prototype.getRelativePosition_=function(t,e){var i;return i=this.direction_===Xb.HORIZONTAL?t/this.widthLimit_:e/this.heightLimit_,z(i,0,1)},e.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)},e.prototype.getPositionForResolution_=function(t){var e=this.getMap().getView().getValueForResolutionFunction();return z(1-e(t),0,1)},e}(o);function Yh(t){if(t.frameState){this.sliderInitialized_||this.initSlider_();var e=t.frameState.viewState.resolution;this.currentResolution_=e,this.setThumbPosition_(e)}}Pc.render=Yh,Pc.default=um;var bf={};var vm=bf&&bf.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),wm=function(t){function e(e){var n=this,o=e||{};(n=t.call(this,{element:document.createElement("div"),target:o.target})||this).extent=o.extent?o.extent:null;var r=void 0!==o.className?o.className:"ol-zoom-extent",i=void 0!==o.label?o.label:"E",a=void 0!==o.tipLabel?o.tipLabel:"Fit to extent",b=document.createElement("button");b.setAttribute("type","button"),b.title=a,b.appendChild("string"==typeof i?document.createTextNode(i):i),b.addEventListener(f.CLICK,n.handleClick_.bind(n),!1);var $=r+" "+S+" "+Ra,l=n.element;return l.className=$,l.appendChild(b),n}return vm(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),this.handleZoomToExtent()},e.prototype.handleZoomToExtent=function(){var t=this.getMap().getView(),e=this.extent?this.extent:t.getProjection().getExtent();t.fitInternal(Oa(e))},e}(o);bf.default=wm;function xm(t){var o=t||{},r=new x,e=new Hl(-.005,.05,100);return(void 0===o.altShiftDragRotate||o.altShiftDragRotate)&&r.push(new fi),(void 0===o.doubleClickZoom||o.doubleClickZoom)&&r.push(new $h({delta:o.zoomDelta,duration:o.zoomDuration})),(void 0===o.dragPan||o.dragPan)&&r.push(new ei({condition:o.onFocusOnly?Sc:void 0,kinetic:e})),(void 0===o.pinchRotate||o.pinchRotate)&&r.push(new ni),(void 0===o.pinchZoom||o.pinchZoom)&&r.push(new oi({duration:o.zoomDuration})),(void 0===o.keyboard||o.keyboard)&&(r.push(new ki),r.push(new li({delta:o.zoomDelta,duration:o.zoomDuration}))),(void 0===o.mouseWheelZoom||o.mouseWheelZoom)&&r.push(new mi({condition:o.onFocusOnly?Sc:void 0,duration:o.zoomDuration})),(void 0===o.shiftDragZoom||o.shiftDragZoom)&&r.push(new ji({duration:o.zoomDuration})),r}var cf={};var Yb={};var Qc={ACTIVE:"active"};var ym=Yb&&Yb.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ba=function(t){function e(e){var r=t.call(this)||this;return e.handleEvent&&(r.handleEvent=e.handleEvent),r.map_=null,r.setActive(!0),r}return ym(e,t),e.prototype.getActive=function(){return this.get(Qc.ACTIVE)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(Qc.ACTIVE,t)},e.prototype.setMap=function(t){this.map_=t},e}(e);function Zh(t,e,r){var n=t.getCenterInternal();if(n){var o=[n[0]+e[0],n[1]+e[1]];t.animateInternal({duration:void 0!==r?r:250,easing:Dl,center:t.getConstrainedCenter(o)})}}function Rc(t,e,r,n){var o=t.getZoom();if(void 0!==o){var a=t.getConstrainedZoom(o+e),c=t.getResolutionForZoom(a);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:c,anchor:r,duration:void 0!==n?n:250,easing:Ua})}}Yb.pan=Zh,Yb.zoomByDelta=Rc,Yb.default=Ba;var zm=cf&&cf.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),$h=function(t){function n(n){var e=t.call(this,{handleEvent:Am})||this,o=n||{};return e.delta_=o.delta?o.delta:1,e.duration_=void 0!==o.duration?o.duration:250,e}return zm(n,t),n}(Ba);function Am(t){var n=!1;if(t.type==b.DBLCLICK){var e=t.originalEvent,o=t.map,r=t.coordinate,a=e.shiftKey?-this.delta_:this.delta_,$=o.getView();Rc($,a,r,this.duration_),t.preventDefault(),n=!0}return!n}cf.default=$h;var df={};var Bm=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var Cm=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey};var Sc=function(e){return e.target.getTargetElement()===document.activeElement};var ef=H;var _h=function(e){var t=e.originalEvent;return 0==t.button&&!(kl&&ll&&t.ctrlKey)};var ai=Ca;var bi=function(e){return e.type==b.SINGLECLICK};var ff=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var Tc=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey};var ci=function(e){var t=e.originalEvent.target.tagName;return"INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t};var qb=function(e){var t=e.pointerEvent;return g(void 0!==t,56),"mouse"==t.pointerType};var di=function(e){var t=e.pointerEvent;return g(void 0!==t,56),t.isPrimary&&0===t.button};var Uc={};var Dm=Uc&&Uc.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){var n=this,r=t||{};return n=e.call(this,r)||this,r.handleDownEvent&&(n.handleDownEvent=r.handleDownEvent),r.handleDragEvent&&(n.handleDragEvent=r.handleDragEvent),r.handleMoveEvent&&(n.handleMoveEvent=r.handleMoveEvent),r.handleUpEvent&&(n.handleUpEvent=r.handleUpEvent),r.stopDown&&(n.stopDown=r.stopDown),n.handlingDownUpSequence=!1,n.trackedPointers_={},n.targetPointers=[],n}return Dm(t,e),t.prototype.getPointerCount=function(){return this.targetPointers.length},t.prototype.handleDownEvent=function(e){return!1},t.prototype.handleDragEvent=function(e){},t.prototype.handleEvent=function(e){if(!e.pointerEvent)return!0;var t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==b.POINTERDRAG)this.handleDragEvent(e);else if(e.type==b.POINTERUP){var n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==b.POINTERDOWN){var r=this.handleDownEvent(e);this.handlingDownUpSequence=r,t=this.stopDown(r)}else e.type==b.POINTERMOVE&&this.handleMoveEvent(e);return!t},t.prototype.handleMoveEvent=function(e){},t.prototype.handleUpEvent=function(e){return!1},t.prototype.stopDown=function(e){return e},t.prototype.updateTrackedPointers_=function(e){if(Em(e)){var t=e.pointerEvent,n=t.pointerId.toString();e.type==b.POINTERUP?delete this.trackedPointers_[n]:e.type==b.POINTERDOWN?this.trackedPointers_[n]=t:n in this.trackedPointers_&&(this.trackedPointers_[n]=t),this.targetPointers=ld(this.trackedPointers_)}},t}(Ba);function Vc(e){for(var t=e.length,n=0,r=0,o=0;o<t;o++)n+=e[o].clientX,r+=e[o].clientY;return[n/t,r/t]}function Em(e){var t=e.type;return t===b.POINTERDOWN||t===b.POINTERDRAG||t===b.POINTERUP}Uc.centroid=Vc,Uc.default=i;var Fm=df&&df.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),ei=function(t){function n(n){var e=t.call(this,{stopDown:Ca})||this,i=n||{};return e.kinetic_=i.kinetic,e.lastCentroid=null,e.lastPointersCount_,e.panning_=!1,e.condition_=i.condition?i.condition:Gm,e.noKinetic_=!1,e}return Fm(n,t),n.prototype.conditionInternal_=function(t){var n=!0;return t.map.getTargetElement().hasAttribute("tabindex")&&(n=Sc(t)),n&&this.condition_(t)},n.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var n=this.targetPointers,e=Vc(n);if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(e[0],e[1]),this.lastCentroid){var i=[this.lastCentroid[0]-e[0],e[1]-this.lastCentroid[1]],r=t.map.getView();ul(i,r.getResolution()),te(i,r.getRotation()),r.adjustCenterInternal(i)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=e,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()},n.prototype.handleUpEvent=function(t){var n=t.map,e=n.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var i=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=e.getCenterInternal(),a=n.getPixelFromCoordinateInternal(o),s=n.getCoordinateFromPixelInternal([a[0]-i*Math.cos(r),a[1]-i*Math.sin(r)]);e.animateInternal({center:e.getConstrainedCenter(s),duration:500,easing:Ua})}return this.panning_&&(this.panning_=!1,e.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},n.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.conditionInternal_(t)){var n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},n}(i);function Gm(t){return ff(t)&&di(t)}df.default=ei;var gf={};var Hm=gf&&gf.__extends||function(){var t=function(n,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(n,o)};return function(n,o){function e(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}(),fi=function(t){function n(n){var o=this,e=n||{};return(o=t.call(this,{stopDown:Ca})||this).condition_=e.condition?e.condition:Cm,o.lastAngle_=void 0,o.duration_=void 0!==e.duration?e.duration:250,o}return Hm(n,t),n.prototype.handleDragEvent=function(t){if(qb(t)){var n=t.map,o=n.getView();if(o.getConstraints().rotation!==Oe){var e=n.getSize(),r=t.pixel,i=Math.atan2(e[1]/2-r[1],r[0]-e[0]/2);if(void 0!==this.lastAngle_){var a=i-this.lastAngle_;o.adjustRotationInternal(-a)}this.lastAngle_=i}}},n.prototype.handleUpEvent=function(t){return!qb(t)||(t.map.getView().endInteraction(this.duration_),!1)},n.prototype.handleDownEvent=function(t){return!!qb(t)&&!(!_h(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)},n}(i);gf.default=fi;var hf={};var jf={};var kf={};var Im=kf&&kf.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),gi=function(t){function e(e){var r=t.call(this)||this;return r.geometry_=null,r.element_=document.createElement("div"),r.element_.style.position="absolute",r.element_.className="ol-box "+e,r.map_=null,r.startPixel_=null,r.endPixel_=null,r}return Im(e,t),e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,r=this.element_.style;r.left=Math.min(t[0],e[0])+"px",r.top=Math.min(t[1],e[1])+"px",r.width=Math.abs(e[0]-t[0])+"px",r.height=Math.abs(e[1]-t[1])+"px"},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new ia([r])},e.prototype.getGeometry=function(){return this.geometry_},e}(nd);kf.default=gi;var hi=jf&&jf.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),lf={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},mf=function(t){function n(n,e,o){var r=t.call(this,n)||this;return r.coordinate=e,r.mapBrowserEvent=o,r}return hi(n,t),n}(A),ii=function(t){function n(n){var e=t.call(this)||this,o=n||{};return e.box_=new gi(o.className||"ol-dragbox"),e.minArea_=void 0!==o.minArea?o.minArea:64,e.onBoxEnd_=o.onBoxEnd?o.onBoxEnd:Y,e.startPixel_=null,e.condition_=o.condition?o.condition:_h,e.boxEndCondition_=o.boxEndCondition?o.boxEndCondition:e.defaultBoxEndCondition,e}return hi(n,t),n.prototype.defaultBoxEndCondition=function(t,n,e){var o=e[0]-n[0],r=e[1]-n[1];return o*o+r*r>=this.minArea_},n.prototype.getGeometry=function(){return this.box_.getGeometry()},n.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new mf(lf.BOXDRAG,t.coordinate,t))},n.prototype.handleUpEvent=function(t){return this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd_(t),this.dispatchEvent(new mf(lf.BOXEND,t.coordinate,t))),!1},n.prototype.handleDownEvent=function(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new mf(lf.BOXSTART,t.coordinate,t)),!0)},n}(i);jf.default=ii;var Jm=hf&&hf.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),ji=function(t){function e(e){var o=this,r=e||{},n=r.condition?r.condition:Tc;return(o=t.call(this,{condition:n,className:r.className||"ol-dragzoom",minArea:r.minArea,onBoxEnd:Km})||this).duration_=void 0!==r.duration?r.duration:200,o.out_=void 0!==r.out&&r.out,o}return Jm(e,t),e}(ii);function Km(){var t=this.getMap(),e=t.getView(),o=t.getSize(),r=this.getGeometry().getExtent();if(this.out_){var n=e.calculateExtentInternal(o),i=hj([t.getPixelFromCoordinateInternal(sa(r)),t.getPixelFromCoordinateInternal(Ga(r))]),a=e.getResolutionForExtentInternal(i,o);eg(n,1/a),r=n}var u=e.getConstrainedResolution(e.getResolutionForExtentInternal(r,o)),$=e.getConstrainedCenter(zb(r),u);e.animateInternal({resolution:u,center:$,duration:this.duration_,easing:Ua})}hf.default=ji;var nf={};var Wa={LEFT:37,UP:38,RIGHT:39,DOWN:40};var Lm=nf&&nf.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),ki=function(t){function e(e){var o=t.call(this,{handleEvent:Mm})||this,r=e||{};return o.defaultCondition_=function(t){return ff(t)&&ci(t)},o.condition_=void 0!==r.condition?r.condition:o.defaultCondition_,o.duration_=void 0!==r.duration?r.duration:100,o.pixelDelta_=void 0!==r.pixelDelta?r.pixelDelta:128,o}return Lm(e,t),e}(Ba);function Mm(t){var e=!1;if(t.type==f.KEYDOWN){var o=t.originalEvent.keyCode;if(this.condition_(t)&&(o==Wa.DOWN||o==Wa.LEFT||o==Wa.RIGHT||o==Wa.UP)){var r=t.map.getView(),n=r.getResolution()*this.pixelDelta_,i=0,$=0;o==Wa.DOWN?$=-n:o==Wa.LEFT?i=-n:o==Wa.RIGHT?i=n:$=n;var s=[i,$];te(s,r.getRotation()),Zh(r,s,this.duration_),t.preventDefault(),e=!0}}return!e}nf.default=ki;var of={};var Nm=of&&of.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),li=function(t){function e(e){var r=t.call(this,{handleEvent:Om})||this,n=e||{};return r.condition_=n.condition?n.condition:ci,r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:100,r}return Nm(e,t),e}(Ba);function Om(t){var e=!1;if(t.type==f.KEYDOWN||t.type==f.KEYPRESS){var r=t.originalEvent.charCode;if(this.condition_(t)&&(r=="+".charCodeAt(0)||r=="-".charCodeAt(0))){var n=t.map,o=r=="+".charCodeAt(0)?this.delta_:-this.delta_,i=n.getView();Rc(i,o,void 0,this.duration_),t.preventDefault(),e=!0}}return!e}of.default=li;var Wc={};var Pm=Wc&&Wc.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Xc={TRACKPAD:"trackpad",WHEEL:"wheel"};Wc.Mode=Xc;var mi=function(t){function e(e){var o=this,i=e||{};return(o=t.call(this,i)||this).totalDelta_=0,o.lastDelta_=0,o.maxDelta_=void 0!==i.maxDelta?i.maxDelta:1,o.duration_=void 0!==i.duration?i.duration:250,o.timeout_=void 0!==i.timeout?i.timeout:80,o.useAnchor_=void 0===i.useAnchor||i.useAnchor,o.condition_=i.condition?i.condition:ef,o.lastAnchor_=null,o.startTime_=void 0,o.timeoutId_,o.mode_=void 0,o.trackpadEventGap_=400,o.trackpadTimeoutId_,o.deltaPerZoom_=300,o}return Pm(e,t),e.prototype.conditionInternal_=function(t){var e=!0;return t.map.getTargetElement().hasAttribute("tabindex")&&(e=Sc(t)),e&&this.condition_(t)},e.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},e.prototype.handleEvent=function(t){if(!this.conditionInternal_(t))return!0;if(t.type!==f.WHEEL)return!0;t.preventDefault();var e,o=t.map,i=t.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==f.WHEEL&&(e=i.deltaY,jl&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e/=Bc),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=40)),0===e)return!1;this.lastDelta_=e;var r=Date.now();void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(e)<4?Xc.TRACKPAD:Xc.WHEEL);var a=o.getView();if(this.mode_===Xc.TRACKPAD&&!a.getConstrainResolution())return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-e/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=e;var n=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,o),n),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var o=-z(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;e.getConstrainResolution()&&(o=o?o>0?1:-1:0),Rc(e,o,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(Ba);Wc.default=mi;var pf={};var Qm=pf&&pf.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ni=function(t){function n(n){var e=this,r=n||{},o=r;return o.stopDown||(o.stopDown=Ca),(e=t.call(this,o)||this).anchor_=null,e.lastAngle_=void 0,e.rotating_=!1,e.rotationDelta_=0,e.threshold_=void 0!==r.threshold?r.threshold:.3,e.duration_=void 0!==r.duration?r.duration:250,e}return Qm(n,t),n.prototype.handleDragEvent=function(t){var n=0,e=this.targetPointers[0],r=this.targetPointers[1],o=Math.atan2(r.clientY-e.clientY,r.clientX-e.clientX);if(void 0!==this.lastAngle_){var i=o-this.lastAngle_;this.rotationDelta_+=i,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),n=i}this.lastAngle_=o;var a=t.map,s=a.getView();if(s.getConstraints().rotation!==Oe){var l=a.getViewport().getBoundingClientRect(),h=Vc(this.targetPointers);h[0]-=l.left,h[1]-=l.top,this.anchor_=a.getCoordinateFromPixelInternal(h),this.rotating_&&(a.render(),s.adjustRotationInternal(n,this.anchor_))}},n.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)},n.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var n=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}return!1},n}(i);pf.default=ni;var qf={};var Rm=qf&&qf.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),oi=function(t){function e(e){var n=this,r=e||{},o=r;return o.stopDown||(o.stopDown=Ca),(n=t.call(this,o)||this).anchor_=null,n.duration_=void 0!==r.duration?r.duration:400,n.lastDistance_=void 0,n.lastScaleDelta_=1,n}return Rm(e,t),e.prototype.handleDragEvent=function(t){var e=1,n=this.targetPointers[0],r=this.targetPointers[1],o=n.clientX-r.clientX,i=n.clientY-r.clientY,a=Math.sqrt(o*o+i*i);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;var s=t.map,l=s.getView();1!=e&&(this.lastScaleDelta_=e);var c=s.getViewport().getBoundingClientRect(),u=Vc(this.targetPointers);u[0]-=c.left,u[1]-=c.top,this.anchor_=s.getCoordinateFromPixelInternal(u),s.render(),l.adjustResolutionInternal(e,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(i);qf.default=oi;var rf={};var pi=rf&&rf.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function c(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(c.prototype=r.prototype,new c)}}(),Sm={ADD_FEATURES:"addfeatures"},Tm=function(t){function e(e,r,c,n){var o=t.call(this,e)||this;return o.features=c,o.file=r,o.projection=n,o}return pi(e,t),e}(A),Um=function(t){function e(e){var r=this,c=e||{};return(r=t.call(this,{handleEvent:H})||this).formatConstructors_=c.formatConstructors?c.formatConstructors:[],r.projection_=c.projection?C(c.projection):null,r.dropListenKeys_=null,r.source_=c.source||null,r.target=c.target?c.target:null,r}return pi(e,t),e.prototype.handleResult_=function(t,e){var r=e.target.result,c=this.getMap(),n=this.projection_;n||(n=c.getView().getProjection());for(var o=this.formatConstructors_,i=[],s=0,$=o.length;s<$;++s){var a=new o[s];if((i=this.tryReadFeatures_(a,r,{featureProjection:n}))&&i.length>0)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(i)),this.dispatchEvent(new Tm(Sm.ADD_FEATURES,t,i,n))},e.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[a(e,f.DROP,Vm,this),a(e,f.DRAGENTER,sf,this),a(e,f.DRAGOVER,sf,this),a(e,f.DROP,sf,this)]}},e.prototype.setActive=function(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.unregisterListeners_(),t.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},e.prototype.tryReadFeatures_=function(t,e,r){try{return t.readFeatures(e,r)}catch(c){return null}},e.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(d),this.dropListenKeys_=null)},e}(Ba);function Vm(t){for(var e=t.dataTransfer.files,r=0,c=e.length;r<c;++r){var n=e.item(r),o=new FileReader;o.addEventListener(f.LOAD,this.handleResult_.bind(this,n)),o.readAsText(n)}}function sf(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}rf.default=Um;var tf={};var Wm=tf&&tf.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xm=function(t){function e(e){var n=this,i=e||{};return(n=t.call(this,i)||this).condition_=i.condition?i.condition:Tc,n.lastAngle_=void 0,n.lastMagnitude_=void 0,n.lastScaleDelta_=0,n.duration_=void 0!==i.duration?i.duration:400,n}return Wm(e,t),e.prototype.handleDragEvent=function(t){if(qb(t)){var e=t.map,n=e.getSize(),i=t.pixel,o=i[0]-n[0]/2,a=n[1]/2-i[1],r=Math.atan2(a,o),s=Math.sqrt(o*o+a*a),l=e.getView();if(void 0!==this.lastAngle_){var u=this.lastAngle_-r;l.adjustRotationInternal(u)}this.lastAngle_=r,void 0!==this.lastMagnitude_&&l.adjustResolutionInternal(this.lastMagnitude_/s),void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/s),this.lastMagnitude_=s}},e.prototype.handleUpEvent=function(t){if(!qb(t))return!0;var e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),this.lastScaleDelta_=0,!1},e.prototype.handleDownEvent=function(t){return!!qb(t)&&!!this.condition_(t)&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0)},e}(i);tf.default=Xm;var Zb={};var uf={};var Ym=uf&&uf.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Yc=function(t){function e(e,r,o){var i=t.call(this)||this;if(void 0!==o&&void 0===r)i.setFlatCoordinates(o,e);else{var s=r||0;i.setCenterAndRadius(e,s,o)}return i}return Ym(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),void 0,this.layout)},e.prototype.closestPointXY=function(t,e,r,o){var i=this.flatCoordinates,s=t-i[0],n=e-i[1],a=s*s+n*n;if(a<o){if(0===a)for(var p=0;p<this.stride;++p)r[p]=i[p];else{var d=this.getRadius()/Math.sqrt(a);r[0]=i[0]+d*s,r[1]=i[1]+d*n;for(p=2;p<this.stride;++p)r[p]=i[p]}return r.length=this.stride,a}return o},e.prototype.containsXY=function(t,e){var r=this.flatCoordinates,o=t-r[0],i=e-r[1];return o*o+i*i<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,r=e[this.stride]-e[0];return N(e[0]-r,e[1]-r,e[0]+r,e[1]+r,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return k.CIRCLE},e.prototype.intersectsExtent=function(t){var e=this.getExtent();if(fa(t,e)){var r=this.getCenter();return t[0]<=r[0]&&t[2]>=r[0]||t[1]<=r[1]&&t[3]>=r[1]||cg(t,this.intersectsCoordinate.bind(this))}return!1},e.prototype.setCenter=function(t){var e=this.stride,r=this.flatCoordinates[e]-this.flatCoordinates[0],o=t.slice();o[e]=o[0]+r;for(var i=1;i<e;++i)o[e+i]=t[i];this.setFlatCoordinates(this.layout,o),this.changed()},e.prototype.setCenterAndRadius=function(t,e,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var o=this.flatCoordinates,i=Ag(o,0,t,this.stride);o[i++]=o[0]+e;for(var s=1,n=this.stride;s<n;++s)o[i++]=o[s];o.length=i,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e.prototype.rotate=function(t,e){var r=this.getCenter(),o=this.getStride();this.setCenter(fg(r,0,r.length,o,t,e,r)),this.changed()},e.prototype.translate=function(t,e){var r=this.getCenter(),o=this.getStride();this.setCenter(gg(r,0,r.length,o,t,e,r)),this.changed()},e}($);Yc.prototype.transform,uf.default=Yc;var vf={};var Zm=vf&&vf.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),qi=function(t){function e(e,r,i){var o=t.call(this)||this;if(o.ends_=[],o.maxDelta_=-1,o.maxDeltaRevision_=-1,Array.isArray(e[0]))o.setCoordinates(e,r);else if(void 0!==r&&i)o.setFlatCoordinates(r,e),o.ends_=i;else{for(var s=o.getLayout(),n=e,a=[],l=[],$=0,p=n.length;$<p;++$){var d=n[$];0===$&&(s=d.getLayout()),K(a,d.getFlatCoordinates()),l.push(a.length)}o.setFlatCoordinates(s,a),o.ends_=l}return o}return Zm(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?K(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,i){return i<Za(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Md(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,i))},e.prototype.getCoordinateAtM=function(t,e,r){if(this.layout!=p.XYM&&this.layout!=p.XYZM||0===this.flatCoordinates.length)return null;var i=void 0!==e&&e,o=void 0!==r&&r;return vl(this.flatCoordinates,0,this.ends_,this.stride,t,i,o)},e.prototype.getCoordinates=function(){return jc(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new nb(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,r=this.layout,i=[],o=0,s=0,n=e.length;s<n;++s){var a=e[s],l=new nb(t.slice(o,a),r);i.push(l),o=a}return i},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,r=0,i=this.ends_,o=this.stride,s=0,n=i.length;s<n;++s){var a=i[s],l=qh(e,r,a,o,.5);K(t,l),r=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],i=[];return r.length=Rj(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,i),new e(r,p.XY,i)},e.prototype.getType=function(){return k.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return Zj(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Nd(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}($);vf.default=qi;var wf={};var $m=wf&&wf.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),xf=function(t){function e(e,r){var o=t.call(this)||this;return r&&!Array.isArray(e[0])?o.setFlatCoordinates(r,e):o.setCoordinates(e,r),o}return $m(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?K(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,o){if(o<Za(this.getExtent(),t,e))return o;for(var i=this.flatCoordinates,n=this.stride,s=0,a=i.length;s<a;s+=n){var l=Ia(t,e,i[s],i[s+1]);if(l<o){o=l;for(var d=0;d<n;++d)r[d]=i[s+d];r.length=n}}return o},e.prototype.getCoordinates=function(){return Hb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new va(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,o=[],i=0,n=t.length;i<n;i+=r){var s=new va(t.slice(i,i+r),e);o.push(s)}return o},e.prototype.getType=function(){return k.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,r=this.stride,o=0,i=e.length;o<i;o+=r){var n=e[o],s=e[o+1];if(sd(t,n,s))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ic(this.flatCoordinates,0,t,this.stride),this.changed()},e}($);wf.default=xf;var yf={};function _m(r,e,t,$){for(var j=[],n=ea(),a=0,i=t.length;a<i;++a){var m=t[a];n=_f(r,e,m[0],$),j.push((n[0]+n[2])/2,(n[1]+n[3])/2),e=m[m.length-1]}return j}var an=yf&&yf.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ri=function(t){function e(e,i,r){var o=t.call(this)||this;if(o.endss_=[],o.flatInteriorPointsRevision_=-1,o.flatInteriorPoints_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,!r&&!Array.isArray(e[0])){for(var s=o.getLayout(),n=e,a=[],l=[],$=0,h=n.length;$<h;++$){var d=n[$];0===$&&(s=d.getLayout());for(var p=a.length,u=d.getEnds(),f=0,c=u.length;f<c;++f)u[f]+=p;K(a,d.getFlatCoordinates()),l.push(u)}i=s,e=a,r=l}return void 0!==i&&r?(o.setFlatCoordinates(i,e),o.endss_=r):o.setCoordinates(e,i),o}return an(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;K(this.flatCoordinates,t.getFlatCoordinates());for(var r=0,o=(e=t.getEnds().slice()).length;r<o;++r)e[r]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,i=new Array(t),r=0;r<t;++r)i[r]=this.endss_[r].slice();return new e(this.flatCoordinates.slice(),this.layout,i)},e.prototype.closestPointXY=function(t,e,i,r){return r<Za(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Oj(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pj(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))},e.prototype.containsXY=function(t,e){return Xj(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return Nj(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Ig(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Bg(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=_m(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Yj(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new xf(this.getFlatInteriorPoints().slice(),p.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;ak(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ig(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],r=[];return i.length=Tj(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,r),new e(i,p.XY,r)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var r=this.endss_[t].slice(),o=r[r.length-1];if(0!==e)for(var s=0,n=r.length;s<n;++s)r[s]-=e;return new ia(this.flatCoordinates.slice(e,o),this.layout,r)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[],o=0,s=0,n=i.length;s<n;++s){var a=i[s].slice(),l=a[a.length-1];if(0!==o)for(var $=0,h=a.length;$<h;++$)a[$]-=o;var d=new ia(e.slice(o,l),t,a);r.push(d),o=l}return r},e.prototype.getType=function(){return k.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return _j(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=Qj(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()},e}($);yf.default=ri;var si=Zb&&Zb.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),j={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},Zc={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"},$c=function(e){function t(t,r){var i=e.call(this,t)||this;return i.feature=r,i}return si(t,e),t}(A),bn=function(e){function t(t){var r=this,i=t;i.stopDown||(i.stopDown=Ca),(r=e.call(this,i)||this).shouldHandle_=!1,r.downPx_=null,r.downTimeout_,r.lastDragTime_,r.freehand_=!1,r.source_=t.source?t.source:null,r.features_=t.features?t.features:null,r.snapTolerance_=t.snapTolerance?t.snapTolerance:12,r.type_=t.type,r.mode_=fn(r.type_),r.stopClick_=!!t.stopClick,r.minPoints_=t.minPoints?t.minPoints:r.mode_===j.POLYGON?3:2,r.maxPoints_=t.maxPoints?t.maxPoints:1/0,r.finishCondition_=t.finishCondition?t.finishCondition:H;var o=t.geometryFunction;if(!o)if(r.type_===k.CIRCLE)o=function(e,t,r){var i=t||new Yc([NaN,NaN]),o=q(e[0],r),n=I(o,q(e[1],r));i.setCenterAndRadius(o,Math.sqrt(n));var s=fb();return s&&i.transform(r,s),i};else{var n,s=r.mode_;s===j.POINT?n=va:s===j.LINE_STRING?n=nb:s===j.POLYGON&&(n=ia),o=function(e,t,r){var i=t;return i?s===j.POLYGON?e[0].length?i.setCoordinates([e[0].concat([e[0][0]])]):i.setCoordinates([]):i.setCoordinates(e):i=new n(e),i}}return r.geometryFunction_=o,r.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,r.finishCoordinate_=null,r.sketchFeature_=null,r.sketchPoint_=null,r.sketchCoords_=null,r.sketchLine_=null,r.sketchLineCoords_=null,r.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,r.overlay_=new Qb({source:new Sb({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:cn(),updateWhileInteracting:!0}),r.geometryName_=t.geometryName,r.condition_=t.condition?t.condition:ff,r.freehandCondition_,t.freehand?r.freehandCondition_=ef:r.freehandCondition_=t.freehandCondition?t.freehandCondition:Tc,r.addEventListener(l(Qc.ACTIVE),r.updateState_),r}return si(t,e),t.prototype.setMap=function(t){e.prototype.setMap.call(this,t),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(t){t.originalEvent.type===f.CONTEXTMENU&&t.preventDefault(),this.freehand_=this.mode_!==j.POINT&&this.freehandCondition_(t);var r=t.type===b.POINTERMOVE,i=!0;!this.freehand_&&this.lastDragTime_&&t.type===b.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,r=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&t.type===b.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===b.POINTERDOWN?i=!1:r?(i=t.type===b.POINTERMOVE)&&this.freehand_?i=this.handlePointerMove_(t):("mouse"==t.pointerEvent.pointerType||t.type===b.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===b.DBLCLICK&&(i=!1),e.prototype.handleEvent.call(this,t)&&i},t.prototype.handleDownEvent=function(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new na(b.POINTERMOVE,e.map,e.pointerEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)},t.prototype.handleUpEvent=function(e){var t=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);var r=this.mode_===j.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||r?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate):(this.startDrawing_(e),this.mode_===j.POINT&&this.finishDrawing()),t=!1):this.freehand_&&this.abortDrawing(),!t&&this.stopClick_&&e.stopPropagation(),t},t.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,r=e.pixel,i=t[0]-r[0],o=t[1]-r[1],n=i*i+o*o;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e),!0},t.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var r=!1,i=[this.finishCoordinate_];if(this.mode_===j.LINE_STRING)r=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===j.POLYGON){var o=this.sketchCoords_;r=o[0].length>this.minPoints_,i=[o[0][0],o[0][o[0].length-2]]}if(r)for(var n=e.map,s=0,a=i.length;s<a;s++){var $=i[s],h=n.getPixelFromCoordinate($),L=e.pixel,l=L[0]-h[0],p=L[1]-h[1],d=this.freehand_?1:this.snapTolerance_;if(t=Math.sqrt(l*l+p*p)<=d){this.finishCoordinate_=$;break}}}return t},t.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new X(new va(t)),this.updateSketchFeatures_())},t.prototype.startDrawing_=function(e){var t=e.coordinate,r=e.map.getView().getProjection();this.finishCoordinate_=t,this.mode_===j.POINT?this.sketchCoords_=t.slice():this.mode_===j.POLYGON?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new X(new nb(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_,void 0,r);this.sketchFeature_=new X,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new $c(Zc.DRAWSTART,this.sketchFeature_))},t.prototype.modifyDrawing_=function(e){var t,r,i,o=e.coordinate,n=this.sketchFeature_.getGeometry(),s=e.map.getView().getProjection();(this.mode_===j.POINT?r=this.sketchCoords_:this.mode_===j.POLYGON?(r=(t=this.sketchCoords_[0])[t.length-1],this.atFinish_(e)&&(o=this.finishCoordinate_.slice())):r=(t=this.sketchCoords_)[t.length-1],r[0]=o[0],r[1]=o[1],this.geometryFunction_(this.sketchCoords_,n,s),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(o);if(n.getType()==k.POLYGON&&this.mode_!==j.POLYGON){this.sketchLine_||(this.sketchLine_=new X);var a=n.getLinearRing(0);(i=this.sketchLine_.getGeometry())?(i.setFlatCoordinates(a.getLayout(),a.getFlatCoordinates()),i.changed()):(i=new nb(a.getFlatCoordinates(),a.getLayout()),this.sketchLine_.setGeometry(i))}else this.sketchLineCoords_&&(i=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(e){var t,r,i=this.sketchFeature_.getGeometry(),o=this.getMap().getView().getProjection();this.mode_===j.LINE_STRING?(this.finishCoordinate_=e.slice(),(r=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?r.pop():t=!0),r.push(e.slice()),this.geometryFunction_(r,i,o)):this.mode_===j.POLYGON&&((r=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?r.pop():t=!0),r.push(e.slice()),t&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,i,o)),this.updateSketchFeatures_(),t&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection();this.mode_===j.LINE_STRING?((e=this.sketchCoords_).splice(-2,1),this.geometryFunction_(e,t,r),e.length>=2&&(this.finishCoordinate_=e[e.length-2].slice())):this.mode_===j.POLYGON&&((e=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,r)),0===e.length&&this.abortDrawing(),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var e=this.abortDrawing_();if(e){var t=this.sketchCoords_,r=e.getGeometry(),i=this.getMap().getView().getProjection();this.mode_===j.LINE_STRING?(t.pop(),this.geometryFunction_(t,r,i)):this.mode_===j.POLYGON&&(t[0].pop(),this.geometryFunction_(t,r,i),t=r.getCoordinates()),this.type_===k.MULTI_POINT?e.setGeometry(new xf([t])):this.type_===k.MULTI_LINE_STRING?e.setGeometry(new qi([t])):this.type_===k.MULTI_POLYGON&&e.setGeometry(new ri([t])),this.dispatchEvent(new $c(Zc.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),e},t.prototype.abortDrawing=function(){var e=this.abortDrawing_();e&&this.dispatchEvent(new $c(Zc.DRAWABORT,e))},t.prototype.appendCoordinates=function(e){var t=this.mode_,r=[];t===j.LINE_STRING?r=this.sketchCoords_:t===j.POLYGON&&(r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]);for(var i=r.pop(),o=0;o<e.length;o++)this.addToDrawing_(e[o]);this.addToDrawing_(i)},t.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();var r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new $c(Zc.DRAWSTART,this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},t.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)},t}(i);function cn(){var e=Ob();return function(t,r){return e[t.getGeometry().getType()]}}function dn(e,t){return function(r,i,o){var n=q(r[0],o),s=q(r[1],o),a=Math.sqrt(I(n,s)),$=i||Td(new Yc(n),e),h=t;if(!t){var L=s[0]-n[0],l=s[1]-n[1];h=Math.atan(l/L)-(L<0?Math.PI:0)}Ud($,n,a,h);var p=fb();return p&&$.transform(o,p),$}}function en(){return function(e,t,r){var i=y(e.map(function(e){return q(e,r)})),o=[[sa(i),Fa(i),Ga(i),ga(i),sa(i)]],n=t;n?n.setCoordinates(o):n=new ia(o);var s=fb();return s&&n.transform(r,s),n}}function fn(e){var t;return e===k.POINT||e===k.MULTI_POINT?t=j.POINT:e===k.LINE_STRING||e===k.MULTI_LINE_STRING?t=j.LINE_STRING:e===k.POLYGON||e===k.MULTI_POLYGON?t=j.POLYGON:e===k.CIRCLE&&(t=j.CIRCLE),t}Zb.createRegularPolygon=dn,Zb.createBox=en,Zb.default=bn;var zf={};var ti=zf&&zf.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gn={EXTENTCHANGED:"extentchanged"},hn=function(e){function t(t){var r=e.call(this,gn.EXTENTCHANGED)||this;return r.extent=t,r}return ti(t,e),t}(A),jn=function(e){function t(t){var r=this,n=t||{};return(r=e.call(this,n)||this).extent_=null,r.pointerHandler_=null,r.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,r.snappedToVertex_=!1,r.extentFeature_=null,r.vertexFeature_=null,t||(t={}),r.extentOverlay_=new Qb({source:new Sb({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.boxStyle?t.boxStyle:kn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),r.vertexOverlay_=new Qb({source:new Sb({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.pointerStyle?t.pointerStyle:ln(),updateWhileAnimating:!0,updateWhileInteracting:!0}),t.extent&&r.setExtent(t.extent),r}return ti(t,e),t.prototype.snapToVertex_=function(e,t){var r=t.getCoordinateFromPixelInternal(e),n=this.getExtentInternal();if(n){var o=mn(n);o.sort(function(e,t){return Fc(r,e)-Fc(r,t)});var i=o[0],a=Dc(r,i),$=t.getPixelFromCoordinateInternal(a);if(Ec(e,$)<=this.pixelTolerance_){var l=t.getPixelFromCoordinateInternal(i[0]),p=t.getPixelFromCoordinateInternal(i[1]),u=I($,l),y=I($,p),s=Math.sqrt(Math.min(u,y));return this.snappedToVertex_=s<=this.pixelTolerance_,this.snappedToVertex_&&(a=u>y?i[1]:i[0]),a}}return null},t.prototype.handlePointerMove_=function(e){var t=e.pixel,r=e.map,n=this.snapToVertex_(t,r);n||(n=r.getCoordinateFromPixelInternal(t)),this.createOrUpdatePointerFeature_(n)},t.prototype.createOrUpdateExtentFeature_=function(e){var t=this.extentFeature_;return t?e?t.setGeometry(Oa(e)):t.setGeometry(void 0):(t=e?new X(Oa(e)):new X({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t},t.prototype.createOrUpdatePointerFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(t=new X(new va(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t));return t},t.prototype.handleEvent=function(t){return!t.pointerEvent||(t.type!=b.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),e.prototype.handleEvent.call(this,t),!1)},t.prototype.handleDownEvent=function(e){var t=e.pixel,r=e.map,n=this.getExtentInternal(),o=this.snapToVertex_(t,r),i=function(e){var t=null,r=null;return e[0]==n[0]?t=n[2]:e[0]==n[2]&&(t=n[0]),e[1]==n[1]?r=n[3]:e[1]==n[3]&&(r=n[1]),null!==t&&null!==r?[t,r]:null};if(o&&n){var a=o[0]==n[0]||o[0]==n[2]?o[0]:null,$=o[1]==n[1]||o[1]==n[3]?o[1]:null;null!==a&&null!==$?this.pointerHandler_=ui(i(o)):null!==a?this.pointerHandler_=vi(i([a,n[1]]),i([a,n[3]])):null!==$&&(this.pointerHandler_=vi(i([n[0],$]),i([n[2],$])))}else o=r.getCoordinateFromPixelInternal(t),this.setExtent([o[0],o[1],o[0],o[1]]),this.pointerHandler_=ui(o);return!0},t.prototype.handleDragEvent=function(e){if(this.pointerHandler_){var t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}return!0},t.prototype.handleUpEvent=function(e){this.pointerHandler_=null;var t=this.getExtentInternal();return t&&0!==ud(t)||this.setExtent(null),!1},t.prototype.setMap=function(t){this.extentOverlay_.setMap(t),this.vertexOverlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getExtent=function(){return Gb(this.getExtentInternal(),this.getMap().getView().getProjection())},t.prototype.getExtentInternal=function(){return this.extent_},t.prototype.setExtent=function(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new hn(this.extent_))},t}(i);function kn(){var e=Ob();return function(t,r){return e[k.POLYGON]}}function ln(){var e=Ob();return function(t,r){return e[k.POINT]}}function ui(e){return function(t){return y([e,t])}}function vi(e,t){return e[0]==t[0]?function(r){return y([e,[r[0],t[1]]])}:e[1]==t[1]?function(r){return y([e,[t[0],r[1]]])}:null}function mn(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]}zf.default=jn;var _c={};var wi=_c&&_c.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),xi=0,$b=1,yi=[0,0,0,0],rb=[],Af={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},ad=function(e){function t(t,r,i){var o=e.call(this,t)||this;return o.features=r,o.mapBrowserEvent=i,o}return wi(t,e),t}(A);_c.ModifyEvent=ad;var nn=function(e){function t(t){var r,i=e.call(this,t)||this;if(i.boundHandleFeatureChange_=i.handleFeatureChange_.bind(i),i.condition_=t.condition?t.condition:di,i.defaultDeleteCondition_=function(e){return Bm(e)&&bi(e)},i.deleteCondition_=t.deleteCondition?t.deleteCondition:i.defaultDeleteCondition_,i.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:ef,i.vertexFeature_=null,i.vertexSegments_=null,i.lastPixel_=[0,0],i.ignoreNextSingleClick_=!1,i.modified_=!1,i.rBush_=new Hc,i.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,i.snappedToVertex_=!1,i.changingFeature_=!1,i.dragSegments_=[],i.overlay_=new Qb({source:new Sb({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:pn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),i.SEGMENT_WRITERS_={Point:i.writePointGeometry_.bind(i),LineString:i.writeLineStringGeometry_.bind(i),LinearRing:i.writeLineStringGeometry_.bind(i),Polygon:i.writePolygonGeometry_.bind(i),MultiPoint:i.writeMultiPointGeometry_.bind(i),MultiLineString:i.writeMultiLineStringGeometry_.bind(i),MultiPolygon:i.writeMultiPolygonGeometry_.bind(i),Circle:i.writeCircleGeometry_.bind(i),GeometryCollection:i.writeGeometryCollectionGeometry_.bind(i)},i.source_=null,t.source?(i.source_=t.source,r=new x(i.source_.getFeatures()),i.source_.addEventListener(O.ADDFEATURE,i.handleSourceAdd_.bind(i)),i.source_.addEventListener(O.REMOVEFEATURE,i.handleSourceRemove_.bind(i))):r=t.features,!r)throw new Error("The modify interaction requires features or a source");return i.features_=r,i.features_.forEach(i.addFeature_.bind(i)),i.features_.addEventListener(u.ADD,i.handleFeatureAdd_.bind(i)),i.features_.addEventListener(u.REMOVE,i.handleFeatureRemove_.bind(i)),i.lastPointerEvent_=null,i}return wi(t,e),t.prototype.addFeature_=function(e){var t=e.getGeometry();if(t){var r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}var i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(f.CHANGE,this.boundHandleFeatureChange_)},t.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new ad(Af.MODIFYSTART,this.features_,e)))},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(f.CHANGE,this.boundHandleFeatureChange_)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach(function(t){e===t.feature&&r.push(t)});for(var i=r.length-1;i>=0;--i){for(var o=r[i],n=this.dragSegments_.length-1;n>=0;--n)this.dragSegments_[n][0]===o&&this.dragSegments_.splice(n,1);t.remove(o)}},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),i={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),i)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i){var n=r[i],a={feature:e,geometry:t,depth:[i],index:i,segment:[n,n]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),a={feature:e,geometry:t,index:i,segment:n};this.rBush_.insert(y(n),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],a=0,s=n.length-1;a<s;++a){var $=n.slice(a,a+2),p={feature:e,geometry:t,depth:[i],index:a,segment:$};this.rBush_.insert(y($),p)}},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],a=0,s=n.length-1;a<s;++a){var $=n.slice(a,a+2),p={feature:e,geometry:t,depth:[i],index:a,segment:$};this.rBush_.insert(y($),p)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],a=0,s=n.length;a<s;++a)for(var $=n[a],p=0,u=$.length-1;p<u;++p){var d=$.slice(p,p+2),m={feature:e,geometry:t,depth:[a,i],index:p,segment:d};this.rBush_.insert(y(d),m)}},t.prototype.writeCircleGeometry_=function(e,t){var r=t.getCenter(),i={feature:e,geometry:t,index:xi,segment:[r,r]},o={feature:e,geometry:t,index:$b,segment:[r,r]},n=[i,o];i.featureSegments=n,o.featureSegments=n,this.rBush_.insert(ec(r),i),this.rBush_.insert(t.getExtent(),o)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),i=0;i<r.length;++i){var o=r[i];(0,this.SEGMENT_WRITERS_[o.getType()])(e,o)}},t.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(t=new X(new va(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t));return t},t.prototype.handleEvent=function(t){return!t.pointerEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=b.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(r=!(t.type!=b.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==b.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!r);var r},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);for(var t=e.coordinate,r=0,i=this.dragSegments_.length;r<i;++r){for(var o=this.dragSegments_[r],n=o[0],a=n.depth,s=n.geometry,$=void 0,p=n.segment,u=o[1];t.length<s.getStride();)t.push(p[u][t.length]);switch(s.getType()){case k.POINT:$=t,p[0]=t,p[1]=t;break;case k.MULTI_POINT:($=s.getCoordinates())[n.index]=t,p[0]=t,p[1]=t;break;case k.LINE_STRING:($=s.getCoordinates())[n.index+u]=t,p[u]=t;break;case k.MULTI_LINE_STRING:case k.POLYGON:($=s.getCoordinates())[a[0]][n.index+u]=t,p[u]=t;break;case k.MULTI_POLYGON:($=s.getCoordinates())[a[1]][a[0]][n.index+u]=t,p[u]=t;break;case k.CIRCLE:p[0]=t,p[1]=t,n.index===xi?(this.changingFeature_=!0,s.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,s.setRadius(Ec(s.getCenter(),t)),this.changingFeature_=!1);}$&&this.setGeometryCoordinates_(s,$)}this.createOrUpdateVertexFeature_(t)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;var t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var i=e.map.getView().getProjection(),o=[],n=r.getGeometry().getCoordinates(),a=y([n]),s=this.rBush_.getInExtent(a),$={};s.sort(on);for(var p=0,u=s.length;p<u;++p){var d=s[p],m=d.segment,g=ca(d.feature),h=d.depth;if(h&&(g+="-"+h.join("-")),$[g]||($[g]=new Array(2)),d.geometry.getType()!==k.CIRCLE||d.index!==$b){if(!W(m[0],n)||$[g][0]){if(!W(m[1],n)||$[g][1])ca(m)in this.vertexSegments_&&!$[g][0]&&!$[g][1]&&this.insertVertexCondition_(e)&&o.push([d,n]);else{if((d.geometry.getType()===k.LINE_STRING||d.geometry.getType()===k.MULTI_LINE_STRING)&&$[g][0]&&0===$[g][0].index)continue;this.dragSegments_.push([d,1]),$[g][1]=d}}else this.dragSegments_.push([d,0]),$[g][0]=d;}else{var l=Ai(t,d,i);W(l,n)&&!$[g][0]&&(this.dragSegments_.push([d,0]),$[g][0]=d)}}o.length&&this.willModifyFeatures_(e);for(var _=o.length-1;_>=0;--_)this.insertVertex_.apply(this,o[_])}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var r=this.dragSegments_[t][0],i=r.geometry;if(i.getType()===k.CIRCLE){var o=i.getCenter(),n=r.featureSegments[0],a=r.featureSegments[1];n.segment[0]=o,n.segment[1]=o,a.segment[0]=o,a.segment[1]=o,this.rBush_.update(ec(o),n),this.rBush_.update(i.getExtent(),a)}else this.rBush_.update(y(r.segment),r)}return this.modified_&&(this.dispatchEvent(new ad(Af.MODIFYEND,this.features_,e)),this.modified_=!1),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)},t.prototype.handlePointerAtPixel_=function(e,t,r){var i=r||t.getCoordinateFromPixel(e),o=t.getView().getProjection(),n=ua(ec(i,yi),o),a=t.getView().getResolution()*this.pixelTolerance_,s=Gb(dc(n,a,yi),o),$=this.rBush_.getInExtent(s);if($.length>0){$.sort(function(e,t){return zi(i,e,o)-zi(i,t,o)});var p=$[0],u=p.segment,d=Ai(i,p,o),m=t.getPixelFromCoordinate(d),g=Ec(e,m);if(g<=this.pixelTolerance_){var h={};if(p.geometry.getType()===k.CIRCLE&&p.index===$b)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d);else{var l=t.getPixelFromCoordinate(u[0]),_=t.getPixelFromCoordinate(u[1]),c=I(m,l),v=I(m,_);g=Math.sqrt(Math.min(c,v)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(d=c>v?u[1]:u[0]),this.createOrUpdateVertexFeature_(d);for(var y=1,D=$.length;y<D;++y){var f=$[y].segment;if(!(W(u[0],f[0])&&W(u[1],f[1])||W(u[0],f[1])&&W(u[1],f[0])))break;h[ca(f)]=!0}}return h[ca(u)]=!0,void(this.vertexSegments_=h)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var r,i=e.segment,o=e.feature,n=e.geometry,a=e.depth,s=e.index;t.length<n.getStride();)t.push(0);switch(n.getType()){case k.MULTI_LINE_STRING:case k.POLYGON:(r=n.getCoordinates())[a[0]].splice(s+1,0,t);break;case k.MULTI_POLYGON:(r=n.getCoordinates())[a[1]][a[0]].splice(s+1,0,t);break;case k.LINE_STRING:(r=n.getCoordinates()).splice(s+1,0,t);break;default:return;}this.setGeometryCoordinates_(n,r);var $=this.rBush_;$.remove(e),this.updateSegmentIndices_(n,s,a,1);var p={segment:[i[0],t],feature:o,geometry:n,depth:a,index:s};$.insert(y(p.segment),p),this.dragSegments_.push([p,1]);var u={segment:[t,i[1]],feature:o,geometry:n,depth:a,index:s+1};$.insert(y(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=b.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e);var t=this.removeVertex_();return this.dispatchEvent(new ad(Af.MODIFYEND,this.features_,e)),this.modified_=!1,t}return!1},t.prototype.removeVertex_=function(){var e,t,r,i,o,n,a,s,$,p,u,d=this.dragSegments_,m={},g=!1;for(o=d.length-1;o>=0;--o)p=(r=d[o])[0],u=ca(p.feature),p.depth&&(u+="-"+p.depth.join("-")),u in m||(m[u]={}),0===r[1]?(m[u].right=p,m[u].index=p.index):1==r[1]&&(m[u].left=p,m[u].index=p.index+1);for(u in m){switch($=m[u].right,a=m[u].left,(s=(n=m[u].index)-1)<0&&(s=0),e=t=(i=(p=void 0!==a?a:$).geometry).getCoordinates(),g=!1,i.getType()){case k.MULTI_LINE_STRING:t[p.depth[0]].length>2&&(t[p.depth[0]].splice(n,1),g=!0);break;case k.LINE_STRING:t.length>2&&(t.splice(n,1),g=!0);break;case k.MULTI_POLYGON:e=e[p.depth[1]];case k.POLYGON:(e=e[p.depth[0]]).length>4&&(n==e.length-1&&(n=0),e.splice(n,1),g=!0,0===n&&(e.pop(),e.push(e[0]),s=e.length-1));}if(g){this.setGeometryCoordinates_(i,t);var h=[];if(void 0!==a&&(this.rBush_.remove(a),h.push(a.segment[0])),void 0!==$&&(this.rBush_.remove($),h.push($.segment[1])),void 0!==a&&void 0!==$){var l={depth:p.depth,feature:p.feature,geometry:p.geometry,index:s,segment:h};this.rBush_.insert(y(l.segment),l)}this.updateSegmentIndices_(i,n,p.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return g},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(void 0===r||void 0===o.depth||Ya(o.depth,r))&&o.index>t&&(o.index+=i)})},t}(i);function on(e,t){return e.index-t.index}function zi(e,t,r){var i=t.geometry;if(i.getType()===k.CIRCLE){var o=i;if(t.index===$b){var n=I(o.getCenter(),e),a=Math.sqrt(n)-o.getRadius();return a*a}}var s=q(e,r);return rb[0]=q(t.segment[0],r),rb[1]=q(t.segment[1],r),Fc(s,rb)}function Ai(e,t,r){var i=t.geometry;if(i.getType()===k.CIRCLE&&t.index===$b)return i.getClosestPoint(e);var o=q(e,r);return rb[0]=q(t.segment[0],r),rb[1]=q(t.segment[1],r),Fb(Dc(o,rb),r)}function pn(){var e=Ob();return function(t,r){return e[k.POINT]}}_c.default=nn;var Bf={};var Bi=Bf&&Bf.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),qn={SELECT:"select"},rn=function(e){function t(t,r,i,o){var n=e.call(this,t)||this;return n.selected=r,n.deselected=i,n.mapBrowserEvent=o,n}return Bi(t,e),t}(A),bd={},sn=function(e){function t(t){var r,i=e.call(this,{handleEvent:tn})||this,o=t||{};if(i.condition_=o.condition?o.condition:bi,i.addCondition_=o.addCondition?o.addCondition:ai,i.removeCondition_=o.removeCondition?o.removeCondition:ai,i.toggleCondition_=o.toggleCondition?o.toggleCondition:Tc,i.multi_=!!o.multi&&o.multi,i.filter_=o.filter?o.filter:H,i.hitTolerance_=o.hitTolerance?o.hitTolerance:0,i.style_=void 0!==o.style?o.style:un(),i.features_=o.features||new x,o.layers){if("function"==typeof o.layers)r=o.layers;else{var n=o.layers;r=function(e){return wb(n,e)}}}else r=H;i.layerFilter_=r,i.featureLayerAssociation_={};var a=i.getFeatures();return a.addEventListener(u.ADD,i.addFeature_.bind(i)),a.addEventListener(u.REMOVE,i.removeFeature_.bind(i)),i}return Bi(t,e),t.prototype.addFeatureLayerAssociation_=function(e,t){this.featureLayerAssociation_[ca(e)]=t},t.prototype.getFeatures=function(){return this.features_},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(e){return this.featureLayerAssociation_[ca(e)]},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),e.prototype.setMap.call(this,t),t&&this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))},t.prototype.addFeature_=function(e){var t=e.element;this.style_&&this.applySelectedStyle_(t)},t.prototype.removeFeature_=function(e){var t=e.element;this.style_&&this.restorePreviousStyle_(t)},t.prototype.getStyle=function(){return this.style_},t.prototype.applySelectedStyle_=function(e){var t=ca(e);t in bd||(bd[t]=e.getStyle()),e.setStyle(this.style_)},t.prototype.restorePreviousStyle_=function(e){var r=ca(e),i=this.getMap().getInteractions().getArray().filter(function(r){return r instanceof t&&r.getStyle()&&-1!==r.getFeatures().getArray().indexOf(e)});i.length>0?e.setStyle(i[i.length-1].getStyle()):(e.setStyle(bd[r]),delete bd[r])},t.prototype.removeFeatureLayerAssociation_=function(e){delete this.featureLayerAssociation_[ca(e)]},t}(Ba);function tn(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),r=this.removeCondition_(e),i=this.toggleCondition_(e),o=!t&&!r&&!i,n=e.map,a=this.getFeatures(),$=[],s=[];if(o){Xa(this.featureLayerAssociation_),n.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return s.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var l=a.getLength()-1;l>=0;--l){var u=a.item(l),p=s.indexOf(u);p>-1?s.splice(p,1):(a.remove(u),$.push(u))}0!==s.length&&a.extend(s)}else{n.forEachFeatureAtPixel(e.pixel,function(e,o){if(this.filter_(e,o))return!t&&!i||wb(a.getArray(),e)?(r||i)&&wb(a.getArray(),e)&&($.push(e),this.removeFeatureLayerAssociation_(e)):(s.push(e),this.addFeatureLayerAssociation_(e,o)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var c=$.length-1;c>=0;--c)a.remove($[c]);a.extend(s)}return(s.length>0||$.length>0)&&this.dispatchEvent(new rn(qn.SELECT,s,$,e)),!0}function un(){var e=Ob();return K(e[k.POLYGON],e[k.LINE_STRING]),K(e[k.GEOMETRY_COLLECTION],e[k.LINE_STRING]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}Bf.default=sn;var Cf={};var vn=Cf&&Cf.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();function Ci(e){return e.feature?e.feature:e.element?e.element:void 0}var sb=[],wn=function(e){function t(t){var r=this,o=t||{},i=o;return i.handleDownEvent||(i.handleDownEvent=H),i.stopDown||(i.stopDown=Ca),(r=e.call(this,i)||this).source_=o.source?o.source:null,r.vertex_=void 0===o.vertex||o.vertex,r.edge_=void 0===o.edge||o.edge,r.features_=o.features?o.features:null,r.featuresListenerKeys_=[],r.featureChangeListenerKeys_={},r.indexedFeaturesExtents_={},r.pendingFeatures_={},r.pixelTolerance_=void 0!==o.pixelTolerance?o.pixelTolerance:10,r.rBush_=new Hc,r.SEGMENT_WRITERS_={Point:r.writePointGeometry_.bind(r),LineString:r.writeLineStringGeometry_.bind(r),LinearRing:r.writeLineStringGeometry_.bind(r),Polygon:r.writePolygonGeometry_.bind(r),MultiPoint:r.writeMultiPointGeometry_.bind(r),MultiLineString:r.writeMultiLineStringGeometry_.bind(r),MultiPolygon:r.writeMultiPolygonGeometry_.bind(r),GeometryCollection:r.writeGeometryCollectionGeometry_.bind(r),Circle:r.writeCircleGeometry_.bind(r)},r}return vn(t,e),t.prototype.addFeature=function(e,t){var r=void 0===t||t,o=ca(e),i=e.getGeometry();if(i){var n=this.SEGMENT_WRITERS_[i.getType()];n&&(this.indexedFeaturesExtents_[o]=i.getExtent(ea()),n(e,i))}r&&(this.featureChangeListenerKeys_[o]=a(e,f.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r.snapped&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=Ci(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=Ci(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=ca(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=ld(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,o=ca(e),i=this.indexedFeaturesExtents_[o];if(i){var n=this.rBush_,a=[];n.forEachInExtent(i,function(t){e===t.feature&&a.push(t)});for(var s=a.length-1;s>=0;--s)n.remove(a[s])}r&&(d(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},t.prototype.setMap=function(t){var r=this.getMap(),o=this.featuresListenerKeys_,i=this.getFeatures_();r&&(o.forEach(d),o.length=0,i.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?o.push(a(this.features_,u.ADD,this.handleFeatureAdd_,this),a(this.features_,u.REMOVE,this.handleFeatureRemove_,this)):this.source_&&o.push(a(this.source_,O.ADDFEATURE,this.handleFeatureAdd_,this),a(this.source_,O.REMOVEFEATURE,this.handleFeatureRemove_,this)),i.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var o=r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i=r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),n=y([o,i]),a=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(a=a.filter(function(e){return e.feature.getGeometry().getType()!==k.CIRCLE}));var s=!1,$=null,u=null;if(0===a.length)return{snapped:s,vertex:$,vertexPixel:u};for(var p,l=r.getView().getProjection(),h=q(t,l),m=1/0,d=0;d<a.length;++d){var C=a[d];sb[0]=q(C.segment[0],l),sb[1]=q(C.segment[1],l);var c=Fc(h,sb);c<m&&(p=C,m=c)}var g=p.segment;if(this.vertex_&&!this.edge_){var _=r.getPixelFromCoordinate(g[0]),v=r.getPixelFromCoordinate(g[1]),f=I(e,_),M=I(e,v);Math.sqrt(Math.min(f,M))<=this.pixelTolerance_&&(s=!0,$=f>M?g[1]:g[0],u=r.getPixelFromCoordinate($))}else if(this.edge_){var j=p.feature.getGeometry().getType()===k.CIRCLE;if(j?$=tl(t,p.feature.getGeometry()):(sb[0]=q(g[0],l),sb[1]=q(g[1],l),$=Fb(Dc(h,sb),l)),u=r.getPixelFromCoordinate($),Ec(e,u)<=this.pixelTolerance_&&(s=!0,this.vertex_&&!j)){_=r.getPixelFromCoordinate(g[0]),v=r.getPixelFromCoordinate(g[1]),f=I(u,_),M=I(u,v);Math.sqrt(Math.min(f,M))<=this.pixelTolerance_&&($=f>M?g[1]:g[0],u=r.getPixelFromCoordinate($))}}return s&&(u=[Math.round(u[0]),Math.round(u[1])]),{snapped:s,vertex:$,vertexPixel:u}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,t){for(var r=Td(t).getCoordinates()[0],o=0,i=r.length-1;o<i;++o){var n=r.slice(o,o+2),a={feature:e,segment:n};this.rBush_.insert(y(n),a)}},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),o=0;o<r.length;++o){var i=this.SEGMENT_WRITERS_[r[o].getType()];i&&i(e,r[o])}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length-1;o<i;++o){var n=r.slice(o,o+2),a={feature:e,segment:n};this.rBush_.insert(y(n),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o)for(var n=r[o],a=0,s=n.length-1;a<s;++a){var $=n.slice(a,a+2),u={feature:e,segment:$};this.rBush_.insert(y($),u)}},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o){var n=r[o],a={feature:e,segment:[n,n]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o)for(var n=r[o],a=0,s=n.length;a<s;++a)for(var $=n[a],u=0,p=$.length-1;u<p;++u){var l=$.slice(u,u+2),h={feature:e,segment:l};this.rBush_.insert(y(l),h)}},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),o={feature:e,segment:[r,r]};this.rBush_.insert(t.getExtent(),o)},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),o=0,i=r.length;o<i;++o)for(var n=r[o],a=0,s=n.length-1;a<s;++a){var $=n.slice(a,a+2),u={feature:e,segment:$};this.rBush_.insert(y($),u)}},t}(i);Cf.default=wn;var cd={};var Di=cd&&cd.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),Df={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},dd=function(t){function e(e,r,a,n,s){var o=t.call(this,e)||this;return o.features=r,o.coordinate=a,o.startCoordinate=n,o.mapBrowserEvent=s,o}return Di(e,t),e}(A);cd.TranslateEvent=dd;var xn=function(t){function e(e){var r,a=this,n=e||{};if((a=t.call(this,n)||this).lastCoordinate_=null,a.startCoordinate_=null,a.features_=void 0!==n.features?n.features:null,n.layers){if("function"==typeof n.layers)r=n.layers;else{var s=n.layers;r=function(t){return wb(s,t)}}}else r=H;return a.layerFilter_=r,a.filter_=n.filter?n.filter:H,a.hitTolerance_=n.hitTolerance?n.hitTolerance:0,a.lastFeature_=null,a.addEventListener(l(Qc.ACTIVE),a.handleActiveChanged_),a}return Di(e,t),e.prototype.handleDownEvent=function(t){if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);var e=this.features_||new x([this.lastFeature_]);return this.dispatchEvent(new dd(Df.TRANSLATESTART,e,t.coordinate,this.startCoordinate_,t)),!0}return!1},e.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);var e=this.features_||new x([this.lastFeature_]);return this.dispatchEvent(new dd(Df.TRANSLATEEND,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1},e.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,r=e[0]-this.lastCoordinate_[0],a=e[1]-this.lastCoordinate_[1],n=this.features_||new x([this.lastFeature_]);n.forEach(function(t){var e=t.getGeometry();e.translate(r,a),t.setGeometry(e)}),this.lastCoordinate_=e,this.dispatchEvent(new dd(Df.TRANSLATING,n,e,this.startCoordinate_,t))}},e.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},e.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t,e){if(this.filter_(t,e)&&(!this.features_||wb(this.features_.getArray(),t)))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var r=this.getMap();t.prototype.setMap.call(this,e),this.updateState_(r)},e.prototype.handleActiveChanged_=function(){this.updateState_(null)},e.prototype.updateState_=function(t){var e=this.getMap(),r=this.getActive();e&&r||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")},e}(i);cd.default=xn;var yn=Be&&Be.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Ei=function(t){function r(r){return(r=G({},r)).controls||(r.controls=_l()),r.interactions||(r.interactions=xm()),t.call(this,r)||this}return yn(r,t),r.prototype.createRenderer=function(){return new $e(this)},r}(Se);Be.default=Ei;var Ef={};var zn=function(){function e(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return e.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},e.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},e.prototype.forEach=function(e){for(var t=this.oldest_;t;)e(t.value_,t.key_,this),t=t.newer},e.prototype.get=function(e,t){var r=this.entries_[e];return g(void 0!==r,15),r===this.newest_?r.value_:(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r,r.value_)},e.prototype.remove=function(e){var t=this.entries_[e];return g(void 0!==t,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var e,t=new Array(this.count_),r=0;for(e=this.newest_;e;e=e.older)t[r++]=e.key_;return t},e.prototype.getValues=function(){var e,t=new Array(this.count_),r=0;for(e=this.newest_;e;e=e.older)t[r++]=e.value_;return t},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.pop=function(){var e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},e.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},e.prototype.set=function(e,t){g(!(e in this.entries_),16);var r={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[e]=r,++this.count_},e.prototype.setSize=function(e){this.highWaterMark=e},e}();function Fi(e,t,$,r){return void 0!==r?(r[0]=e,r[1]=t,r[2]=$,r):[e,t,$]}function ed(e,t,$){return e+"/"+t+"/"+$}function Gi(e){return ed(e[0],e[1],e[2])}function An(e){return e.split("/").map(Number)}function Bn(e){return(e[1]<<e[0])+e[2]}function Cn(e,t){var $=e[0],r=e[1],n=e[2];if(t.getMinZoom()>$||$>t.getMaxZoom())return!1;var o,y=t.getExtent();return!(o=y?t.getTileRangeForExtentAndZ(y,$):t.getFullTileRange($))||o.containsXY(r,n)}var Dn=Ef&&Ef.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Ff=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dn(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=this.peekFirstKey(),e=An(t)[0];this.forEach(function(t){t.tileCoord[0]!==e&&(this.remove(Gi(t.tileCoord)),t.release())}.bind(this))}},e}(zn);Ef.default=Ff;var Gf=function(){function t(t,i,n,m){this.minX=t,this.maxX=i,this.minY=n,this.maxY=m}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function Hf(t,i,n,m,e){return void 0!==e?(e.minX=t,e.maxX=i,e.minY=n,e.maxY=m,e):new Gf(t,i,n,m)}var En=.5;var pa=!0;var If={};var Jf={};var fd={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var Fn=Jf&&Jf.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),Hi=function(r){function e(e){var t=this,o=e||{},n=G({},o);return delete n.preload,delete n.useInterimTilesOnError,(t=r.call(this,n)||this).setPreload(void 0!==o.preload?o.preload:0),t.setUseInterimTilesOnError(void 0===o.useInterimTilesOnError||o.useInterimTilesOnError),t}return Fn(e,r),e.prototype.getPreload=function(){return this.get(fd.PRELOAD)},e.prototype.setPreload=function(r){this.set(fd.PRELOAD,r)},e.prototype.getUseInterimTilesOnError=function(){return this.get(fd.USE_INTERIM_TILES_ON_ERROR)},e.prototype.setUseInterimTilesOnError=function(r){this.set(fd.USE_INTERIM_TILES_ON_ERROR,r)},e}(Zd);Jf.default=Hi;var Kf={};var Gn=Kf&&Kf.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Lf=function(e){function t(t){var r=e.call(this,t)||this;return r.extentChanged=!0,r.renderedExtent_=null,r.renderedPixelRatio,r.renderedProjection=null,r.renderedRevision,r.renderedTiles=[],r.newTiles_=!1,r.tmpExtent=ea(),r.tmpTileRange_=new Gf(0,0,0,0),r}return Gn(t,e),t.prototype.isDrawableTile=function(e){var t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==ba.LOADED||r==ba.EMPTY||r==ba.ERROR&&!i},t.prototype.getTile=function(e,t,r,i){var o=i.pixelRatio,n=i.viewState.projection,a=this.getLayer(),s=a.getSource().getTile(e,t,r,o,n);return s.getState()==ba.ERROR&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):s.setState(ba.LOADED)),this.isDrawableTile(s)||(s=s.getInterimTile()),s},t.prototype.loadedTileCallback=function(t,r,i){return!!this.isDrawableTile(i)&&e.prototype.loadedTileCallback.call(this,t,r,i)},t.prototype.prepareFrame=function(e){return!!this.getLayer().getSource()},t.prototype.renderFrame=function(e,t){var r=e.layerStatesArray[e.layerIndex],i=e.viewState,o=i.projection,n=i.resolution,a=i.center,s=i.rotation,l=e.pixelRatio,p=this.getLayer(),$=p.getSource(),d=$.getRevision(),h=$.getTileGridForProjection(o),u=h.getZForResolution(n,$.zDirection),c=h.getResolution(u),g=e.extent,m=r.extent&&ua(r.extent,o);m&&(g=Ab(g,ua(r.extent,o)));var T=$.getTilePixelRatio(l),S=Math.round(e.size[0]*T),f=Math.round(e.size[1]*T);if(s){var P=Math.round(Math.sqrt(S*S+f*f));S=P,f=P}var I=c*S/2/T,v=c*f/2/T,x=[a[0]-I,a[1]-v,a[0]+I,a[1]+v],k=h.getTileRangeForExtentAndZ(g,u),y={};y[u]={};var R=this.createLoadedTileFinder($,o,y),_=this.tmpExtent,w=this.tmpTileRange_;this.newTiles_=!1;for(var E=k.minX;E<=k.maxX;++E)for(var C=k.minY;C<=k.maxY;++C){var j=this.getTile(u,E,C,e);if(this.isDrawableTile(j)){var b=ca(this);if(j.getState()==ba.LOADED){y[u][j.tileCoord.toString()]=j;var O=j.inTransition(b);this.newTiles_||!O&&-1!==this.renderedTiles.indexOf(j)||(this.newTiles_=!0)}if(1===j.getAlpha(b,e.time))continue}var A=h.getTileCoordChildTileRange(j.tileCoord,w,_),L=!1;A&&(L=R(u+1,A)),L||h.forEachTileCoordParentTileRange(j.tileCoord,R,w,_)}var U=c/n;ha(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/T,1/T,s,-S/2,-f/2);var q=this.createTransformString(this.pixelTransform);this.useContainer(t,q,r.opacity);var D=this.context,F=D.canvas;Hd(this.inversePixelTransform,this.pixelTransform),ha(this.tempTransform_,S/2,f/2,U,U,0,-S/2,-f/2),F.width!=S||F.height!=f?(F.width=S,F.height=f):this.containerReused||D.clearRect(0,0,S,f),m&&this.clipUnrotated(D,e,m),this.preRender(D,e),this.renderedTiles.length=0;var M,z,Y,Z=Object.keys(y).map(Number);Z.sort(ra),1!==r.opacity||this.containerReused&&!$.getOpaque(e.viewState.projection)?(M=[],z=[]):Z=Z.reverse();for(var K=Z.length-1;K>=0;--K){var X=Z[K],G=$.getTilePixelSize(X,l,o),Q=h.getResolution(X)/c,N=G[0]*Q*U,B=G[1]*Q*U,H=h.getTileCoordForCoordAndZ(ga(x),X),J=h.getTileCoordExtent(H),V=da(this.tempTransform_,[T*(J[0]-x[0])/c,T*(x[3]-J[3])/c]),W=T*$.getGutterForProjection(o),ee=y[X];for(var te in ee){var re=(j=ee[te]).tileCoord,ie=V[0]-(H[1]-re[1])*N,oe=Math.round(ie+N),ne=V[1]-(H[2]-re[2])*B,ae=Math.round(ne+B),se=oe-(E=Math.round(ie)),le=ae-(C=Math.round(ne)),pe=u===X;if(!(O=pe&&1!==j.getAlpha(ca(this),e.time)))if(M){D.save(),Y=[E,C,E+se,C,E+se,C+le,E,C+le];for(var $e=0,de=M.length;$e<de;++$e)if(u!==X&&X<z[$e]){var he=M[$e];D.beginPath(),D.moveTo(Y[0],Y[1]),D.lineTo(Y[2],Y[3]),D.lineTo(Y[4],Y[5]),D.lineTo(Y[6],Y[7]),D.moveTo(he[6],he[7]),D.lineTo(he[4],he[5]),D.lineTo(he[2],he[3]),D.lineTo(he[0],he[1]),D.clip()}M.push(Y),z.push(X)}else D.clearRect(E,C,se,le);this.drawTileImage(j,e,E,C,se,le,W,pe,r.opacity),M&&!O&&D.restore(),this.renderedTiles.push(j),this.updateUsedTiles(e.usedTiles,$,j)}}return this.renderedRevision=d,this.renderedResolution=c,this.extentChanged=!this.renderedExtent_||!$a(this.renderedExtent_,x),this.renderedExtent_=x,this.renderedPixelRatio=l,this.renderedProjection=o,this.manageTilePyramid(e,$,h,l,o,g,u,p.getPreload()),this.scheduleExpireCache(e,$),this.postRender(D,e),r.extent&&D.restore(),q!==F.style.transform&&(F.style.transform=q),this.container},t.prototype.drawTileImage=function(e,t,r,i,o,n,a,s,l){var p=this.getTileImage(e);if(p){var $=ca(this),d=s?e.getAlpha($,t.time):1,h=l*d,u=h!==this.context.globalAlpha;u&&(this.context.save(),this.context.globalAlpha=h),this.context.drawImage(p,a,a,p.width-2*a,p.height-2*a,r,i,o,n),u&&this.context.restore(),1!==d?t.animate=!0:s&&e.endTransition($)}},t.prototype.getImage=function(){var e=this.context;return e?e.canvas:null},t.prototype.getTileImage=function(e){return e.getImage()},t.prototype.scheduleExpireCache=function(e,t){if(t.canExpireCache()){var r=function(e,t,r){var i=ca(e);i in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[i])}.bind(null,t);e.postRenderFunctions.push(r)}},t.prototype.updateUsedTiles=function(e,t,r){var i=ca(t);i in e||(e[i]={}),e[i][r.getKey()]=!0},t.prototype.manageTilePyramid=function(e,t,r,i,o,n,a,s,l){var p=ca(t);p in e.wantedTiles||(e.wantedTiles[p]={});var $,d,h,u,c,g,m=e.wantedTiles[p],T=e.tileQueue;for(g=r.getMinZoom();g<=a;++g)for(d=r.getTileRangeForExtentAndZ(n,g,d),h=r.getResolution(g),u=d.minX;u<=d.maxX;++u)for(c=d.minY;c<=d.maxY;++c)a-g<=s?(($=t.getTile(g,u,c,i,o)).getState()==ba.IDLE&&(m[$.getKey()]=!0,T.isKeyQueued($.getKey())||T.enqueue([$,p,r.getTileCoordCenter($.tileCoord),h])),void 0!==l&&l($)):t.useTile(g,u,c,o)},t}(pe);Lf.prototype.getLayer,Kf.default=Lf;var Hn=If&&If.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ii=function(r){function e(e){return r.call(this,e)||this}return Hn(e,r),e.prototype.createRenderer=function(){return new Lf(this)},e}(Hi);If.default=Ii;function In(e,r){var t=/\{z\}/g,o=/\{x\}/g,$=/\{y\}/g,n=/\{-y\}/g;return function(a,l,p){return a?e.replace(t,a[0].toString()).replace(o,a[1].toString()).replace($,a[2].toString()).replace(n,function(){var e=a[0],t=r.getFullTileRange(e);return g(t,55),(t.getHeight()-a[2]-1).toString()}):void 0}}function Jn(e,r){for(var t=e.length,o=new Array(t),$=0;$<t;++$)o[$]=In(e[$],r);return Kn(o)}function Kn(e){return 1===e.length?e[0]:function(r,t,o){if(r){var $=Bn(r),n=Ja($,e.length);return e[n](r,t,o)}}}function Ln(e,r,t){}function Mn(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var o=t[1].charCodeAt(0),$=t[2].charCodeAt(0),n=void 0;for(n=o;n<=$;++n)r.push(e.replace(t[0],String.fromCharCode(n)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(t[2],10),l=parseInt(t[1],10);l<=a;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}var Mf={};var Nf={};function Nn(e,t,r,a){var o=Bd(r,t,e),$=zd(t,a,r),n=t.getMetersPerUnit();void 0!==n&&($*=n);var i=e.getMetersPerUnit();void 0!==i&&($/=i);var O=e.getExtent();if(!O||$f(O,o)){var l=zd(e,$,o)/$;isFinite(l)&&l>0&&($/=l)}return $}function Of(e,t,r,a){var o=r-e,$=a-t,n=Math.sqrt(o*o+$*$);return[Math.round(r+o/n),Math.round(a+$/n)]}function On(e,t,r,a,o,$,n,i,O,l,s){var c=J(Math.round(r*e),Math.round(r*t));if(0===O.length)return c.canvas;c.scale(r,r);var p=ea();O.forEach(function(e,t,r){ag(p,e.extent)});var u=D(p),k=P(p),g=J(Math.round(r*u/a),Math.round(r*k/a)),v=r/a;O.forEach(function(e,t,r){var a=e.extent[0]-p[0],o=-(e.extent[3]-p[3]),$=D(e.extent),n=P(e.extent);g.drawImage(e.image,l,l,e.image.width-2*l,e.image.height-2*l,a*v,o*v,$*v,n*v)});var B=ga(n);return i.getTriangles().forEach(function(e,t,o){var n=e.source,i=e.target,O=n[0][0],l=n[0][1],s=n[1][0],u=n[1][1],k=n[2][0],v=n[2][1],m=(i[0][0]-B[0])/$,h=-(i[0][1]-B[1])/$,d=(i[1][0]-B[0])/$,f=-(i[1][1]-B[1])/$,x=(i[2][0]-B[0])/$,P=-(i[2][1]-B[1])/$,C=O,M=l;O=0,l=0,s-=C,u-=M,k-=C,v-=M;var T=uj([[s,u,0,0,d-m],[k,v,0,0,x-m],[0,0,s,u,f-h],[0,0,k,v,P-h]]);if(T){c.save(),c.beginPath();var E=(m+d+x)/3,j=(h+f+P)/3,q=Of(E,j,m,h),R=Of(E,j,d,f),S=Of(E,j,x,P);c.moveTo(R[0],R[1]),c.lineTo(q[0],q[1]),c.lineTo(S[0],S[1]),c.clip(),c.transform(T[0],T[2],T[1],T[3],m,h),c.translate(p[0]-C,p[3]-M),c.scale(a/r,-a/r),c.drawImage(g.canvas,0,0),c.restore()}}),s&&(c.save(),c.strokeStyle="black",c.lineWidth=1,i.getTriangles().forEach(function(e,t,r){var a=e.target,o=(a[0][0]-B[0])/$,n=-(a[0][1]-B[1])/$,i=(a[1][0]-B[0])/$,O=-(a[1][1]-B[1])/$,l=(a[2][0]-B[0])/$,s=-(a[2][1]-B[1])/$;c.beginPath(),c.moveTo(i,O),c.lineTo(o,n),c.lineTo(l,s),c.closePath(),c.stroke()}),c.restore()),c.canvas}var Pn=10,Ji=.25,Qn=function(){function t(t,r,i,o,e){this.sourceProj_=t,this.targetProj_=r;var s={},d=Db(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var r=t[0]+"/"+t[1];return s[r]||(s[r]=d(t)),s[r]},this.maxSourceExtent_=o,this.errorThresholdSquared_=e*e,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!o&&!!this.sourceProj_.getExtent()&&D(o)==D(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?D(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?D(this.targetProj_.getExtent()):null;var a=ga(i),n=Ga(i),h=Fa(i),$=sa(i),u=this.transformInv_(a),m=this.transformInv_(n),g=this.transformInv_(h),_=this.transformInv_($);if(this.addQuad_(a,n,h,$,u,m,g,_,Pn),this.wrapsXInSource_){var c=1/0;this.triangles_.forEach(function(t,r,i){c=Math.min(c,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-c>this.sourceWorldWidth_/2){var r=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];r[0][0]-c>this.sourceWorldWidth_/2&&(r[0][0]-=this.sourceWorldWidth_),r[1][0]-c>this.sourceWorldWidth_/2&&(r[1][0]-=this.sourceWorldWidth_),r[2][0]-c>this.sourceWorldWidth_/2&&(r[2][0]-=this.sourceWorldWidth_);var i=Math.min(r[0][0],r[1][0],r[2][0]);Math.max(r[0][0],r[1][0],r[2][0])-i<this.sourceWorldWidth_/2&&(t.source=r)}}.bind(this))}s={}}return t.prototype.addTriangle_=function(t,r,i,o,e,s){this.triangles_.push({source:[o,e,s],target:[t,r,i]})},t.prototype.addQuad_=function(t,r,i,o,e,s,d,a,n){var h=y([e,s,d,a]),$=this.sourceWorldWidth_?D(h)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,m=this.sourceProj_.canWrapX()&&$>.5&&$<1,g=!1;if(n>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var _=y([t,r,i,o]);g=D(_)/this.targetWorldWidth_>Ji||g}!m&&this.sourceProj_.isGlobal()&&$&&(g=$>Ji||g)}if(g||!this.maxSourceExtent_||fa(h,this.maxSourceExtent_)){if(!(g||isFinite(e[0])&&isFinite(e[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(d[0])&&isFinite(d[1])&&isFinite(a[0])&&isFinite(a[1]))){if(!(n>0))return;g=!0}if(n>0){if(!g){var c=[(t[0]+i[0])/2,(t[1]+i[1])/2],l=this.transformInv_(c),p=void 0;if(m)p=(Ja(e[0],u)+Ja(d[0],u))/2-Ja(l[0],u);else p=(e[0]+d[0])/2-l[0];var f=(e[1]+d[1])/2-l[1];g=p*p+f*f>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var W=[(r[0]+i[0])/2,(r[1]+i[1])/2],Y=this.transformInv_(W),v=[(o[0]+t[0])/2,(o[1]+t[1])/2],I=this.transformInv_(v);this.addQuad_(t,r,W,v,e,s,Y,I,n-1),this.addQuad_(v,W,i,o,I,Y,d,a,n-1)}else{var x=[(t[0]+r[0])/2,(t[1]+r[1])/2],E=this.transformInv_(x),j=[(i[0]+o[0])/2,(i[1]+o[1])/2],S=this.transformInv_(j);this.addQuad_(t,x,j,o,e,E,S,a,n-1),this.addQuad_(x,r,i,j,E,s,d,S,n-1)}return}}if(m){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,o,e,d,a),this.addTriangle_(t,r,i,e,s,d)}},t.prototype.calculateSourceExtent=function(){var t=ea();return this.triangles_.forEach(function(r,i,o){var e=r.source;_a(t,e[0]),_a(t,e[1]),_a(t,e[2])}),t},t.prototype.getTriangles=function(){return this.triangles_},t}();var Rn=Nf&&Nf.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Ki=function(t){function e(e,r,o,i,p,s,$,n,a,l,u){var c=t.call(this,p,ba.IDLE)||this;c.renderEdges_=void 0!==u&&u,c.pixelRatio_=$,c.gutter_=n,c.canvas_=null,c.sourceTileGrid_=r,c.targetTileGrid_=i,c.wrappedTileCoord_=s||p,c.sourceTiles_=[],c.sourcesListenerKeys_=null,c.sourceZ_=0;var _=i.getTileCoordExtent(c.wrappedTileCoord_),T=c.targetTileGrid_.getExtent(),M=c.sourceTileGrid_.getExtent(),h=T?Ab(_,T):_;if(0===ud(h))return c.state=ba.EMPTY,c;var g=e.getExtent();g&&(M=M?Ab(M,g):g);var m=i.getResolution(c.wrappedTileCoord_[0]),d=zb(h),f=Nn(e,o,d,m);if(!isFinite(f)||f<=0)return c.state=ba.EMPTY,c;var E=void 0!==l?l:En;if(c.triangulation_=new Qn(e,o,h,M,f*E),0===c.triangulation_.getTriangles().length)return c.state=ba.EMPTY,c;c.sourceZ_=r.getZForResolution(f);var v=c.triangulation_.calculateSourceExtent();if(M&&(e.canWrapX()?(v[1]=z(v[1],M[1],M[3]),v[3]=z(v[3],M[1],M[3])):v=Ab(v,M)),ud(v)){for(var S=r.getTileRangeForExtentAndZ(v,c.sourceZ_),x=S.minX;x<=S.maxX;x++)for(var y=S.minY;y<=S.maxY;y++){var R=a(c.sourceZ_,x,y,$);R&&c.sourceTiles_.push(R)}0===c.sourceTiles_.length&&(c.state=ba.EMPTY)}else c.state=ba.EMPTY;return c}return Rn(e,t),e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,r,o){e&&e.getState()==ba.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=ba.ERROR;else{var e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),o="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],p=this.targetTileGrid_.getResolution(e),s=this.sourceTileGrid_.getResolution(this.sourceZ_),$=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=On(o,i,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),p,$,this.triangulation_,t,this.gutter_,this.renderEdges_),this.state=ba.LOADED}this.changed()},e.prototype.load=function(){if(this.state==ba.IDLE){this.state=ba.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,r,o){var i=e.getState();if(i==ba.IDLE||i==ba.LOADING){t++;var p=a(e,f.CHANGE,function(r){var o=e.getState();o!=ba.LOADED&&o!=ba.ERROR&&o!=ba.EMPTY||(d(p),0===--t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(p)}}.bind(this)),this.sourceTiles_.forEach(function(t,e,r){t.getState()==ba.IDLE&&t.load()}),0===t&&setTimeout(this.reproject_.bind(this),0)}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(d),this.sourcesListenerKeys_=null},e}(Ae);Nf.default=Ki;var Pf={};var gd={};function Li(r){var e=r.getDefaultTileGrid();return e||(e=Vn(r),r.setDefaultTileGrid(e)),e}function Sn(r,e,t){var o=e[0],$=r.getTileCoordCenter(e),i=Qf(t);if($f(i,$))return e;var n=D(i),g=Math.ceil((i[0]-$[0])/n);return $[0]+=n*g,r.getTileCoordForCoordAndZ($,o)}function Tn(r,e,t,o){var $=void 0!==o?o:Bb.TOP_LEFT,i=Mi(r,e,t);return new Ni({extent:r,origin:kj(r,$),resolutions:i,tileSize:t})}function Un(r){var e=r||{},t=e.extent||C("EPSG:3857").getExtent(),o={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Mi(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Ni(o)}function Mi(r,e,t,o){for(var $=void 0!==e?e:Pl,i=P(r),n=D(r),g=za(void 0!==t?t:Le),p=o>0?o:Math.max(n/g[0],i/g[1]),N=$+1,J=new Array(N),a=0;a<N;++a)J[a]=p/Math.pow(2,a);return J}function Vn(r,e,t,o){return Tn(Qf(r),e,t,o)}function Qf(r){var e=(r=C(r)).getExtent();if(!e){var t=180*Q[E.DEGREES]/r.getMetersPerUnit();e=N(-t,-t,t,t)}return e}var Wn=[0,0,0],Ni=function(){function t(t){var i;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,g(aj(this.resolutions_,function(t,i){return i-t},!0),17),!t.origins)for(var e=0,o=this.resolutions_.length-1;e<o;++e)if(i){if(this.resolutions_[e]/this.resolutions_[e+1]!==i){i=void 0;break}}else i=this.resolutions_[e]/this.resolutions_[e+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,g(this.origins_.length==this.resolutions_.length,20));var r=t.extent;void 0===r||this.origin_||this.origins_||(this.origin_=ga(r)),g(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,g(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Le,g(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==r?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,i){return new Gf(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):r&&this.calculateTileRanges_(r)}return t.prototype.forEachTileCoord=function(t,i,e){for(var o=this.getTileRangeForExtentAndZ(t,i),r=o.minX,n=o.maxX;r<=n;++r)for(var s=o.minY,l=o.maxY;s<=l;++s)e([i,r,s])},t.prototype.forEachTileCoordParentTileRange=function(t,i,e,o){var r,n,s,l=null,h=t[0]-1;for(2===this.zoomFactor_?(n=t[1],s=t[2]):l=this.getTileCoordExtent(t,o);h>=this.minZoom;){if(2===this.zoomFactor_?(n=Math.floor(n/2),s=Math.floor(s/2),r=Hf(n,n,s,s,e)):r=this.getTileRangeForExtentAndZ(l,h,e),i(h,r))return!0;--h}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,i,e){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var o=2*t[1],r=2*t[2];return Hf(o,o+1,r,r+1,i)}var n=this.getTileCoordExtent(t,e);return this.getTileRangeForExtentAndZ(n,t[0]+1,i)}return null},t.prototype.getTileRangeExtent=function(t,i,e){var o=this.getOrigin(t),r=this.getResolution(t),n=za(this.getTileSize(t),this.tmpSize_),s=o[0]+i.minX*n[0]*r,l=o[0]+(i.maxX+1)*n[0]*r,h=o[1]+i.minY*n[1]*r,a=o[1]+(i.maxY+1)*n[1]*r;return N(s,h,l,a,e)},t.prototype.getTileRangeForExtentAndZ=function(t,i,e){var o=Wn;this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,o);var r=o[1],n=o[2];return this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,o),Hf(r,o[1],n,o[2],e)},t.prototype.getTileCoordCenter=function(t){var i=this.getOrigin(t[0]),e=this.getResolution(t[0]),o=za(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*o[0]*e,i[1]-(t[2]+.5)*o[1]*e]},t.prototype.getTileCoordExtent=function(t,i){var e=this.getOrigin(t[0]),o=this.getResolution(t[0]),r=za(this.getTileSize(t[0]),this.tmpSize_),n=e[0]+t[1]*r[0]*o,s=e[1]-(t[2]+1)*r[1]*o,l=n+r[0]*o,h=s+r[1]*o;return N(n,s,l,h,i)},t.prototype.getTileCoordForCoordAndResolution=function(t,i,e){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,e)},t.prototype.getTileCoordForXYAndResolution_=function(t,i,e,o,r){var n=this.getZForResolution(e),s=e/this.getResolution(n),l=this.getOrigin(n),h=za(this.getTileSize(n),this.tmpSize_),a=o?.5:0,u=o?.5:0,$=Math.floor((t-l[0])/e+a),g=Math.floor((l[1]-i)/e+u),p=s*$/h[0],m=s*g/h[1];return o?(p=Math.ceil(p)-1,m=Math.ceil(m)-1):(p=Math.floor(p),m=Math.floor(m)),Fi(n,p,m,r)},t.prototype.getTileCoordForXYAndZ_=function(t,i,e,o,r){var n=this.getOrigin(e),s=this.getResolution(e),l=za(this.getTileSize(e),this.tmpSize_),h=o?.5:0,a=o?.5:0,u=Math.floor((t-n[0])/s+h),$=Math.floor((n[1]-i)/s+a),g=u/l[0],p=$/l[1];return o?(g=Math.ceil(g)-1,p=Math.ceil(p)-1):(g=Math.floor(g),p=Math.floor(p)),Fi(e,g,p,r)},t.prototype.getTileCoordForCoordAndZ=function(t,i,e){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,e)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},t.prototype.getZForResolution=function(t,i){var e=od(this.resolutions_,t,i||0);return z(e,this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var i=this.resolutions_.length,e=new Array(i),o=this.minZoom;o<i;++o)e[o]=this.getTileRangeForExtentAndZ(t,o);this.fullTileRanges_=e},t}();var Oi=gd&&gd.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Pi=function(e){function t(t){var i=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX})||this;i.opaque_=void 0!==t.opaque&&t.opaque,i.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,i.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;var r=[256,256],o=t.tileGrid;o&&za(o.getTileSize(o.getMinZoom()),r);var n="undefined"!=typeof screen,s=n?screen.availWidth||screen.width:1920,a=n?screen.availHeight||screen.height:1080,p=4*Math.ceil(s/r[0])*Math.ceil(a/r[1]);return i.tileCache=new Ff(Math.max(p,t.cacheSize||0)),i.tmpSize=[0,0],i.key_=t.key||"",i.tileOptions={transition:t.transition},i.zDirection=t.zDirection?t.zDirection:0,i}return Oi(t,e),t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(e,t){var i=this.getTileCacheForProjection(e);i&&i.expireCache(t)},t.prototype.forEachLoadedTile=function(e,t,i,r){var o=this.getTileCacheForProjection(e);if(!o)return!1;for(var n,s,a,p=!0,c=i.minX;c<=i.maxX;++c)for(var l=i.minY;l<=i.maxY;++l)s=ed(t,c,l),a=!1,o.containsKey(s)&&(a=(n=o.get(s)).getState()===ba.LOADED)&&(a=!1!==r(n)),a||(p=!1);return p},t.prototype.getGutterForProjection=function(e){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},t.prototype.getOpaque=function(e){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(e,t,i,r,o){return c()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:Li(e)},t.prototype.getTileCacheForProjection=function(e){var t=this.getProjection();return t&&!ab(t,e)?null:this.tileCache},t.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(e,t,i){var r=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),n=za(r.getTileSize(e),this.tmpSize);return 1==o?n:Yl(n,o,this.tmpSize)},t.prototype.getTileCoordForTileUrlFunction=function(e,t){var i=void 0!==t?t:this.getProjection(),r=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=Sn(r,e,i)),Cn(e,r)?e:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),e.prototype.refresh.call(this)},t.prototype.useTile=function(e,t,i,r){},t}(xe),Qi=function(e){function t(t,i){var r=e.call(this,t)||this;return r.tile=i,r}return Oi(t,e),t}(A);gd.TileSourceEvent=Qi,gd.default=Pi;var Rf={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var Xn=Pf&&Pf.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ri=function(t){function e(e){var i=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this;return i.generateTileUrlFunction_=!e.tileUrlFunction,i.tileLoadFunction=e.tileLoadFunction,i.tileUrlFunction=e.tileUrlFunction?e.tileUrlFunction.bind(i):Ln,i.urls=null,e.urls?i.setUrls(e.urls):e.url&&i.setUrl(e.url),i.tileLoadingKeys_={},i}return Xn(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,i=t.target,r=ca(i),n=i.getState();n==ba.LOADING?(this.tileLoadingKeys_[r]=!0,e=Rf.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],e=n==ba.ERROR?Rf.TILELOADERROR:n==ba.LOADED?Rf.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new Qi(e,i))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=Mn(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Jn(t,this.tileGrid),e):this.setKey(e)},e.prototype.useTile=function(t,e,i){var r=ed(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)},e}(Pi);Pf.default=Ri;var Yn=Mf&&Mf.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Si=function(e){function t(t){var r=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Zn,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return r.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,r.tileClass=void 0!==t.tileClass?t.tileClass:vh,r.tileCacheForProjection={},r.tileGridForProjection={},r.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,r.renderReprojectionEdges_=!1,r}return Yn(t,e),t.prototype.canExpireCache=function(){if(!pa)return e.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},t.prototype.expireCache=function(t,r){if(pa){var i=this.getTileCacheForProjection(t);for(var o in this.tileCache.expireCache(this.tileCache==i?r:{}),this.tileCacheForProjection){var n=this.tileCacheForProjection[o];n.expireCache(n==i?r:{})}}else e.prototype.expireCache.call(this,t,r)},t.prototype.getGutterForProjection=function(e){return pa&&this.getProjection()&&e&&!ab(this.getProjection(),e)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getOpaque=function(t){return!(pa&&this.getProjection()&&t&&!ab(this.getProjection(),t))&&e.prototype.getOpaque.call(this,t)},t.prototype.getTileGridForProjection=function(t){if(!pa)return e.prototype.getTileGridForProjection.call(this,t);var r=this.getProjection();if(!this.tileGrid||r&&!ab(r,t)){var i=ca(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Li(t)),this.tileGridForProjection[i]}return this.tileGrid},t.prototype.getTileCacheForProjection=function(t){if(!pa)return e.prototype.getTileCacheForProjection.call(this,t);var r=this.getProjection();if(!r||ab(r,t))return this.tileCache;var i=ca(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Ff(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]},t.prototype.createTile_=function(e,t,r,i,o,n){var l=[e,t,r],c=this.getTileCoordForTileUrlFunction(l,o),a=c?this.tileUrlFunction(c,i,o):void 0,s=new this.tileClass(l,void 0!==a?ba.IDLE:ba.EMPTY,void 0!==a?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return s.key=n,s.addEventListener(f.CHANGE,this.handleTileChange.bind(this)),s},t.prototype.getTile=function(e,t,r,i,o){var n=this.getProjection();if(pa&&n&&o&&!ab(n,o)){var l=this.getTileCacheForProjection(o),c=[e,t,r],a=void 0,s=Gi(c);l.containsKey(s)&&(a=l.get(s));var $=this.getKey();if(a&&a.key==$)return a;var p=this.getTileGridForProjection(n),h=this.getTileGridForProjection(o),u=this.getTileCoordForTileUrlFunction(c,o),G=new Ki(n,p,o,h,c,u,this.getTilePixelRatio(i),this.getGutter(),function(e,t,r,i){return this.getTileInternal(e,t,r,i,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return G.key=$,a?(G.interimTile=a,G.refreshInterimChain(),l.replace(s,G)):l.set(s,G),G}return this.getTileInternal(e,t,r,i,n||o)},t.prototype.getTileInternal=function(e,t,r,i,o){var n=null,l=ed(e,t,r),c=this.getKey();if(this.tileCache.containsKey(l)){if((n=this.tileCache.get(l)).key!=c){var a=n;n=this.createTile_(e,t,r,i,o,c),a.getState()==ba.IDLE?n.interimTile=a.interimTile:n.interimTile=a,n.refreshInterimChain(),this.tileCache.replace(l,n)}}else n=this.createTile_(e,t,r,i,o,c),this.tileCache.set(l,n);return n},t.prototype.setRenderReprojectionEdges=function(e){if(pa&&this.renderReprojectionEdges_!=e){for(var t in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}},t.prototype.setTileGridForProjection=function(e,t){if(pa){var r=C(e);if(r){var i=ca(r);i in this.tileGridForProjection||(this.tileGridForProjection[i]=t)}}},t}(Ri);function Zn(e,t){e.getImage().src=t}Mf.default=Si;var Sf={};var $n=Sf&&Sf.__extends||function(){var t=function(o,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])})(o,r)};return function(o,r){function e(){this.constructor=o}t(o,r),o.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}}(),Ti=function(t){function o(o){var r=o||{},e=void 0!==r.projection?r.projection:"EPSG:3857",i=void 0!==r.tileGrid?r.tileGrid:Un({extent:Qf(e),maxResolution:r.maxResolution,maxZoom:r.maxZoom,minZoom:r.minZoom,tileSize:r.tileSize});return t.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,opaque:r.opaque,projection:e,reprojectionErrorThreshold:r.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:r.tileLoadFunction,tilePixelRatio:r.tilePixelRatio,tileUrlFunction:r.tileUrlFunction,url:r.url,urls:r.urls,wrapX:void 0===r.wrapX||r.wrapX,transition:r.transition,attributionsCollapsible:r.attributionsCollapsible,zDirection:r.zDirection})||this}return $n(o,t),o}(Si);Sf.default=Ti;var hd={};var _n=hd&&hd.__extends||function(){var t=function(r,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(r,o)};return function(r,o){function e(){this.constructor=r}t(r,o),r.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}(),Ui="&#169; <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">OpenStreetMap</a> contributors.";hd.ATTRIBUTION=Ui;var Vi=function(t){function r(r){var o,e=r||{};o=void 0!==e.attributions?e.attributions:[Ui];var n=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",i=void 0!==e.url?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";return t.call(this,{attributions:o,cacheSize:e.cacheSize,crossOrigin:n,opaque:void 0===e.opaque||e.opaque,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:i,wrapX:e.wrapX,attributionsCollapsible:!1})||this}return _n(r,t),r}(Ti);hd.default=Vi;var ao=!0;try{new ImageData(10,10)}catch(_){ao=!1}var bo=document.createElement("canvas").getContext("2d");function co(a,e,r){if(ao)return new ImageData(a,e,r);var t=bo.createImageData(e,r);return t.data.set(a),t}var eo=co;var fo=eo;function Wi(e){var t=!0;try{new ImageData(10,10)}catch(a){t=!1}function r(e,r,a){return t?new ImageData(e,r,a):{data:e,width:r,height:a}}return function(t){var a,i,s=t.buffers,n=t.meta,o=t.imageOps,u=t.width,h=t.height,f=s.length,p=s[0].byteLength;if(o){var $=new Array(f);for(i=0;i<f;++i)$[i]=r(new Uint8ClampedArray(s[i]),u,h);a=e($,n).data}else{a=new Uint8ClampedArray(p);var c=new Array(f),_=new Array(f);for(i=0;i<f;++i)c[i]=new Uint8ClampedArray(s[i]),_[i]=[0,0,0,0];for(var v=0;v<p;v+=4){for(var l=0;l<f;++l){var g=c[l];_[l][0]=g[v],_[l][1]=g[v+1],_[l][2]=g[v+2],_[l][3]=g[v+3]}var d=e(_,n);a[v]=d[0],a[v+1]=d[1],a[v+2]=d[2],a[v+3]=d[3]}}return a.buffer}}function go(e,t){var r=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+Wi.toString()+")(",e.operation.toString(),");","self.addEventListener(\"message\", function(event) {","  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),a=new Blob(r,{type:"text/javascript"}),i=URL.createObjectURL(a),s=new Worker(i);return s.addEventListener("message",t),s}function ho(e,t){var r=Wi(e.operation);return{postMessage:function(e){setTimeout(function(){t({data:{buffer:r(e),meta:e.meta}})},0)}}}function tb(e){var t;this._imageOps=!!e.imageOps;var r=[];if(t=0===e.threads?0:this._imageOps?1:e.threads||1)for(var a=0;a<t;++a)r[a]=go(e,this._onWorkerMessage.bind(this,a));else r[0]=ho(e,this._onWorkerMessage.bind(this,0));this._workers=r,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}tb.prototype.process=function(e,t,r){this._enqueue({inputs:e,meta:t,callback:r}),this._dispatch()},tb.prototype.destroy=function(){for(var e in this)this[e]=null;this._destroyed=!0},tb.prototype._enqueue=function(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)},tb.prototype._dispatch=function(){if(0===this._running&&this._queue.length>0){var e=this._job=this._queue.shift(),t=e.inputs[0].width,r=e.inputs[0].height,a=e.inputs.map(function(e){return e.data.buffer}),i=this._workers.length;if(this._running=i,1===i)this._workers[0].postMessage({buffers:a,meta:e.meta,imageOps:this._imageOps,width:t,height:r},a);else for(var s=e.inputs[0].data.length,n=4*Math.ceil(s/4/i),o=0;o<i;++o){for(var u=o*n,h=[],f=0,p=a.length;f<p;++f)h.push(a[o].slice(u,u+n));this._workers[o].postMessage({buffers:h,meta:e.meta,imageOps:this._imageOps,width:t,height:r},h)}}},tb.prototype._onWorkerMessage=function(e,t){this._destroyed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())},tb.prototype._resolveJob=function(){var e,t,r=this._job,a=this._workers.length;if(1===a)e=new Uint8ClampedArray(this._dataLookup[0].buffer),t=this._dataLookup[0].meta;else{var i=r.inputs[0].data.length;e=new Uint8ClampedArray(i),t=new Array(i);for(var s=4*Math.ceil(i/4/a),n=0;n<a;++n){var o=this._dataLookup[n].buffer,u=n*s;e.set(new Uint8ClampedArray(o),u),t[n]=this._dataLookup[n].meta}}this._job=null,this._dataLookup={},r.callback(null,fo(e,r.inputs[0].width,r.inputs[0].height),t),this._dispatch()};Ej();var Tf=new Ei({target:"map",layers:[new Ii({source:new Vi})],view:new Ub({center:[0,0],zoom:2})});document.getElementById("freiburg").addEventListener("click",function(){var e=[7.749881,47.944828,7.849881+.1,47.994828+.05];Tf.getView();Tf.setView(new Ub({extent:e})),Tf.getView().fit(e)});})();